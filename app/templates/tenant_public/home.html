{% extends "tenant_public/base.html" %}

{% block title %}{{ profile.display_name or tenant.name }} - Servis mobilnih telefona{% endblock %}

{% block content %}
{% set hero_phone = profile.phone or tenant.telefon %}
{% set warranty_days = tenant.default_warranty_days or 45 %}
{% set fast_service = profile.fast_service_text or '1-3 sata' %}

<!-- Hero Section -->
<section class="mg-hero">
    <div class="mg-hero__container">
        <div class="mg-hero__content">
            <!-- Hero Logo - Large & Centered -->
            {% set hero_logo = profile.logo_url or tenant.logo_url %}
            {% if hero_logo %}
            <div class="mg-hero__logo-wrapper mg-fade-in">
                <img src="{{ hero_logo }}" alt="{{ profile.display_name or tenant.name }}" class="mg-hero__logo">
            </div>
            {% endif %}

            <!-- Badge -->
            <div class="mg-hero__badge mg-fade-in mg-fade-in-delay-1">
                <span class="mg-hero__badge-dot"></span>
                Profesionalni servis
            </div>

            <!-- Title with gradient -->
            <h1 class="mg-hero__title mg-fade-in mg-fade-in-delay-2">
                {% if profile.headline %}
                {{ profile.headline }}
                {% else %}
                Brza i pouzdana <span class="mg-hero__title-gradient">popravka telefona</span>
                {% endif %}
            </h1>

            <!-- Subtitle -->
            {% if profile.tagline %}
            <p class="mg-hero__subtitle mg-fade-in mg-fade-in-delay-3">{{ profile.tagline }}</p>
            {% else %}
            <p class="mg-hero__subtitle mg-fade-in mg-fade-in-delay-3">
                Stručni tim sa višegodišnjim iskustvom. Garancija na sve popravke.
                Vaša satisfakcija nam je prioritet.
            </p>
            {% endif %}

            <!-- CTA Buttons -->
            <div class="mg-hero__cta mg-fade-in mg-fade-in-delay-4">
                {% if hero_phone %}
                <a href="tel:{{ hero_phone }}" class="mg-btn mg-btn--primary mg-btn--lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                    Pozovite odmah
                </a>
                {% endif %}
                {% if profile.show_prices %}
                <a href="/cenovnik" class="mg-btn mg-btn--secondary mg-btn--lg">
                    Pogledajte cenovnik
                </a>
                {% endif %}
            </div>

            <!-- Flash Services - Scramble Animation -->
            {% if flash_words and flash_words|length > 0 %}
            <div class="mg-scramble-section-inline mg-fade-in mg-fade-in-delay-5">
                <p class="mg-scramble-label">Naše usluge</p>
                <div class="mg-scramble-container">
                    <div class="mg-scramble-text" id="scrambleText"></div>
                </div>
            </div>
            {% endif %}

            <!-- Trust Bar -->
            {% if profile.show_trust_badges != false %}
            <div class="mg-trust-bar mg-fade-in mg-fade-in-delay-6">
                <div class="mg-trust-item">
                    <div class="mg-trust-item__icon">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                    </div>
                    <div class="mg-trust-item__text">
                        <span class="mg-trust-item__label">Garancija</span>
                        <span class="mg-trust-item__value">{{ warranty_days }} dana</span>
                    </div>
                </div>
                <div class="mg-trust-item">
                    <div class="mg-trust-item__icon">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <div class="mg-trust-item__text">
                        <span class="mg-trust-item__label">Brz servis</span>
                        <span class="mg-trust-item__value">{{ fast_service }}</span>
                    </div>
                </div>
                <div class="mg-trust-item">
                    <div class="mg-trust-item__icon">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                    </div>
                    <div class="mg-trust-item__text">
                        <span class="mg-trust-item__label">Bezbednost</span>
                        <span class="mg-trust-item__value">Vaši podaci se ne brišu</span>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>

{% if flash_words and flash_words|length > 0 %}
<!-- Scramble Text Script -->
<script>
// TextScramble Class - Modern scramble reveal animation
class TextScramble {
    constructor(el) {
        this.el = el;
        this.chars = '!<>-_\\/[]{}—=+*^?#_▓█▒░';
        this.update = this.update.bind(this);
    }

    setText(newText) {
        const oldText = this.el.innerText;
        const length = Math.max(oldText.length, newText.length);
        const promise = new Promise(resolve => this.resolve = resolve);
        this.queue = [];

        for (let i = 0; i < length; i++) {
            const from = oldText[i] || '';
            const to = newText[i] || '';
            const start = Math.floor(Math.random() * 40);
            const end = start + Math.floor(Math.random() * 40);
            this.queue.push({ from, to, start, end });
        }

        cancelAnimationFrame(this.frameRequest);
        this.frame = 0;
        this.update();
        return promise;
    }

    update() {
        let output = '';
        let complete = 0;

        for (let i = 0, n = this.queue.length; i < n; i++) {
            let { from, to, start, end, char } = this.queue[i];

            if (this.frame >= end) {
                complete++;
                output += to;
            } else if (this.frame >= start) {
                if (!char || Math.random() < 0.28) {
                    char = this.chars[Math.floor(Math.random() * this.chars.length)];
                    this.queue[i].char = char;
                }
                output += `<span class="scramble-char">${char}</span>`;
            } else {
                output += from;
            }
        }

        this.el.innerHTML = output;

        if (complete === this.queue.length) {
            this.resolve();
        } else {
            this.frameRequest = requestAnimationFrame(this.update);
            this.frame++;
        }
    }
}

// Initialize scramble animation
document.addEventListener('DOMContentLoaded', () => {
    const phrases = {{ flash_words | tojson }};
    const el = document.getElementById('scrambleText');

    if (el && phrases.length > 0) {
        const fx = new TextScramble(el);
        let counter = 0;

        const next = () => {
            fx.setText(phrases[counter]).then(() => {
                setTimeout(next, 2000);
            });
            counter = (counter + 1) % phrases.length;
        };

        next();
    }
});
</script>
{% endif %}

{% if profile.show_tracking_widget %}
<!-- Status Tracking -->
<section class="mg-section">
    <div class="mg-section__container">
        <div class="mg-tracking">
            <h2 class="mg-tracking__title">{{ profile.tracking_widget_title or 'Pratite status Vaše popravke' }}</h2>
            <p class="mg-tracking__subtitle">Unesite broj naloga i poslednja 4 broja Vašeg telefona</p>
            <form class="mg-tracking__form" x-data="{ token: '', phone: '' }" @submit.prevent="if(token.trim() && phone.trim().length >= 4) window.location.href = '/track/' + encodeURIComponent(token.trim()) + '?tenant_id={{ tenant.id }}&phone=' + encodeURIComponent(phone.trim())">
                <input type="text" x-model="token" class="mg-tracking__input" placeholder="Broj naloga" required>
                <input type="text" x-model="phone" class="mg-tracking__input mg-tracking__input--short" placeholder="Posl. 4 cifre" maxlength="4" required>
                <button type="submit" class="mg-btn mg-btn--primary">Proveri</button>
            </form>
        </div>
    </div>
</section>
{% endif %}

{% if google_integration and google_integration.google_rating %}
<!-- Google Rating Badge - Premium Display -->
<section class="mg-section mg-rating-section">
    <div class="mg-section__container">
        <a href="https://www.google.com/maps/place/?q=place_id:{{ google_integration.google_place_id }}"
           target="_blank"
           rel="noopener noreferrer"
           class="mg-rating-card">
            <!-- Google Logo -->
            <div class="mg-rating-card__google">
                <svg viewBox="0 0 24 24" width="32" height="32">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
            </div>

            <!-- Rating Score -->
            <div class="mg-rating-card__score-wrap">
                <span class="mg-rating-card__score">{{ google_integration.google_rating }}</span>
                <div class="mg-rating-card__stars">
                    {% set rating_int = google_integration.google_rating|int %}
                    {% set rating_decimal = google_integration.google_rating - rating_int %}
                    {% for i in range(5) %}
                        {% if i < rating_int %}
                        <svg class="mg-star mg-star--full" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        {% elif i == rating_int and rating_decimal >= 0.5 %}
                        <svg class="mg-star mg-star--half" viewBox="0 0 20 20">
                            <defs>
                                <linearGradient id="half-star-{{ i }}">
                                    <stop offset="50%" stop-color="currentColor"/>
                                    <stop offset="50%" stop-color="#d1d5db"/>
                                </linearGradient>
                            </defs>
                            <path fill="url(#half-star-{{ i }})" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        {% else %}
                        <svg class="mg-star mg-star--empty" viewBox="0 0 20 20" fill="#d1d5db">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Review Count -->
            <div class="mg-rating-card__info">
                <span class="mg-rating-card__count">{{ google_integration.total_reviews }}</span>
                <span class="mg-rating-card__label">recenzija</span>
            </div>

            <!-- CTA Arrow -->
            <div class="mg-rating-card__cta">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                </svg>
            </div>
        </a>
    </div>
</section>
{% endif %}

{% if profile.show_courier_section %}
<!-- Courier Section -->
<section class="mg-section">
    <div class="mg-section__container">
        <div class="mg-courier">
            <div class="mg-courier__icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                </svg>
            </div>
            <div class="mg-courier__content">
                <h3 class="mg-courier__title">{{ profile.courier_title or 'Ne mozete doci? Saljemo kurira!' }}</h3>
                <p class="mg-courier__description">{{ profile.courier_description or 'Besplatno preuzimanje i dostava na Vasu adresu.' }}</p>
                {% if profile.courier_price %}
                <p class="mg-courier__price">Cena dostave: {{ profile.courier_price }} RSD</p>
                {% endif %}
            </div>
            {% if hero_phone %}
            <a href="tel:{{ hero_phone }}" class="mg-btn mg-btn--primary mg-btn--lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
                Zakazite kurira
            </a>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

{% if profile.show_popular_services != false and services_by_category %}
<!-- Popular Services -->
<section class="mg-section">
    <div class="mg-section__container">
        <div class="mg-section__header">
            <span class="mg-section__badge">Usluge</span>
            <h2 class="mg-section__title">{{ profile.popular_services_title or 'Najpopularnije usluge' }}</h2>
            <p class="mg-section__subtitle">Profesionalna popravka uz garanciju kvaliteta</p>
        </div>

        <div class="mg-services-grid">
            {% set popular_limit = profile.popular_services_limit or 6 %}
            {% set shown_count = namespace(value=0) %}
            {% for category, category_services in services_by_category.items() %}
                {% for service in category_services %}
                    {% if shown_count.value < popular_limit %}
                    <div class="mg-service-card">
                        <span class="mg-service-card__category">{{ category }}</span>
                        <div class="mg-service-card__header">
                            <h3 class="mg-service-card__name">{{ service.name }}</h3>
                            <div class="mg-service-card__price">
                                <span class="mg-service-card__price-value">{{ service.price|int }}</span>
                                <span class="mg-service-card__price-currency">{{ service.currency }}</span>
                            </div>
                        </div>
                        {% if service.description %}
                        <p class="mg-service-card__description">{{ service.description|truncate(100) }}</p>
                        {% endif %}
                        {% if hero_phone %}
                        <a href="tel:{{ hero_phone }}" class="mg-service-card__cta">
                            Zakazite
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                    {% set shown_count.value = shown_count.value + 1 %}
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>

        {% if profile.show_prices %}
        <div class="mg-text-center mg-mt-12">
            <a href="/cenovnik" class="mg-btn mg-btn--secondary mg-btn--lg">
                Pogledajte kompletan cenovnik
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                </svg>
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}

{% if google_integration and google_integration.google_photos and google_integration.google_photos|length > 0 %}
<!-- Google Photos Gallery -->
<section class="mg-section mg-gallery-section">
    <div class="mg-section__container">
        <div class="mg-section__header">
            <span class="mg-section__badge">Galerija</span>
            <h2 class="mg-section__title">Pogledajte naš prostor</h2>
            <p class="mg-section__subtitle">Slike sa Google Business profila</p>
        </div>

        <div class="mg-gallery">
            {% for photo in google_integration.google_photos[:8] %}
            <div class="mg-gallery__item {% if loop.index == 1 %}mg-gallery__item--featured{% endif %}">
                <div class="mg-gallery__image-wrapper">
                    <img src="{{ photo.url }}"
                         alt="Fotografija {{ loop.index }}"
                         class="mg-gallery__image"
                         loading="lazy">
                    <div class="mg-gallery__overlay">
                        <div class="mg-gallery__zoom">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if google_integration.google_place_id %}
        <div class="mg-text-center mg-mt-8">
            <a href="https://www.google.com/maps/place/?q=place_id:{{ google_integration.google_place_id }}"
               target="_blank"
               rel="noopener noreferrer"
               class="mg-btn mg-btn--secondary">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
                Pogledajte na Google Maps
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}

{% set good_reviews = google_reviews|selectattr('rating', 'ge', 4)|list %}
{% if good_reviews and good_reviews|length > 0 %}
<!-- Google Reviews Carousel -->
<section class="mg-section mg-reviews-section">
    <div class="mg-section__container">
        <div class="mg-section__header">
            <span class="mg-section__badge">Recenzije</span>
            <h2 class="mg-section__title">Šta kažu naši klijenti</h2>
            <p class="mg-section__subtitle">Vaše zadovoljstvo je naša najbolja preporuka</p>

            {% if google_integration and google_integration.google_rating %}
            <div class="mg-reviews-summary">
                <div class="mg-reviews-summary__stars">
                    {% for i in range(5) %}
                    <svg class="w-6 h-6" fill="{{ 'currentColor' if i < (google_integration.google_rating|int) else 'none' }}" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    {% endfor %}
                </div>
                <span class="mg-reviews-summary__rating">{{ google_integration.google_rating }}</span>
                <span class="mg-reviews-summary__count">({{ google_integration.total_reviews }} recenzija)</span>
            </div>
            {% endif %}
        </div>

        <!-- Reviews Carousel -->
        <div class="mg-reviews-carousel">
            <div class="mg-reviews-carousel__track">
                <!-- First set of reviews (4-5 stars only) -->
                {% for review in good_reviews[:15] %}
                <div class="mg-review-card">
                    <div class="mg-review-card__header">
                        {% if review.author_photo_url %}
                        <img src="{{ review.author_photo_url }}" alt="{{ review.author_name }}" class="mg-review-card__avatar">
                        {% else %}
                        <div class="mg-review-card__avatar mg-review-card__avatar--initials">{{ review.author_name[0]|upper if review.author_name else 'A' }}</div>
                        {% endif %}
                        <div>
                            <div class="mg-review-card__author">{{ review.author_name }}</div>
                            {% if review.relative_time %}
                            <div class="mg-review-card__date">{{ review.relative_time }}</div>
                            {% elif review.review_time %}
                            <div class="mg-review-card__date">{{ review.review_time.strftime('%d.%m.%Y') if review.review_time else '' }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="mg-review-card__stars">
                        {% for i in range(review.rating or 5) %}
                        <svg class="mg-review-card__star" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        {% endfor %}
                    </div>
                    {% if review.text %}
                    <p class="mg-review-card__text">{{ review.text|truncate(180) }}</p>
                    {% endif %}
                </div>
                {% endfor %}

                <!-- Duplicate reviews for seamless loop -->
                {% for review in good_reviews[:15] %}
                <div class="mg-review-card" aria-hidden="true">
                    <div class="mg-review-card__header">
                        {% if review.author_photo_url %}
                        <img src="{{ review.author_photo_url }}" alt="{{ review.author_name }}" class="mg-review-card__avatar">
                        {% else %}
                        <div class="mg-review-card__avatar mg-review-card__avatar--initials">{{ review.author_name[0]|upper if review.author_name else 'A' }}</div>
                        {% endif %}
                        <div>
                            <div class="mg-review-card__author">{{ review.author_name }}</div>
                            {% if review.relative_time %}
                            <div class="mg-review-card__date">{{ review.relative_time }}</div>
                            {% elif review.review_time %}
                            <div class="mg-review-card__date">{{ review.review_time.strftime('%d.%m.%Y') if review.review_time else '' }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="mg-review-card__stars">
                        {% for i in range(review.rating or 5) %}
                        <svg class="mg-review-card__star" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        {% endfor %}
                    </div>
                    {% if review.text %}
                    <p class="mg-review-card__text">{{ review.text|truncate(180) }}</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        {% if google_integration and google_integration.google_place_id %}
        <div class="mg-text-center mg-mt-8">
            <a href="https://www.google.com/maps/place/?q=place_id:{{ google_integration.google_place_id }}"
               target="_blank"
               rel="noopener noreferrer"
               class="mg-btn mg-btn--secondary">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                </svg>
                Pogledajte sve recenzije na Google
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}

{% if profile.show_process_section and profile.process_steps and profile.process_steps|length > 0 %}
<!-- Process Steps -->
<section class="mg-section">
    <div class="mg-section__container">
        <div class="mg-section__header">
            <span class="mg-section__badge">Proces</span>
            <h2 class="mg-section__title">{{ profile.process_title or 'Kako funkcionise' }}</h2>
        </div>

        <div class="mg-services-grid" style="max-width: 1000px; margin: 0 auto;">
            {% for step in profile.process_steps %}
            <div class="mg-card" style="text-align: center;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--mg-gradient-1), var(--mg-gradient-2)); border-radius: var(--mg-radius-xl); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--mg-space-4); font-size: 1.5rem; font-weight: 800; color: white;">{{ loop.index }}</div>
                <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--mg-text-primary); margin-bottom: var(--mg-space-2);">{{ step.title }}</h3>
                <p style="color: var(--mg-text-secondary); font-size: 0.875rem;">{{ step.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% if profile.why_us_items and profile.why_us_items|length > 0 %}
<!-- Why Us -->
<section class="mg-section">
    <div class="mg-section__container">
        <div class="mg-section__header">
            <span class="mg-section__badge">Prednosti</span>
            <h2 class="mg-section__title">{{ profile.why_us_title or 'Zasto mi?' }}</h2>
        </div>

        <div class="mg-services-grid">
            {% for item in profile.why_us_items %}
            <div class="mg-card">
                {% if item.icon %}
                <div style="font-size: 2rem; margin-bottom: var(--mg-space-4);">{{ item.icon }}</div>
                {% endif %}
                <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--mg-text-primary); margin-bottom: var(--mg-space-2);">{{ item.title }}</h3>
                <p style="color: var(--mg-text-secondary); font-size: 0.875rem;">{{ item.text }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% if profile.faq_items and profile.faq_items|length > 0 %}
<!-- FAQ -->
<section class="mg-section" x-data="{ openFaq: null }">
    <div class="mg-section__container" style="max-width: 800px;">
        <div class="mg-section__header">
            <span class="mg-section__badge">FAQ</span>
            <h2 class="mg-section__title">{{ profile.faq_title or 'Cesto postavljana pitanja' }}</h2>
        </div>

        <div style="display: flex; flex-direction: column; gap: var(--mg-space-4);">
            {% for faq in profile.faq_items %}
            <div class="mg-card" style="padding: 0; overflow: hidden;">
                <button
                    @click="openFaq = openFaq === {{ loop.index }} ? null : {{ loop.index }}"
                    style="width: 100%; padding: var(--mg-space-6); display: flex; justify-content: space-between; align-items: center; background: transparent; border: none; cursor: pointer; text-align: left;"
                >
                    <span style="font-weight: 600; color: var(--mg-text-primary);">{{ faq.question }}</span>
                    <svg
                        style="width: 20px; height: 20px; color: var(--mg-text-muted); transition: transform 0.2s;"
                        :style="{ transform: openFaq === {{ loop.index }} ? 'rotate(180deg)' : '' }"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div
                    x-show="openFaq === {{ loop.index }}"
                    x-transition
                    style="padding: 0 var(--mg-space-6) var(--mg-space-6);"
                    x-cloak
                >
                    <p style="color: var(--mg-text-secondary);">{{ faq.answer }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Contact Section -->
<section class="mg-section">
    <div class="mg-section__container">
        <div class="mg-section__header">
            <span class="mg-section__badge">Kontakt</span>
            <h2 class="mg-section__title">Kontaktirajte nas</h2>
            <p class="mg-section__subtitle">Imate pitanja? Slobodno nas kontaktirajte</p>
        </div>

        {% set contact_address = profile.address or tenant.adresa_sedista %}
        {% set contact_city = profile.city or tenant.grad %}
        {% set contact_phone = profile.phone or tenant.telefon %}
        {% set contact_email = profile.email or tenant.email %}

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--mg-space-6); max-width: 900px; margin: 0 auto;">
            <!-- Kontakt informacije box -->
            {% if contact_address or contact_phone or contact_email %}
            <div class="mg-card" style="text-align: center; padding: var(--mg-space-8);">
                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--mg-gradient-1), var(--mg-gradient-2)); border-radius: var(--mg-radius-lg); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--mg-space-4);">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </div>
                <h3 style="font-weight: 600; color: var(--mg-text-primary); margin-bottom: var(--mg-space-4); font-size: 1.125rem;">Kontakt informacije</h3>

                <div style="display: flex; flex-direction: column; gap: var(--mg-space-4);">
                    {% if contact_address %}
                    <div style="display: flex; align-items: center; justify-content: center; gap: var(--mg-space-3);">
                        <svg style="width: 18px; height: 18px; color: var(--mg-gradient-1); flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span style="color: var(--mg-text-secondary); font-size: 0.9rem;">{{ contact_address }}{% if contact_city %}, {{ contact_city }}{% endif %}</span>
                    </div>
                    {% endif %}

                    {% if contact_phone %}
                    <div style="display: flex; align-items: center; justify-content: center; gap: var(--mg-space-3);">
                        <svg style="width: 18px; height: 18px; color: var(--mg-gradient-1); flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                        <a href="tel:{{ contact_phone }}" style="color: var(--mg-gradient-1); font-size: 0.9rem; text-decoration: none;">{{ contact_phone }}</a>
                    </div>
                    {% endif %}

                    {% if contact_email %}
                    <div style="display: flex; align-items: center; justify-content: center; gap: var(--mg-space-3);">
                        <svg style="width: 18px; height: 18px; color: var(--mg-gradient-1); flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        <a href="mailto:{{ contact_email }}" style="color: var(--mg-gradient-1); font-size: 0.9rem; text-decoration: none;">{{ contact_email }}</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Radno vreme box -->
            {% if profile.working_hours %}
            <div class="mg-card" style="text-align: center; padding: var(--mg-space-8);">
                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--mg-gradient-1), var(--mg-gradient-2)); border-radius: var(--mg-radius-lg); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--mg-space-4);">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h3 style="font-weight: 600; color: var(--mg-text-primary); margin-bottom: var(--mg-space-4); font-size: 1.125rem;">Radno vreme</h3>
                <div class="mg-working-hours">
                    {% if profile.working_hours.mon %}<div class="mg-working-hours__row"><span class="mg-working-hours__day">Pon</span><span class="mg-working-hours__time">{{ profile.working_hours.mon }}</span></div>{% endif %}
                    {% if profile.working_hours.tue %}<div class="mg-working-hours__row"><span class="mg-working-hours__day">Uto</span><span class="mg-working-hours__time">{{ profile.working_hours.tue }}</span></div>{% endif %}
                    {% if profile.working_hours.wed %}<div class="mg-working-hours__row"><span class="mg-working-hours__day">Sre</span><span class="mg-working-hours__time">{{ profile.working_hours.wed }}</span></div>{% endif %}
                    {% if profile.working_hours.thu %}<div class="mg-working-hours__row"><span class="mg-working-hours__day">Cet</span><span class="mg-working-hours__time">{{ profile.working_hours.thu }}</span></div>{% endif %}
                    {% if profile.working_hours.fri %}<div class="mg-working-hours__row"><span class="mg-working-hours__day">Pet</span><span class="mg-working-hours__time">{{ profile.working_hours.fri }}</span></div>{% endif %}
                    {% if profile.working_hours.sat %}<div class="mg-working-hours__row"><span class="mg-working-hours__day">Sub</span><span class="mg-working-hours__time">{{ profile.working_hours.sat }}</span></div>{% endif %}
                    {% if profile.working_hours.sun %}<div class="mg-working-hours__row"><span class="mg-working-hours__day">Ned</span><span class="mg-working-hours__time">{{ profile.working_hours.sun }}</span></div>{% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Map -->
        {% if profile.maps_embed_url %}
        <div style="margin-top: var(--mg-space-12);">
            <div style="border-radius: var(--mg-radius-2xl); overflow: hidden; border: 1px solid var(--mg-glass-border);">
                <iframe
                    src="{{ profile.maps_embed_url }}"
                    width="100%"
                    height="400"
                    style="border: 0;"
                    allowfullscreen=""
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>

            <!-- Directions Button -->
            <div style="display: flex; justify-content: center; gap: var(--mg-space-4); margin-top: var(--mg-space-6); flex-wrap: wrap;">
                {% set directions_destination = google_integration.google_place_id if google_integration and google_integration.google_place_id else (contact_address ~ ', ' ~ contact_city if contact_city else contact_address) %}
                {% if google_integration and google_integration.google_place_id %}
                <a href="https://www.google.com/maps/dir/?api=1&destination_place_id={{ google_integration.google_place_id }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="mg-btn mg-btn--primary mg-btn--lg mg-directions-btn">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                    </svg>
                    Prikaži putanju
                </a>
                {% elif contact_address %}
                <a href="https://www.google.com/maps/dir/?api=1&destination={{ (contact_address ~ ', ' ~ contact_city)|urlencode if contact_city else contact_address|urlencode }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="mg-btn mg-btn--primary mg-btn--lg mg-directions-btn">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                    </svg>
                    Prikaži putanju
                </a>
                {% endif %}

                {% if google_integration and google_integration.google_place_id %}
                <a href="https://www.google.com/maps/place/?q=place_id:{{ google_integration.google_place_id }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="mg-btn mg-btn--secondary mg-btn--lg">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    Otvori u Google Maps
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- CTA Section -->
<section class="mg-section">
    <div class="mg-section__container">
        <div class="mg-card mg-card--glow mg-text-center" style="padding: var(--mg-space-12);">
            <h2 style="font-size: clamp(1.5rem, 4vw, 2.5rem); font-weight: 700; color: var(--mg-text-primary); margin-bottom: var(--mg-space-4);">
                Imate problem sa telefonom?
            </h2>
            <p style="color: var(--mg-text-secondary); margin-bottom: var(--mg-space-8); max-width: 500px; margin-left: auto; margin-right: auto;">
                Kontaktirajte nas danas i dobijte besplatnu procenu popravke.
                Brz odziv, fer cene, kvalitetna usluga.
            </p>
            {% if hero_phone %}
            <a href="tel:{{ hero_phone }}" class="mg-btn mg-btn--primary mg-btn--lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
                {{ hero_phone }}
            </a>
            {% endif %}
        </div>
    </div>
</section>

{% endblock %}
