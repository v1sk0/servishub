<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ profile.display_name or tenant.name }}{% endblock %}</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="{{ profile.meta_description or profile.tagline or '' }}">
    <meta name="keywords" content="{{ profile.meta_keywords or '' }}">

    <!-- Open Graph -->
    <meta property="og:title" content="{{ profile.meta_title or profile.display_name or tenant.name }}">
    <meta property="og:description" content="{{ profile.meta_description or profile.tagline or '' }}">
    <meta property="og:image" content="{{ profile.cover_image_url or profile.logo_url or tenant.logo_url or '' }}">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    {% set favicon_logo = profile.logo_url or tenant.logo_url %}
    {% if favicon_logo %}
    <link rel="icon" type="image/png" href="{{ favicon_logo }}">
    {% endif %}

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Theme CSS - Dynamic loading based on profile.theme -->
    {% set theme = profile.theme or 'premium' %}
    {% set theme_map = {
        'premium': 'modern-glass.css',
        'starter': 'starter.css',
        'elite': 'elite.css'
    } %}
    {% set theme_file = theme_map.get(theme, 'modern-glass.css') %}
    <!-- Cache-bust: v472 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes/' ~ theme_file) }}?v=472">

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    {% block head %}{% endblock %}

    <!-- Structured Data - LocalBusiness Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": ["LocalBusiness", "ProfessionalService"],
        "@id": "{{ request.url_root }}#business",
        "name": "{{ profile.display_name or tenant.name }}",
        "description": "{{ profile.meta_description or profile.tagline or '' }}",
        {% if profile.logo_url or tenant.logo_url %}"image": "{{ profile.logo_url or tenant.logo_url }}",{% endif %}
        "url": "{{ request.url_root }}",
        {% if profile.phone or tenant.telefon %}"telephone": "{{ profile.phone or tenant.telefon }}",{% endif %}
        {% if profile.email or tenant.email %}"email": "{{ profile.email or tenant.email }}",{% endif %}
        {% if profile.address or tenant.adresa_sedista %}
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "{{ profile.address or tenant.adresa_sedista }}",
            "addressLocality": "{{ profile.city or tenant.grad }}",
            {% if profile.postal_code or tenant.postanski_broj %}"postalCode": "{{ profile.postal_code or tenant.postanski_broj }}",{% endif %}
            "addressCountry": "RS"
        },
        {% endif %}
        {% if profile.working_hours %}
        "openingHoursSpecification": [
            {
                "@type": "OpeningHoursSpecification",
                "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                "opens": "{{ profile.working_hours.split('-')[0]|trim if '-' in profile.working_hours else '09:00' }}",
                "closes": "{{ profile.working_hours.split('-')[1]|trim if '-' in profile.working_hours else '20:00' }}"
            }
        ],
        {% endif %}
        "areaServed": {
            "@type": "Country",
            "name": "Srbija"
        },
        {% if google_integration and google_integration.google_rating %}
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "{{ google_integration.google_rating }}",
            "reviewCount": "{{ google_integration.total_reviews }}",
            "bestRating": "5",
            "worstRating": "1"
        },
        {% endif %}
        "priceRange": "$$",
        "paymentAccepted": "Cash, Credit Card"
    }
    </script>
</head>
<body class="mg-page" x-data="{ mobileMenuOpen: false }">
    <!-- Animated Background Orbs -->
    <div class="mg-bg-animated">
        <div class="mg-orb mg-orb--1"></div>
        <div class="mg-orb mg-orb--2"></div>
        <div class="mg-orb mg-orb--3"></div>
    </div>

    <!-- Navigation -->
    <nav class="mg-nav">
        <div class="mg-nav__container">
            <!-- Logo -->
            <a href="/" class="mg-nav__logo">
                {% set site_logo = profile.logo_url or tenant.logo_url %}
                {% if site_logo %}
                <img src="{{ site_logo }}" alt="{{ profile.display_name or tenant.name }}">
                {% endif %}
                <span class="mg-nav__logo-text">{{ profile.display_name or tenant.name }}</span>
            </a>

            <!-- Desktop Navigation -->
            <div class="mg-nav__links">
                <a href="/" class="mg-nav__link">Početna</a>
                {% if profile.show_prices %}
                <a href="/cenovnik" class="mg-nav__link">Cenovnik</a>
                {% endif %}
                {% if profile.about_content %}
                <a href="/o-nama" class="mg-nav__link">O nama</a>
                {% endif %}
                <a href="/kontakt" class="mg-nav__link">Kontakt</a>
                <a href="/politika-privatnosti" class="mg-nav__link">Privatnost</a>
            </div>

            <!-- CTA -->
            <div class="mg-nav__cta">
                {% set nav_phone = profile.phone or tenant.telefon %}
                {% if nav_phone %}
                <a href="tel:{{ nav_phone }}" class="mg-btn mg-btn--primary">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                    <span class="hidden sm:inline">{{ nav_phone }}</span>
                </a>
                {% endif %}

                <!-- Mobile menu toggle -->
                <button @click="mobileMenuOpen = !mobileMenuOpen" class="mg-hamburger">
                    <span class="mg-hamburger__line"></span>
                    <span class="mg-hamburger__line"></span>
                    <span class="mg-hamburger__line"></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mg-mobile-menu" :class="{ 'active': mobileMenuOpen }" x-show="mobileMenuOpen" x-cloak>
        <a href="/" class="mg-mobile-menu__link" @click="mobileMenuOpen = false">Početna</a>
        {% if profile.show_prices %}
        <a href="/cenovnik" class="mg-mobile-menu__link" @click="mobileMenuOpen = false">Cenovnik</a>
        {% endif %}
        {% if profile.about_content %}
        <a href="/o-nama" class="mg-mobile-menu__link" @click="mobileMenuOpen = false">O nama</a>
        {% endif %}
        <a href="/kontakt" class="mg-mobile-menu__link" @click="mobileMenuOpen = false">Kontakt</a>
        <a href="/politika-privatnosti" class="mg-mobile-menu__link" @click="mobileMenuOpen = false">Privatnost</a>
        {% set mobile_phone = profile.phone or tenant.telefon %}
        {% if mobile_phone %}
        <a href="tel:{{ mobile_phone }}" class="mg-btn mg-btn--primary mg-btn--lg" @click="mobileMenuOpen = false">
            Pozovite: {{ mobile_phone }}
        </a>
        {% endif %}
    </div>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="mg-footer">
        <div class="mg-footer__container">
            <!-- Brand -->
            <div class="mg-footer__brand">
                <div class="mg-footer__logo">
                    {% set footer_logo = profile.logo_url or tenant.logo_url %}
                    {% if footer_logo %}
                    <img src="{{ footer_logo }}" alt="{{ profile.display_name or tenant.name }}">
                    {% endif %}
                    <span class="mg-footer__logo-text">{{ profile.display_name or tenant.name }}</span>
                </div>
                {% if profile.tagline %}
                <p class="mg-footer__description">{{ profile.tagline }}</p>
                {% endif %}
            </div>

            <!-- Quick Links -->
            <div>
                <h4 class="mg-footer__title">Navigacija</h4>
                <ul class="mg-footer__links">
                    <li class="mg-footer__link"><a href="/">Početna</a></li>
                    {% if profile.show_prices %}
                    <li class="mg-footer__link"><a href="/cenovnik">Cenovnik</a></li>
                    {% endif %}
                    {% if profile.about_content %}
                    <li class="mg-footer__link"><a href="/o-nama">O nama</a></li>
                    {% endif %}
                    <li class="mg-footer__link"><a href="/kontakt">Kontakt</a></li>
                    <li class="mg-footer__link"><a href="/politika-privatnosti">Politika privatnosti</a></li>
                </ul>
            </div>

            <!-- Services -->
            {% if services_by_category %}
            <div>
                <h4 class="mg-footer__title">Usluge</h4>
                <ul class="mg-footer__links">
                    {% for category in services_by_category.keys() %}
                    {% if loop.index <= 4 %}
                    <li class="mg-footer__link"><a href="/cenovnik#{{ category|lower|replace(' ', '-') }}">{{ category }}</a></li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Contact -->
            <div>
                <h4 class="mg-footer__title">Kontakt</h4>
                {% set footer_address = profile.address or tenant.adresa_sedista %}
                {% set footer_city = profile.city or tenant.grad %}
                {% set footer_phone = profile.phone or tenant.telefon %}
                {% set footer_email = profile.email or tenant.email %}
                <ul class="mg-footer__links">
                    {% if footer_address %}
                    <li class="mg-footer__link"><span style="color: var(--mg-text-secondary);">{{ footer_address }}{% if footer_city %}, {{ footer_city }}{% endif %}</span></li>
                    {% endif %}
                    {% if footer_phone %}
                    <li class="mg-footer__link"><a href="tel:{{ footer_phone }}">{{ footer_phone }}</a></li>
                    {% endif %}
                    {% if footer_email %}
                    <li class="mg-footer__link"><a href="mailto:{{ footer_email }}">{{ footer_email }}</a></li>
                    {% endif %}
                    {% if profile.working_hours %}
                    <li class="mg-footer__link">
                        <span style="color: var(--mg-text-secondary);">
                            {% if profile.working_hours.mon %}Pon-Pet: {{ profile.working_hours.mon }}{% endif %}
                            {% if profile.working_hours.sat %}, Sub: {{ profile.working_hours.sat }}{% endif %}
                        </span>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <!-- Bottom -->
        <div class="mg-footer__bottom mg-container">
            <p class="mg-footer__copyright">&copy; {{ now().year if now is defined else '2026' }} {{ profile.display_name or tenant.name }}. Sva prava zadržana.</p>
            <div class="mg-footer__social">
                {% if profile.facebook_url %}
                <a href="{{ profile.facebook_url }}" target="_blank" aria-label="Facebook">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                </a>
                {% endif %}
                {% if profile.instagram_url %}
                <a href="{{ profile.instagram_url }}" target="_blank" aria-label="Instagram">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Powered by -->
        <div class="mg-container mg-text-center mg-mt-8">
            <a href="https://servishub.rs" target="_blank" rel="noopener" class="mg-btn mg-btn--glass mg-btn--sm">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                Powered by ServisHub
            </a>
        </div>

        <!-- Legal Notice -->
        <div class="mg-container mg-text-center" style="margin-top: var(--mg-space-6); padding-top: var(--mg-space-6); border-top: 1px solid var(--mg-glass-border);">
            <p style="color: var(--mg-text-muted); font-size: 0.75rem; line-height: 1.6; max-width: 800px; margin: 0 auto;">
                Svi tekstovi i sadržaji na ovom sajtu su vlasništvo <strong>{{ profile.display_name or tenant.name }}</strong> i zaštićeni su autorskim pravima.
                Zabranjeno je svako kopiranje bez dozvole. Za sadržaj ovog sajta isključivo je odgovoran njegov vlasnik.
                <a href="/politika-privatnosti" style="color: var(--mg-gradient-1);">Politika privatnosti</a>
            </p>
        </div>
    </footer>

    <!-- Floating WhatsApp Button -->
    {% if profile.show_whatsapp_button and profile.whatsapp_number %}
    <a href="https://wa.me/{{ profile.whatsapp_number|replace('+', '')|replace(' ', '')|replace('-', '') }}{% if profile.whatsapp_message %}?text={{ profile.whatsapp_message|urlencode }}{% endif %}"
       target="_blank"
       rel="noopener noreferrer"
       class="mg-floating-btn mg-floating-btn--whatsapp"
       aria-label="WhatsApp">
        <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
        </svg>
    </a>
    {% endif %}

    <!-- Floating Phone Button (mobile only) -->
    {% set floating_phone = profile.phone or tenant.telefon %}
    {% if floating_phone %}
    <a href="tel:{{ floating_phone }}"
       class="mg-floating-btn mg-floating-btn--phone"
       aria-label="Pozovite">
        <svg width="28" height="28" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
        </svg>
    </a>
    {% endif %}

    {% block scripts %}{% endblock %}
</body>
</html>
