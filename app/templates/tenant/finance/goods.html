{% extends "layouts/tenant.html" %}

{% block title %}Prodaja opreme - Finansije{% endblock %}

{% block page_content %}
<div x-data="goodsReport()" x-init="loadData()">
    <!-- Header -->
    <div class="md:flex md:items-center md:justify-between mb-6">
        <div class="min-w-0 flex-1">
            <nav class="flex mb-2" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2">
                    <li><a href="/finance" class="text-gray-400 hover:text-gray-500">Finansije</a></li>
                    <li><span class="text-gray-400">/</span></li>
                    <li class="text-gray-700 font-medium">Prodaja opreme</li>
                </ol>
            </nav>
            <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl">Prodaja opreme (POS)</h2>
            <p class="mt-1 text-sm text-gray-500">Roba prodata kroz kasu</p>
        </div>
        <div class="mt-4 flex gap-2 md:ml-4 md:mt-0">
            <div class="inline-flex rounded-md shadow-sm">
                <button @click="setPeriod(7)" :class="days == 7 ? 'bg-primary-600 text-white' : 'bg-white text-gray-700'" class="px-3 py-2 text-sm font-medium rounded-l-md border border-gray-300">7 dana</button>
                <button @click="setPeriod(30)" :class="days == 30 ? 'bg-primary-600 text-white' : 'bg-white text-gray-700'" class="px-3 py-2 text-sm font-medium border-t border-b border-gray-300 -ml-px">30 dana</button>
                <button @click="setPeriod(90)" :class="days == 90 ? 'bg-primary-600 text-white' : 'bg-white text-gray-700'" class="px-3 py-2 text-sm font-medium border-t border-b border-gray-300 -ml-px">90 dana</button>
                <button @click="setPeriod(365)" :class="days == 365 ? 'bg-primary-600 text-white' : 'bg-white text-gray-700'" class="px-3 py-2 text-sm font-medium rounded-r-md border border-gray-300 -ml-px">Godina</button>
            </div>
        </div>
    </div>

    <!-- Summary -->
    <div class="bg-white shadow rounded-lg p-6 mb-6">
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-3">
            <div>
                <p class="text-sm font-medium text-gray-500">Ukupan promet</p>
                <p class="mt-1 text-3xl font-semibold text-gray-900" x-text="formatPrice(data.total || 0)"></p>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Profit</p>
                <p class="mt-1 text-3xl font-semibold text-green-600" x-text="formatPrice(data.profit || 0)"></p>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Broj stavki</p>
                <p class="mt-1 text-3xl font-semibold text-gray-900" x-text="data.count || 0"></p>
            </div>
        </div>
    </div>

    <!-- Info -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-blue-700">
                    Ovde se prikazuje promet od prodaje robe kroz POS kasu. Za detaljan pregled po stavkama,
                    pogledajte <a href="/pos/receipts" class="font-medium underline">listu racuna</a>.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
function goodsReport() {
    return {
        days: 30,
        data: {},
        async loadData() {
            const token = localStorage.getItem('access_token');
            const res = await fetch(`/api/v1/finance/goods?days=${this.days}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (res.ok) this.data = await res.json();
        },
        setPeriod(d) { this.days = d; this.loadData(); },
        formatPrice(val) {
            return new Intl.NumberFormat('sr-RS', { style: 'currency', currency: 'RSD', maximumFractionDigits: 0 }).format(val || 0);
        }
    }
}
</script>
{% endblock %}
