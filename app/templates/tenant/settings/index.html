{% extends "layouts/tenant.html" %}

{% block title %}Podesavanja - ServisHub{% endblock %}

{% block page_content %}
<div x-data="settingsPage()" x-init="init()" x-cloak>

    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900">Podesavanja</h1>
        <p class="text-gray-600 mt-1">Upravljajte vasim servisom, timom i lokacijama</p>
    </div>

    <!-- Tabs -->
    <div class="border-b border-gray-200 mb-6">
        <nav class="flex space-x-8 overflow-x-auto" aria-label="Tabs">
            <!-- Podesavanja - svi vide (ali razlicit sadrzaj) -->
            <button @click="activeTab = 'settings'"
                    :class="activeTab === 'settings' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Podesavanja
            </button>
            <!-- Moj Profil - samo za ne-admine (TECHNICIAN, RECEPTIONIST) -->
            <button x-show="!isAdmin()" @click="activeTab = 'my_profile'"
                    :class="activeTab === 'my_profile' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Moj Profil
            </button>
            <!-- Admin-only tabs -->
            <button x-show="isAdmin()" @click="activeTab = 'profile'"
                    :class="activeTab === 'profile' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Profil
            </button>
            <button x-show="isAdmin()" @click="activeTab = 'subscription'"
                    :class="activeTab === 'subscription' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Pretplata
            </button>
            <button x-show="isAdmin()" @click="activeTab = 'team'"
                    :class="activeTab === 'team' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Tim (Zaposleni)
            </button>
            <button x-show="isAdmin()" @click="activeTab = 'locations'"
                    :class="activeTab === 'locations' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Lokacije
            </button>
            <button x-show="isAdmin()" @click="activeTab = 'kyc'"
                    :class="activeTab === 'kyc' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Odgovorno lice
            </button>
            <button x-show="isAdmin()" @click="activeTab = 'public_page'"
                    :class="activeTab === 'public_page' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                </svg>
                Javna Stranica
            </button>
        </nav>
    </div>

    <!-- Loading -->
    <div x-show="loading" class="flex justify-center py-12">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    </div>

    <!-- ==================== PROFILE TAB ==================== -->
    <div x-show="!loading && activeTab === 'profile'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <!-- Logo Upload Section -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Logo servisa</h2>
            <p class="text-sm text-gray-500 mb-4">Logo se prikazuje na print nalozima i javnoj stranici</p>

            <div class="flex items-start gap-6">
                <!-- Logo Preview -->
                <div class="flex-shrink-0">
                    <div class="w-24 h-24 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden bg-gray-50"
                         :class="{'border-solid border-gray-200': profile.logo_url}">
                        <template x-if="profile.logo_url">
                            <img :src="profile.logo_url" alt="Logo" class="w-full h-full object-contain">
                        </template>
                        <template x-if="!profile.logo_url">
                            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </template>
                    </div>
                </div>

                <!-- Upload Controls -->
                <div class="flex-1">
                    <input type="file" id="logo-upload" accept="image/png,image/jpeg,image/gif,image/webp"
                           @change="uploadLogo($event)" class="hidden">

                    <div class="flex flex-wrap gap-2 mb-3">
                        <label for="logo-upload"
                               class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 cursor-pointer transition-colors"
                               :class="{'opacity-50 pointer-events-none': uploadingLogo}">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                            </svg>
                            <span x-text="uploadingLogo ? 'Uploadujem...' : 'Izaberi logo'"></span>
                        </label>

                        <button type="button" x-show="profile.logo_url" @click="deleteLogo()"
                                :disabled="uploadingLogo"
                                class="inline-flex items-center px-4 py-2 bg-red-50 text-red-600 text-sm font-medium rounded-lg hover:bg-red-100 transition-colors disabled:opacity-50">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            Ukloni
                        </button>
                    </div>

                    <p class="text-xs text-gray-500">
                        Dozvoljeni formati: JPG, PNG, GIF, WebP. Maksimalna velicina: 5MB.
                    </p>

                    <!-- Upload Progress -->
                    <div x-show="uploadingLogo" class="mt-3">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full animate-pulse" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Data Section -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Podaci servisa</h2>

            <form @submit.prevent="saveProfile()">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Naziv servisa *</label>
                        <input type="text" x-model="profile.name" required
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">PIB</label>
                        <input type="text" :value="profile.pib" disabled
                               class="w-full border border-gray-200 bg-gray-50 rounded-lg px-3 py-2 text-gray-500">
                        <p class="text-xs text-gray-400 mt-1">PIB se ne moze menjati</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Maticni broj</label>
                        <input type="text" :value="profile.maticni_broj" disabled
                               class="w-full border border-gray-200 bg-gray-50 rounded-lg px-3 py-2 text-gray-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" x-model="profile.email"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                        <input type="text" x-model="profile.telefon"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Adresa sedista</label>
                        <input type="text" x-model="profile.adresa_sedista"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div class="mt-6 flex justify-end">
                    <button type="submit" :disabled="saving"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                        <span x-show="!saving">Sacuvaj izmene</span>
                        <span x-show="saving">Cuvam...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== SETTINGS TAB ==================== -->
    <div x-show="!loading && activeTab === 'settings'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Podesavanja naloga</h2>

            <form @submit.prevent="saveSettings()">
                <div class="space-y-6">
                    <!-- Tema izgleda - FIRST -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-4">Izgled aplikacije</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <!-- Light Theme -->
                                <div @click="setTheme('light')"
                                     class="cursor-pointer border-2 rounded-lg p-4 transition-all"
                                     :class="currentTheme === 'light' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-10 h-10 rounded-lg bg-white border border-gray-200 flex items-center justify-center">
                                            <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">Svetla</p>
                                            <p class="text-xs text-gray-500">Klasicna svetla tema</p>
                                        </div>
                                    </div>
                                    <div class="h-16 rounded-lg bg-gradient-to-br from-white to-gray-50 border border-gray-200"></div>
                                </div>

                                <!-- Glassmorphism Theme -->
                                <div @click="setTheme('glass')"
                                     class="cursor-pointer border-2 rounded-lg p-4 transition-all"
                                     :class="currentTheme === 'glass' ? 'border-purple-500 bg-purple-50' : 'border-gray-200 hover:border-gray-300'">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">Glassmorphism</p>
                                            <p class="text-xs text-gray-500">Tamna prozirna tema</p>
                                        </div>
                                    </div>
                                    <div class="h-16 rounded-lg bg-gradient-to-br from-slate-800 to-slate-900 border border-white/10 relative overflow-hidden">
                                        <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"></div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500">
                                <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Promena teme ce se primeniti odmah na celu aplikaciju
                            </p>
                        </div>
                    </div>

                    <!-- Admin-only settings -->
                    <template x-if="isAdmin()">
                        <div class="space-y-6">
                            <!-- Warranty -->
                            <div class="border-t border-gray-200 pt-6">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Default garancija (dana)</label>
                                <input type="number" x-model="settings.default_warranty_days" min="0" max="365"
                                       class="w-32 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Koliko dana garancije se automatski dodaje na nove naloge</p>
                            </div>

                            <!-- Ticket Prefix -->
                            <div class="border-t border-gray-200 pt-6">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Prefix naloga</label>
                                <input type="text" x-model="settings.ticket_prefix" maxlength="10"
                                       placeholder="SRV" class="w-32 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Npr. SRV-0001 umesto 0001</p>
                            </div>

                            <!-- Notifications -->
                            <div class="border-t border-gray-200 pt-6">
                                <h3 class="text-sm font-medium text-gray-900 mb-4">Notifikacije</h3>
                                <div class="space-y-4">
                                    <label class="flex items-center gap-3">
                                        <input type="checkbox" x-model="settings.email_notifications"
                                               class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">Email notifikacije</span>
                                    </label>
                                </div>
                            </div>

                            <!-- SMS Notifikacije (Billing) -->
                            <div class="border-t border-gray-200 pt-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-900">SMS Notifikacije</h3>
                                        <p class="text-xs text-gray-500 mt-1">Automatski šaljite SMS mušterijama kada je nalog spreman</p>
                                    </div>
                                    <template x-if="smsSettings.sms_enabled">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                            </svg>
                                            Aktivno
                                        </span>
                                    </template>
                                    <template x-if="!smsSettings.sms_enabled">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600">
                                            Neaktivno
                                        </span>
                                    </template>
                                </div>

                                <!-- SMS Info Card -->
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                    <div class="flex items-start gap-3">
                                        <svg class="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                                        </svg>
                                        <div class="flex-1">
                                            <p class="text-sm text-blue-800 font-medium">SMS notifikacije koriste kredit sistem</p>
                                            <p class="text-xs text-blue-700 mt-1">
                                                Cena: <strong x-text="smsSettings.sms_cost_credits"></strong> kredita po SMS-u (1 kredit = 1 EUR)
                                            </p>
                                            <p class="text-xs text-blue-600 mt-1">
                                                Trenutno stanje: <strong x-text="smsSettings.credit_balance?.toFixed(2) || '0.00'"></strong> kredita
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Enable/Disable Button -->
                                <div class="flex gap-3">
                                    <template x-if="!smsSettings.sms_enabled">
                                        <button @click="openSmsEnableModal()" :disabled="smsEnabling"
                                                class="px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                            </svg>
                                            Aktiviraj SMS
                                        </button>
                                    </template>
                                    <template x-if="smsSettings.sms_enabled">
                                        <button @click="disableSms()" :disabled="smsDisabling"
                                                class="px-4 py-2 bg-red-100 text-red-700 text-sm rounded-lg hover:bg-red-200 disabled:opacity-50 flex items-center gap-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                            </svg>
                                            Isključi SMS
                                        </button>
                                    </template>
                                    <a href="/finance/sms" class="px-4 py-2 bg-gray-100 text-gray-700 text-sm rounded-lg hover:bg-gray-200 flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                        SMS Evidencija
                                    </a>
                                </div>

                                <!-- Low balance warning -->
                                <template x-if="smsSettings.sms_enabled && smsSettings.credit_balance < 1">
                                    <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <div class="flex items-center gap-2">
                                            <svg class="w-4 h-4 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                            </svg>
                                            <span class="text-sm text-yellow-800">Nizak balans kredita. <a href="/credits" class="underline font-medium">Dopunite kredit</a> da biste nastavili sa slanjem SMS poruka.</span>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Print Clause -->
                            <div class="border-t border-gray-200 pt-6">
                                <h3 class="text-sm font-medium text-gray-900 mb-4">Podešavanja štampe</h3>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Klauzola za servisni nalog</label>
                                    <textarea x-model="settings.print_clause" rows="4"
                                              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 text-sm"
                                              placeholder="Unesite tekst klauzole koji će se štampati na servisnim nalozima..."></textarea>
                                    <p class="text-xs text-gray-500 mt-1">Ovaj tekst se prikazuje na dnu servisnog naloga prilikom štampe</p>
                                </div>
                            </div>

                            <div class="mt-6 flex justify-end">
                                <button type="submit" :disabled="saving"
                                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                                    <span x-show="!saving">Sacuvaj podesavanja</span>
                                    <span x-show="saving">Cuvam...</span>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== MOJ PROFIL TAB (za TECHNICIAN i RECEPTIONIST) ==================== -->
    <div x-show="!loading && activeTab === 'my_profile'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <!-- Profil info -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-start gap-6">
                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                    <span class="text-3xl font-bold text-blue-600" x-text="(currentUser.ime?.charAt(0) || '') + (currentUser.prezime?.charAt(0) || '')"></span>
                </div>
                <div class="flex-1">
                    <h2 class="text-2xl font-bold text-gray-900" x-text="currentUser.ime + ' ' + currentUser.prezime"></h2>
                    <p class="text-gray-600" x-text="currentUser.email || 'Bez email-a'"></p>
                    <span class="inline-block mt-2 text-sm font-medium px-3 py-1 rounded-full bg-green-100 text-green-700"
                          x-text="getRoleLabel(currentUser.role)"></span>
                </div>
            </div>
        </div>

        <!-- Promena šifre -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Promena šifre</h3>

            <form @submit.prevent="changeMyPassword()">
                <div class="space-y-4 max-w-md">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Trenutna šifra</label>
                        <input type="password" x-model="passwordForm.current_password" required
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nova šifra</label>
                        <input type="password" x-model="passwordForm.new_password" required minlength="6"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Minimalno 6 karaktera</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Potvrdite novu šifru</label>
                        <input type="password" x-model="passwordForm.confirm_password" required minlength="6"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                               :class="{'border-red-500': passwordForm.new_password && passwordForm.confirm_password && passwordForm.new_password !== passwordForm.confirm_password}">
                        <p x-show="passwordForm.new_password && passwordForm.confirm_password && passwordForm.new_password !== passwordForm.confirm_password"
                           class="text-xs text-red-500 mt-1">Šifre se ne poklapaju</p>
                    </div>
                </div>

                <div class="mt-6">
                    <button type="submit" :disabled="changingPassword || (passwordForm.new_password && passwordForm.confirm_password && passwordForm.new_password !== passwordForm.confirm_password)"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span x-show="!changingPassword">Promeni šifru</span>
                        <span x-show="changingPassword">Menjam...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== SUBSCRIPTION TAB ==================== -->
    <div x-show="!loading && activeTab === 'subscription'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <!-- Status Card -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">Status pretplate</h2>
                <span :class="getSubscriptionStatusClass(subscription.status)"
                      class="text-sm font-medium px-3 py-1 rounded-full"
                      x-text="getSubscriptionStatusLabel(subscription.status)"></span>
            </div>

            <div x-show="subscription.is_trial" class="mb-6 p-4 bg-blue-50 rounded-lg">
                <div class="flex items-center gap-3">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <p class="font-medium text-blue-900">Trial period</p>
                        <p class="text-sm text-blue-700">
                            Preostalo: <strong x-text="subscription.trial_days_left"></strong> dana
                            <span x-show="subscription.trial_ends_at">
                                (do <span x-text="formatDate(subscription.trial_ends_at)"></span>)
                            </span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Pricing -->
            <div class="border border-gray-200 rounded-lg overflow-hidden">
                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                    <h3 class="font-medium text-gray-900">Mesecni troskovi</h3>
                </div>
                <div class="p-4 space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Bazni paket (1 lokacija)</span>
                        <span class="font-medium" x-text="formatPrice(subscription.pricing?.base_price) + ' RSD'"></span>
                    </div>
                    <div class="flex justify-between" x-show="subscription.pricing?.additional_locations > 0">
                        <span class="text-gray-600">
                            Dodatne lokacije (<span x-text="subscription.pricing?.additional_locations"></span> x <span x-text="formatPrice(subscription.pricing?.location_price)"></span>)
                        </span>
                        <span class="font-medium" x-text="formatPrice(subscription.pricing?.additional_locations * subscription.pricing?.location_price) + ' RSD'"></span>
                    </div>
                    <div class="flex justify-between pt-3 border-t border-gray-200">
                        <span class="font-semibold text-gray-900">Ukupno mesecno</span>
                        <span class="font-bold text-lg text-gray-900" x-text="formatPrice(subscription.pricing?.monthly_total) + ' RSD'"></span>
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-600">
                    Za produzenje pretplate ili dodatne informacije, kontaktirajte nas na
                    <a href="mailto:office@shub.rs" class="text-blue-600 hover:text-blue-700">office@shub.rs</a>
                </p>
            </div>
        </div>
    </div>

    <!-- ==================== TEAM TAB ==================== -->
    <div x-show="!loading && activeTab === 'team'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Tim (Zaposleni)</h2>
            <a href="/team/new" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>Dodaj korisnika</span>
            </a>
        </div>

        <!-- Login Link za zaposlene -->
        <div class="bg-blue-50 rounded-xl border border-blue-200 p-5">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <h3 class="text-base font-semibold text-blue-900 mb-2">Link za prijavu zaposlenih</h3>
                    <p class="text-sm text-blue-700 mb-3">Podelite ovaj privatni link samo sa zaposlenima. Ne objavljujte javno.</p>
                    <div class="flex items-center gap-2">
                        <input type="text" :value="loginInfo.login_url" readonly
                               class="flex-1 px-3 py-2 bg-white border border-blue-300 rounded-lg text-sm text-gray-700 font-mono">
                        <button @click="copyLoginUrl()"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            Kopiraj
                        </button>
                    </div>
                    <div class="mt-3 flex items-center gap-4">
                        <button @click="regenerateLoginSecret()"
                                class="text-sm text-red-600 hover:text-red-800 font-medium flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Generisi novi link
                        </button>
                        <span class="text-xs text-blue-600">(stari link prestaje da vazi)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase">Korisnik</th>
                            <th class="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase">Rola</th>
                            <th class="text-center px-4 py-3 text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="text-right px-4 py-3 text-xs font-medium text-gray-500 uppercase">Akcije</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <template x-for="user in users" :key="user.id">
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                            <span class="text-blue-600 font-medium text-sm" x-text="user.ime?.charAt(0) + user.prezime?.charAt(0)"></span>
                                        </div>
                                        <span class="font-medium text-gray-900" x-text="user.ime + ' ' + user.prezime"></span>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-sm text-gray-600" x-text="user.email"></td>
                                <td class="px-4 py-3">
                                    <span :class="getRoleClass(user.role)" class="text-xs font-medium px-2 py-1 rounded-full"
                                          x-text="getRoleLabel(user.role)"></span>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <span :class="user.is_active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'"
                                          class="text-xs font-medium px-2 py-1 rounded-full"
                                          x-text="user.is_active ? 'Aktivan' : 'Neaktivan'"></span>
                                </td>
                                <td class="px-4 py-3 text-right">
                                    <button @click="editUser(user)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ==================== LOCATIONS TAB ==================== -->
    <div x-show="!loading && activeTab === 'locations'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Lokacije</h2>
            <button @click="openLocationModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>Dodaj lokaciju</span>
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <template x-for="location in locations" :key="location.id">
                <div class="bg-white rounded-xl shadow-sm border-2 border-gray-300 overflow-hidden">
                    <!-- Map Preview (TOP) -->
                    <div class="h-32 relative bg-gray-100 overflow-hidden border-b-2 border-gray-200">
                        <!-- Google Maps Embed -->
                        <template x-if="location.address || location.city">
                            <iframe
                                class="w-full h-full border-0"
                                loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade"
                                :src="'https://www.google.com/maps?q=' + encodeURIComponent((location.address || '') + ', ' + (location.city || '') + ', Serbia') + '&output=embed'"
                                allowfullscreen>
                            </iframe>
                        </template>
                        <!-- No address placeholder -->
                        <template x-if="!location.address && !location.city">
                            <div class="absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100">
                                <svg class="w-10 h-10 mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span class="text-sm text-gray-400">Unesite adresu</span>
                            </div>
                        </template>

                        <!-- Edit button -->
                        <div class="absolute top-3 right-3 z-10">
                            <button @click="editLocation(location)"
                                    class="p-1.5 bg-white/90 backdrop-blur text-gray-700 hover:bg-white rounded-lg shadow transition-colors"
                                    title="Izmeni lokaciju">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Primary badge (below map) -->
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100" x-show="location.is_primary">
                        <span class="text-blue-700 text-xs font-semibold flex items-center gap-1.5">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            Glavni servis
                        </span>
                    </div>

                    <!-- Location Details (BOTTOM) -->
                    <div class="p-4">
                        <!-- Header -->
                        <div class="mb-3">
                            <h3 class="text-base font-semibold text-gray-900" x-text="location.name"></h3>
                            <p class="text-sm text-gray-500" x-show="location.city" x-text="location.city"></p>
                        </div>

                        <!-- Info Grid -->
                        <div class="space-y-2 text-sm">
                            <!-- Address -->
                            <div class="flex items-start gap-2" x-show="location.address">
                                <svg class="w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <div>
                                    <span class="text-gray-500 text-xs">Adresa:</span>
                                    <p class="text-gray-700" x-text="location.address"></p>
                                </div>
                            </div>

                            <!-- Phone -->
                            <div class="flex items-center gap-2" x-show="location.phone">
                                <svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                <a :href="'tel:' + location.phone" class="text-gray-700 hover:text-blue-600" x-text="location.phone"></a>
                            </div>

                            <!-- Email -->
                            <div class="flex items-center gap-2" x-show="location.email">
                                <svg class="w-4 h-4 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                <a :href="'mailto:' + location.email" class="text-gray-700 hover:text-blue-600 truncate" x-text="location.email"></a>
                            </div>

                            <!-- Working Hours -->
                            <div class="flex items-start gap-2" x-show="formatLocationWorkingHours(location.working_hours)">
                                <svg class="w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <span class="text-gray-500 text-xs">Radno vreme:</span>
                                    <p class="text-gray-700 text-sm" x-text="formatLocationWorkingHours(location.working_hours)"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="mt-4 pt-3 border-t border-gray-100 flex items-center gap-4">
                            <a x-show="location.phone"
                               :href="'tel:' + location.phone"
                               class="inline-flex items-center gap-1.5 text-sm text-green-600 hover:text-green-700 font-medium">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                Pozovi
                            </a>
                            <a x-show="location.address || location.city"
                               :href="'https://www.google.com/maps/dir/?api=1&destination=' + encodeURIComponent((location.address || '') + ', ' + (location.city || ''))"
                               target="_blank"
                               class="inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-700 font-medium">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                                </svg>
                                Putanja
                            </a>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Empty state -->
            <template x-if="locations.length === 0">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-1">Nema lokacija</h3>
                    <p class="text-gray-500 mb-4">Dodajte svoju prvu lokaciju da biste poceli</p>
                    <button @click="openLocationModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Dodaj lokaciju
                    </button>
                </div>
            </template>
        </div>
    </div>

    <!-- ==================== ODGOVORNO LICE TAB ==================== -->
    <div x-show="!loading && activeTab === 'kyc'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Odgovorno lice</h2>
            <p class="text-sm text-gray-500 mb-4">Podaci o vlasniku servisa potrebni za izdavanje faktura</p>

            <!-- Status -->
            <div class="mb-6">
                <div class="flex items-center gap-3 p-4 rounded-lg"
                     :class="kyc.kyc_status === 'VERIFIED' ? 'bg-green-50' : kyc.kyc_status === 'PENDING' ? 'bg-yellow-50' : kyc.kyc_status === 'REJECTED' ? 'bg-red-50' : 'bg-gray-50'">
                    <template x-if="kyc.kyc_status === 'VERIFIED'">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </template>
                    <template x-if="kyc.kyc_status === 'PENDING'">
                        <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </template>
                    <template x-if="!kyc.kyc_submitted">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </template>
                    <div>
                        <p class="font-medium"
                           :class="kyc.kyc_status === 'VERIFIED' ? 'text-green-800' : kyc.kyc_status === 'PENDING' ? 'text-yellow-800' : kyc.kyc_status === 'REJECTED' ? 'text-red-800' : 'text-gray-800'"
                           x-text="kyc.kyc_status === 'VERIFIED' ? 'Verifikovan' : kyc.kyc_status === 'PENDING' ? 'Ceka se verifikacija' : kyc.kyc_status === 'REJECTED' ? 'Odbijeno' : 'Nije prijavljeno'"></p>
                        <p class="text-sm"
                           :class="kyc.kyc_status === 'VERIFIED' ? 'text-green-700' : kyc.kyc_status === 'PENDING' ? 'text-yellow-700' : kyc.kyc_status === 'REJECTED' ? 'text-red-700' : 'text-gray-600'"
                           x-text="kyc.kyc_status === 'VERIFIED' ? 'Odgovorno lice je verifikovano' : kyc.kyc_status === 'PENDING' ? 'Podaci su poslati na verifikaciju' : kyc.kyc_status === 'REJECTED' ? 'Molimo popravite podatke i pošaljite ponovo' : 'Popunite podatke o odgovornom licu'"></p>
                    </div>
                </div>
            </div>

            <!-- Odgovorno lice Form -->
            <div x-show="kyc.kyc_status !== 'VERIFIED'">
                <h3 class="font-medium text-gray-900 mb-4">Podaci odgovornog lica</h3>
                <form @submit.prevent="submitKyc()">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ime *</label>
                            <input type="text" x-model="kycForm.ime" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Prezime *</label>
                            <input type="text" x-model="kycForm.prezime" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">JMBG</label>
                            <input type="text" x-model="kycForm.jmbg" maxlength="13"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Broj licne karte</label>
                            <input type="text" x-model="kycForm.broj_licne_karte"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" x-model="kycForm.email"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="text" x-model="kycForm.telefon"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Adresa</label>
                            <input type="text" x-model="kycForm.adresa"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- ID Card Upload Section -->
                    <div class="mt-6 border-t pt-6" x-show="kyc.kyc_submitted">
                        <h4 class="font-medium text-gray-900 mb-4">Lična karta (opciono)</h4>
                        <p class="text-sm text-gray-500 mb-4">Uploadujte sliku prednje i zadnje strane lične karte za bržu verifikaciju</p>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Front side -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Prednja strana</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center"
                                     :class="{'border-green-500 bg-green-50': kyc.representative?.lk_front_url}">
                                    <template x-if="!kyc.representative?.lk_front_url && !uploadingIdFront">
                                        <div>
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                            <label class="mt-2 cursor-pointer">
                                                <span class="text-sm text-blue-600 hover:text-blue-700">Izaberi sliku</span>
                                                <input type="file" class="hidden" accept="image/*" @change="uploadIdCard($event, 'front')">
                                            </label>
                                        </div>
                                    </template>
                                    <template x-if="uploadingIdFront">
                                        <div class="flex items-center justify-center py-4">
                                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                                        </div>
                                    </template>
                                    <template x-if="kyc.representative?.lk_front_url && !uploadingIdFront">
                                        <div>
                                            <img :src="kyc.representative.lk_front_url" class="max-h-32 mx-auto rounded">
                                            <button type="button" @click="deleteIdCard('front')"
                                                    class="mt-2 text-sm text-red-600 hover:text-red-700">
                                                Obriši
                                            </button>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Back side -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Zadnja strana</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center"
                                     :class="{'border-green-500 bg-green-50': kyc.representative?.lk_back_url}">
                                    <template x-if="!kyc.representative?.lk_back_url && !uploadingIdBack">
                                        <div>
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                            <label class="mt-2 cursor-pointer">
                                                <span class="text-sm text-blue-600 hover:text-blue-700">Izaberi sliku</span>
                                                <input type="file" class="hidden" accept="image/*" @change="uploadIdCard($event, 'back')">
                                            </label>
                                        </div>
                                    </template>
                                    <template x-if="uploadingIdBack">
                                        <div class="flex items-center justify-center py-4">
                                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                                        </div>
                                    </template>
                                    <template x-if="kyc.representative?.lk_back_url && !uploadingIdBack">
                                        <div>
                                            <img :src="kyc.representative.lk_back_url" class="max-h-32 mx-auto rounded">
                                            <button type="button" @click="deleteIdCard('back')"
                                                    class="mt-2 text-sm text-red-600 hover:text-red-700">
                                                Obriši
                                            </button>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">
                            Nakon slanja, vaš zahtev će biti pregledan od strane našeg tima.
                        </p>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button type="submit" :disabled="saving"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                            <span x-show="!saving" x-text="kyc.kyc_submitted ? 'Ažuriraj i pošalji' : 'Pošalji na verifikaciju'"></span>
                            <span x-show="saving">Šaljem...</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Verified Info -->
            <div x-show="kyc.kyc_status === 'VERIFIED' && kyc.representative">
                <div class="p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-600 mb-2">Verifikovano odgovorno lice:</p>
                    <p class="font-medium text-gray-900" x-text="kyc.representative?.ime + ' ' + kyc.representative?.prezime"></p>
                    <p class="text-sm text-gray-600" x-text="kyc.representative?.email"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== JAVNA STRANICA TAB ==================== -->
    <div x-show="!loading && activeTab === 'public_page'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <!-- Status Banner -->
        <div :class="publicProfile.is_public ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'"
             class="rounded-xl border p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <template x-if="publicProfile.is_public">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </template>
                    <template x-if="!publicProfile.is_public">
                        <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </template>
                    <div>
                        <p class="font-medium" :class="publicProfile.is_public ? 'text-green-900' : 'text-yellow-900'"
                           x-text="publicProfile.is_public ? 'Javna stranica je aktivna' : 'Javna stranica je iskljucena'"></p>
                        <p class="text-sm" :class="publicProfile.is_public ? 'text-green-700' : 'text-yellow-700'">
                            <template x-if="publicProfile.is_public">
                                <span>Vasa stranica je vidljiva na internetu</span>
                            </template>
                            <template x-if="!publicProfile.is_public">
                                <span>Ukljucite da bi korisnici mogli da vide vasu stranicu</span>
                            </template>
                        </p>
                    </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" x-model="publicProfile.is_public" @change="savePublicProfile()" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                </label>
            </div>
        </div>

        <!-- Preview Links -->
        <div x-show="publicProfile.is_public" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Vasa javna stranica</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <p class="text-sm text-gray-500 mb-2">Subdomena (automatska)</p>
                    <div class="flex items-center gap-2">
                        <a :href="publicPageUrls.subdomain" target="_blank"
                           class="text-blue-600 hover:text-blue-700 hover:underline font-medium"
                           x-text="publicPageUrls.subdomain"></a>
                        <button @click="copyToClipboard(publicPageUrls.subdomain)" class="p-1 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div x-show="publicPageUrls.custom_domain">
                    <p class="text-sm text-gray-500 mb-2">Custom domen</p>
                    <div class="flex items-center gap-2">
                        <a :href="publicPageUrls.custom_domain" target="_blank"
                           class="text-blue-600 hover:text-blue-700 hover:underline font-medium"
                           x-text="publicPageUrls.custom_domain"></a>
                        <button @click="copyToClipboard(publicPageUrls.custom_domain)" class="p-1 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <!-- QR Code -->
            <div class="mt-4 pt-4 border-t border-gray-200">
                <button @click="loadQRCode()" class="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h2M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                    </svg>
                    Prikazi QR kod
                </button>
                <div x-show="qrCode" class="mt-3">
                    <img :src="qrCode" alt="QR Code" class="w-32 h-32 border rounded-lg">
                </div>
            </div>
        </div>

        <!-- Sub-tabs for public page sections -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="border-b border-gray-200">
                <nav class="flex overflow-x-auto" aria-label="Tabs">
                    <button @click="publicSubTab = 'basic'"
                            :class="publicSubTab === 'basic' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Osnovni podaci
                    </button>
                    <button @click="publicSubTab = 'contact'"
                            :class="publicSubTab === 'contact' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Kontakt
                    </button>
                    <button @click="publicSubTab = 'hours'"
                            :class="publicSubTab === 'hours' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Radno vreme
                    </button>
                    <button @click="publicSubTab = 'branding'"
                            :class="publicSubTab === 'branding' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Branding
                    </button>
                    <button @click="publicSubTab = 'social'"
                            :class="publicSubTab === 'social' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Drustvene mreze
                    </button>
                    <button @click="publicSubTab = 'pricing'"
                            :class="publicSubTab === 'pricing' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Cenovnik
                    </button>
                    <button @click="publicSubTab = 'seo'"
                            :class="publicSubTab === 'seo' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        SEO
                    </button>
                    <button @click="publicSubTab = 'sections'"
                            :class="publicSubTab === 'sections' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Sekcije
                    </button>
                    <button @click="publicSubTab = 'domain'"
                            :class="publicSubTab === 'domain' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Custom Domen
                    </button>
                    <button @click="publicSubTab = 'google'"
                            :class="publicSubTab === 'google' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap flex items-center gap-1">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        Google Recenzije
                    </button>
                </nav>
            </div>

            <div class="p-6">
                <!-- Basic Info Sub-tab -->
                <div x-show="publicSubTab === 'basic'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Naziv za prikaz</label>
                            <input type="text" x-model="publicProfile.display_name" maxlength="200"
                                   :placeholder="profile.name"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ostavite prazno da koristite naziv servisa</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Slogan</label>
                            <input type="text" x-model="publicProfile.tagline" maxlength="300"
                                   placeholder="Vas moto ili kratki opis"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Opis</label>
                        <textarea x-model="publicProfile.description" rows="4"
                                  placeholder="Opis vase firme..."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Naslov O nama sekcije</label>
                        <input type="text" x-model="publicProfile.about_title" maxlength="200"
                               placeholder="O nama"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sadrzaj O nama</label>
                        <textarea x-model="publicProfile.about_content" rows="6"
                                  placeholder="Detaljniji tekst o vasoj firmi..."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Moze sadrzati HTML za formatiranje</p>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Contact Sub-tab -->
                <div x-show="publicSubTab === 'contact'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="tel" x-model="publicProfile.phone" maxlength="50"
                                   :placeholder="profile.telefon"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Drugi telefon</label>
                            <input type="tel" x-model="publicProfile.phone_secondary" maxlength="50"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" x-model="publicProfile.email" maxlength="100"
                                   :placeholder="profile.email"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Grad</label>
                            <input type="text" x-model="publicProfile.city" maxlength="100"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Adresa</label>
                            <input type="text" id="public-address-input" x-model="publicProfile.address" maxlength="300"
                                   placeholder="Pocnite da kucate adresu..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                            <p class="text-xs text-gray-500 mt-1">Izaberite adresu sa liste za automatsko popunjavanje svih polja</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Postanski broj</label>
                            <input type="text" x-model="publicProfile.postal_code" maxlength="20"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Google Maps link</label>
                        <input type="url" x-model="publicProfile.maps_url" maxlength="500"
                               placeholder="https://maps.google.com/..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Link ka vasoj lokaciji na Google Maps</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Google Maps embed URL</label>
                        <input type="url" x-model="publicProfile.maps_embed_url" maxlength="500"
                               placeholder="https://www.google.com/maps/embed?pb=..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Za prikaz mape na stranici (kopirajte src iz iframe embed koda)</p>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Working Hours Sub-tab -->
                <div x-show="publicSubTab === 'hours'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-4">
                    <p class="text-sm text-gray-600 mb-4">Podesite radno vreme za svaki dan. Obelezite "Zatvoreno" ako ne radite taj dan.</p>

                    <div class="space-y-3">
                        <!-- Monday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Ponedeljak</span>
                            <input type="time" x-model="publicProfile.working_hours.mon_open"
                                   :disabled="publicProfile.working_hours.mon_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.mon_close"
                                   :disabled="publicProfile.working_hours.mon_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.mon_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Tuesday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Utorak</span>
                            <input type="time" x-model="publicProfile.working_hours.tue_open"
                                   :disabled="publicProfile.working_hours.tue_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.tue_close"
                                   :disabled="publicProfile.working_hours.tue_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.tue_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Wednesday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Sreda</span>
                            <input type="time" x-model="publicProfile.working_hours.wed_open"
                                   :disabled="publicProfile.working_hours.wed_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.wed_close"
                                   :disabled="publicProfile.working_hours.wed_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.wed_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Thursday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Cetvrtak</span>
                            <input type="time" x-model="publicProfile.working_hours.thu_open"
                                   :disabled="publicProfile.working_hours.thu_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.thu_close"
                                   :disabled="publicProfile.working_hours.thu_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.thu_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Friday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Petak</span>
                            <input type="time" x-model="publicProfile.working_hours.fri_open"
                                   :disabled="publicProfile.working_hours.fri_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.fri_close"
                                   :disabled="publicProfile.working_hours.fri_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.fri_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Saturday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Subota</span>
                            <input type="time" x-model="publicProfile.working_hours.sat_open"
                                   :disabled="publicProfile.working_hours.sat_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.sat_close"
                                   :disabled="publicProfile.working_hours.sat_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.sat_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Sunday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Nedelja</span>
                            <input type="time" x-model="publicProfile.working_hours.sun_open"
                                   :disabled="publicProfile.working_hours.sun_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.sun_close"
                                   :disabled="publicProfile.working_hours.sun_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.sun_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>
                    </div>

                    <!-- Quick Fill Button -->
                    <div class="pt-2">
                        <button type="button" @click="fillDefaultWorkingHours()"
                                class="text-sm text-green-600 hover:text-green-700 underline">
                            Popuni standardno radno vreme (Pon-Pet 09:00-17:00, Sub 09:00-14:00)
                        </button>
                    </div>

                    <div class="flex justify-end pt-4">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Branding Sub-tab -->
                <div x-show="publicSubTab === 'branding'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">

                    <!-- THEME SELECTOR -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Tema sajta</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Starter Theme -->
                            <div @click="publicProfile.theme = 'starter'; savePublicProfile()"
                                 class="cursor-pointer border-2 rounded-xl p-4 transition-all"
                                 :class="publicProfile.theme === 'starter' ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-500/20' : 'border-gray-200 hover:border-blue-300'">
                                <div class="h-24 rounded-lg bg-gradient-to-br from-blue-500 to-blue-700 mb-3 flex items-center justify-center">
                                    <div class="text-center text-white">
                                        <div class="text-xs font-bold">STARTER</div>
                                        <div class="text-[10px] opacity-80">Cist & Profesionalan</div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-blue-500"></div>
                                    <div>
                                        <p class="font-medium text-gray-900 text-sm">Starter</p>
                                        <p class="text-xs text-gray-500">Plava, profesionalna</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Premium Theme -->
                            <div @click="publicProfile.theme = 'premium'; savePublicProfile()"
                                 class="cursor-pointer border-2 rounded-xl p-4 transition-all"
                                 :class="(publicProfile.theme || 'premium') === 'premium' ? 'border-purple-500 bg-purple-50 ring-2 ring-purple-500/20' : 'border-gray-200 hover:border-purple-300'">
                                <div class="h-24 rounded-lg bg-gradient-to-br from-purple-500 via-indigo-500 to-blue-500 mb-3 flex items-center justify-center relative overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"></div>
                                    <div class="text-center text-white relative z-10">
                                        <div class="text-xs font-bold">PREMIUM</div>
                                        <div class="text-[10px] opacity-80">Glassmorphism</div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500"></div>
                                    <div>
                                        <p class="font-medium text-gray-900 text-sm">Premium</p>
                                        <p class="text-xs text-gray-500">Ljubicasta, moderna</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Elite Theme - Coming Soon -->
                            <div class="cursor-not-allowed border-2 rounded-xl p-4 transition-all border-gray-200 opacity-60 relative">
                                <!-- Coming Soon Badge -->
                                <div class="absolute -top-2 -right-2 bg-gray-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full z-20">
                                    USKORO
                                </div>
                                <div class="h-24 rounded-lg bg-gradient-to-br from-slate-600 to-slate-700 mb-3 flex items-center justify-center relative grayscale">
                                    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(150,150,150,0.15),transparent_70%)]"></div>
                                    <div class="text-center relative z-10">
                                        <div class="text-xs font-bold text-gray-400">ELITE</div>
                                        <div class="text-[10px] text-gray-400/80">Luksuzna & Tamna</div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-gradient-to-r from-gray-400 to-gray-500"></div>
                                    <div>
                                        <p class="font-medium text-gray-500 text-sm">Elite</p>
                                        <p class="text-xs text-gray-400">Zlatna, ekskluzivna</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Izaberite vizuelni stil vase javne stranice</p>
                    </div>

                    <hr class="border-gray-200">

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Logo URL</label>
                        <input type="url" x-model="publicProfile.logo_url" maxlength="500"
                               placeholder="https://..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Link do vaseg loga (preporucena velicina: 200x200px)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cover slika URL</label>
                        <input type="url" x-model="publicProfile.cover_image_url" maxlength="500"
                               placeholder="https://..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Header slika za javnu stranicu (preporucena velicina: 1920x400px)</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Primarna boja</label>
                            <div class="flex items-center gap-3">
                                <input type="color" x-model="publicProfile.primary_color"
                                       class="w-12 h-10 rounded border border-gray-300 cursor-pointer">
                                <input type="text" x-model="publicProfile.primary_color" maxlength="7"
                                       placeholder="#3b82f6"
                                       class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sekundarna boja</label>
                            <div class="flex items-center gap-3">
                                <input type="color" x-model="publicProfile.secondary_color"
                                       class="w-12 h-10 rounded border border-gray-300 cursor-pointer">
                                <input type="text" x-model="publicProfile.secondary_color" maxlength="7"
                                       placeholder="#1e40af"
                                       class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Social Sub-tab -->
                <div x-show="publicSubTab === 'social'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Facebook</label>
                            <input type="url" x-model="publicProfile.facebook_url" maxlength="300"
                                   placeholder="https://facebook.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Instagram</label>
                            <input type="url" x-model="publicProfile.instagram_url" maxlength="300"
                                   placeholder="https://instagram.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">YouTube</label>
                            <input type="url" x-model="publicProfile.youtube_url" maxlength="300"
                                   placeholder="https://youtube.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">TikTok</label>
                            <input type="url" x-model="publicProfile.tiktok_url" maxlength="300"
                                   placeholder="https://tiktok.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">LinkedIn</label>
                            <input type="url" x-model="publicProfile.linkedin_url" maxlength="300"
                                   placeholder="https://linkedin.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Website</label>
                            <input type="url" x-model="publicProfile.website_url" maxlength="300"
                                   placeholder="https://..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Pricing Sub-tab -->
                <div x-show="publicSubTab === 'pricing'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900">Prikazi cenovnik na javnoj stranici</p>
                            <p class="text-sm text-gray-500">Kada je ukljuceno, usluge iz cenovnika ce biti vidljive posetiocima</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" x-model="publicProfile.show_prices" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Napomena o cenama</label>
                        <textarea x-model="publicProfile.price_disclaimer" rows="2" maxlength="500"
                                  placeholder="Cene su okvirne i podlozne promenama nakon dijagnostike."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Ova napomena ce se prikazati ispod cenovnika</p>
                    </div>
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-start gap-3">
                            <svg class="w-5 h-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div class="text-sm text-blue-800">
                                <p class="font-medium">Usluge za cenovnik</p>
                                <p>Usluge koje se prikazuju na javnoj stranici mozete podesiti u <a href="/pricing" class="underline hover:no-underline">Cenovniku</a>. Prikazuju se samo aktivne usluge.</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- SEO Sub-tab -->
                <div x-show="publicSubTab === 'seo'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">SEO podesavanja pomazu da vasa stranica bude bolje rangirana na Google pretrazi.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Meta naslov</label>
                        <input type="text" x-model="publicProfile.meta_title" maxlength="100"
                               placeholder="Servis mobilnih telefona - Vas Grad"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Naslov koji se prikazuje u Google rezultatima (max 60 karaktera)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Meta opis</label>
                        <textarea x-model="publicProfile.meta_description" rows="2" maxlength="200"
                                  placeholder="Profesionalan servis mobilnih telefona i racunara. Brza dijagnostika, kvalitetne popravke, garancija na rad."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Opis koji se prikazuje u Google rezultatima (max 160 karaktera)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kljucne reci</label>
                        <input type="text" x-model="publicProfile.meta_keywords" maxlength="300"
                               placeholder="servis mobilnih, popravka telefona, zamena ekrana, beograd"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Razdvojene zarezom</p>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Sections Sub-tab (NEW v2) -->
                <div x-show="publicSubTab === 'sections'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">

                    <!-- WhatsApp Settings -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-green-50 px-4 py-3 border-b border-green-200">
                            <h4 class="font-medium text-green-900 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                                </svg>
                                WhatsApp dugme
                            </h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi WhatsApp dugme</p>
                                    <p class="text-sm text-gray-500">Floating dugme u donjem desnom uglu</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_whatsapp_button" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_whatsapp_button" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">WhatsApp broj</label>
                                    <input type="tel" x-model="publicProfile.whatsapp_number"
                                           placeholder="381641234567"
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                                    <p class="text-xs text-gray-500 mt-1">Bez + ili razmaka, npr: 381641234567</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Predefinisana poruka</label>
                                    <input type="text" x-model="publicProfile.whatsapp_message" maxlength="300"
                                           placeholder="Zdravo! Imam pitanje..."
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Tracking Widget -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-blue-50 px-4 py-3 border-b border-blue-200">
                            <h4 class="font-medium text-blue-900">Status Tracking Widget</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi widget za pracenje statusa</p>
                                    <p class="text-sm text-gray-500">Omogucava korisnicima da provere status naloga sa pocetne strane</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_tracking_widget" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_tracking_widget">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Naslov widgeta</label>
                                <input type="text" x-model="publicProfile.tracking_widget_title" maxlength="200"
                                       placeholder="Pratite status popravke"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Brands Section -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-purple-50 px-4 py-3 border-b border-purple-200">
                            <h4 class="font-medium text-purple-900">Brendovi koje servisirate</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi sekciju brendova</p>
                                    <p class="text-sm text-gray-500">Prikazuje grid sa logotipima brendova</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_brands_section" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_brands_section">
                                <label class="block text-sm font-medium text-gray-700 mb-3">Izaberite brendove</label>
                                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                                    <template x-for="brand in ['apple', 'samsung', 'xiaomi', 'huawei', 'google', 'oneplus', 'motorola', 'oppo', 'vivo', 'realme', 'lenovo', 'hp', 'dell', 'asus', 'acer', 'msi']">
                                        <label class="flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"
                                               :class="publicProfile.supported_brands.includes(brand) ? 'border-purple-500 bg-purple-50' : 'border-gray-200'">
                                            <input type="checkbox"
                                                   :checked="publicProfile.supported_brands.includes(brand)"
                                                   @change="toggleBrand(brand)"
                                                   class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                            <span class="text-sm font-medium capitalize" x-text="brand"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Process Section -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-orange-50 px-4 py-3 border-b border-orange-200">
                            <h4 class="font-medium text-orange-900">Proces rada</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi sekciju procesa</p>
                                    <p class="text-sm text-gray-500">Prikazuje korake servisa (Prijem → Dijagnostika → Popravka → Preuzimanje)</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_process_section" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_process_section">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Naslov sekcije</label>
                                <input type="text" x-model="publicProfile.process_title" maxlength="200"
                                       placeholder="Kako funkcionise"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500">
                                <p class="text-xs text-gray-500 mt-2">Koraci procesa su predefinisani i prikazuju standardni servisni tok.</p>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Section -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-cyan-50 px-4 py-3 border-b border-cyan-200 flex items-center justify-between">
                            <h4 class="font-medium text-cyan-900">Cesto postavljana pitanja (FAQ)</h4>
                            <button type="button" @click="addFaqItem()"
                                    class="text-sm px-3 py-1 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700">
                                + Dodaj pitanje
                            </button>
                        </div>
                        <div class="p-4 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Naslov sekcije</label>
                                <input type="text" x-model="publicProfile.faq_title" maxlength="200"
                                       placeholder="Cesto postavljana pitanja"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500">
                            </div>

                            <div x-show="publicProfile.faq_items.length === 0" class="text-center py-6 text-gray-500">
                                <p>Nema dodatih pitanja.</p>
                                <p class="text-sm">Kliknite "Dodaj pitanje" da dodate prvo FAQ.</p>
                            </div>

                            <div class="space-y-3">
                                <template x-for="(item, index) in publicProfile.faq_items" :key="index">
                                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                        <div class="flex items-start justify-between mb-3">
                                            <span class="text-xs font-medium text-gray-500">Pitanje #<span x-text="index + 1"></span></span>
                                            <button type="button" @click="removeFaqItem(index)"
                                                    class="text-red-600 hover:text-red-700 text-sm">
                                                Ukloni
                                            </button>
                                        </div>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Pitanje</label>
                                                <input type="text" x-model="publicProfile.faq_items[index].question"
                                                       placeholder="Npr: Koliko traje popravka?"
                                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Odgovor</label>
                                                <textarea x-model="publicProfile.faq_items[index].answer" rows="2"
                                                          placeholder="Odgovor na pitanje..."
                                                          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Suggested FAQs -->
                            <div class="p-3 bg-cyan-50 border border-cyan-200 rounded-lg">
                                <p class="text-sm font-medium text-cyan-900 mb-2">Predlozena pitanja za servis:</p>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" @click="addSuggestedFaq('Koliko traje popravka telefona?', 'Vreme popravke zavisi od vrste kvara. Vecina popravki se zavrsi istog dana ili u roku od 24-48 sati.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Koliko traje popravka?
                                    </button>
                                    <button type="button" @click="addSuggestedFaq('Da li dobijam garanciju na popravku?', 'Da, na sve nase popravke dajemo garanciju. Trajanje garancije zavisi od vrste popravke.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Garancija?
                                    </button>
                                    <button type="button" @click="addSuggestedFaq('Koliko kosta dijagnostika?', 'Dijagnostika je besplatna ako se odlucite za popravku. U suprotnom, naplacuje se minimalna naknada.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Cena dijagnostike?
                                    </button>
                                    <button type="button" @click="addSuggestedFaq('Da li mogu da pratim status popravke?', 'Da, mozete pratiti status vase popravke putem koda koji dobijate prilikom prijema uredjaja.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Pracenje statusa?
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj sve sekcije</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Custom Domain Sub-tab -->
                <div x-show="publicSubTab === 'domain'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-medium text-blue-900 mb-2">Sta je custom domen?</h4>
                        <p class="text-sm text-blue-800">Pored automatske subdomena (<span x-text="tenantSlug"></span>.shub.rs), mozete povezati svoj domen (npr. mojservis.rs) da bi vasa javna stranica bila dostupna na njemu.</p>
                    </div>

                    <!-- Domain DNS section glass overrides -->
                    <style>
                        .glass-theme .domain-section { background: var(--glass-card) !important; border-color: var(--glass-border) !important; }
                        .glass-theme .domain-dns-body { background: rgba(15, 23, 42, 0.5) !important; }
                        .glass-theme .dns-card { background: rgba(30, 41, 59, 0.6) !important; border-color: var(--glass-border) !important; backdrop-filter: blur(8px); }
                        .glass-theme .dns-card-header-a { background: rgba(99, 102, 241, 0.15) !important; border-color: rgba(99, 102, 241, 0.2) !important; }
                        .glass-theme .dns-card-header-b { background: rgba(16, 185, 129, 0.15) !important; border-color: rgba(16, 185, 129, 0.2) !important; }
                        .glass-theme .dns-card-header-route { background: rgba(139, 92, 246, 0.15) !important; border-color: rgba(139, 92, 246, 0.2) !important; }
                        .glass-theme .dns-code { background: rgba(15, 23, 42, 0.6) !important; color: #e2e8f0 !important; }
                        .glass-theme .dns-label { color: #94a3b8 !important; }
                        .glass-theme .dns-step-title { color: #f1f5f9 !important; }
                        .glass-theme .dns-step-desc { color: #94a3b8 !important; }
                        .glass-theme .dns-divider { border-color: var(--glass-border) !important; }
                        .glass-theme .dns-divider-text { color: #64748b !important; }
                        .glass-theme .dns-warning { background: rgba(245, 158, 11, 0.1) !important; border-color: rgba(245, 158, 11, 0.25) !important; }
                        .glass-theme .dns-warning p { color: #fbbf24 !important; }
                        .glass-theme .dns-card-header-a span.text-indigo-900 { color: #a5b4fc !important; }
                        .glass-theme .dns-card-header-a span.text-indigo-400 { color: rgba(165, 180, 252, 0.6) !important; }
                        .glass-theme .dns-card-header-b span.text-emerald-900 { color: #6ee7b7 !important; }
                        .glass-theme .dns-card-header-route span.text-violet-900 { color: #c4b5fd !important; }
                        .glass-theme .dns-card-header-route svg { color: #a78bfa !important; }
                        .glass-theme .domain-verify-btn { background: rgba(255,255,255,0.15) !important; color: #f1f5f9 !important; border: 1px solid rgba(255,255,255,0.2) !important; }
                        .glass-theme .domain-verify-btn:hover { background: rgba(255,255,255,0.25) !important; }
                    </style>

                    <!-- Current Domain Status -->
                    <div x-show="customDomain.domain" class="domain-section rounded-xl overflow-hidden shadow-sm border border-gray-200">
                        <!-- Domain Header -->
                        <div class="bg-gradient-to-r from-slate-800 to-slate-900 px-5 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418"/></svg>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-white text-base" x-text="customDomain.domain"></p>
                                        <div class="flex items-center gap-1.5 mt-0.5">
                                            <span x-show="customDomain.verified" class="inline-flex items-center gap-1 text-xs font-medium text-emerald-400">
                                                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd"/></svg>
                                                Verifikovan — SSL aktivan
                                            </span>
                                            <span x-show="!customDomain.verified" class="inline-flex items-center gap-1 text-xs font-medium text-amber-400">
                                                <svg class="w-3.5 h-3.5 animate-pulse" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd"/></svg>
                                                Ceka DNS verifikaciju
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button x-show="!customDomain.verified" @click="verifyDomain()" :disabled="verifyingDomain"
                                            class="domain-verify-btn px-4 py-2 bg-white text-slate-800 text-sm font-semibold rounded-lg hover:bg-gray-100 disabled:opacity-50 transition-colors shadow-sm">
                                        <span x-show="!verifyingDomain" class="flex items-center gap-1.5">
                                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                            Verifikuj
                                        </span>
                                        <span x-show="verifyingDomain" class="flex items-center gap-1.5">
                                            <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
                                            Proveravam...
                                        </span>
                                    </button>
                                    <button @click="removeDomain()" class="px-3 py-2 text-sm rounded-lg text-red-300 hover:text-white hover:bg-red-600/30 transition-colors">
                                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- DNS Instructions -->
                        <div x-show="!customDomain.verified && customDomain.verification_instructions" class="domain-dns-body">
                            <!-- Step indicator -->
                            <div class="px-5 pt-5 pb-3">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="flex items-center justify-center w-5 h-5 rounded-full bg-slate-800 text-[10px] font-bold text-white">1</span>
                                    <h5 class="dns-step-title font-semibold text-slate-800 text-sm">Verifikacija vlasnistva</h5>
                                </div>
                                <p class="dns-step-desc text-xs text-slate-500 ml-7">Dodajte jedan od sledecih DNS zapisa kod vaseg domen provajdera</p>
                            </div>

                            <div class="px-5 pb-4 space-y-2">
                                <!-- Option A: CNAME -->
                                <div class="dns-card bg-white rounded-lg border border-indigo-100 shadow-sm overflow-hidden">
                                    <div class="dns-card-header-a px-4 py-2.5 bg-indigo-50 border-b border-indigo-100 flex items-center gap-2">
                                        <span class="px-1.5 py-0.5 bg-indigo-600 text-white text-[10px] font-bold rounded">A</span>
                                        <span class="text-xs font-semibold text-indigo-900">CNAME record</span>
                                        <span class="ml-auto text-[10px] text-indigo-400 font-medium">PREPORUCENO</span>
                                    </div>
                                    <div class="px-4 py-3 space-y-2 text-sm">
                                        <div class="flex items-baseline gap-2">
                                            <span class="dns-label text-xs font-medium text-slate-400 uppercase w-16 shrink-0">Host</span>
                                            <code class="dns-code text-slate-800 bg-slate-100 px-2 py-0.5 rounded text-xs font-mono break-all" x-text="customDomain.verification_instructions?.host"></code>
                                        </div>
                                        <div class="flex items-baseline gap-2">
                                            <span class="dns-label text-xs font-medium text-slate-400 uppercase w-16 shrink-0">Vrednost</span>
                                            <code class="dns-code text-slate-800 bg-slate-100 px-2 py-0.5 rounded text-xs font-mono break-all" x-text="customDomain.verification_instructions?.value"></code>
                                        </div>
                                    </div>
                                </div>

                                <!-- Divider -->
                                <div class="flex items-center gap-3 py-0.5">
                                    <div class="dns-divider flex-1 border-t border-slate-200"></div>
                                    <span class="dns-divider-text text-[10px] font-semibold text-slate-400 uppercase tracking-wider">ili</span>
                                    <div class="dns-divider flex-1 border-t border-slate-200"></div>
                                </div>

                                <!-- Option B: TXT -->
                                <div class="dns-card bg-white rounded-lg border border-emerald-100 shadow-sm overflow-hidden">
                                    <div class="dns-card-header-b px-4 py-2.5 bg-emerald-50 border-b border-emerald-100 flex items-center gap-2">
                                        <span class="px-1.5 py-0.5 bg-emerald-600 text-white text-[10px] font-bold rounded">B</span>
                                        <span class="text-xs font-semibold text-emerald-900">TXT record</span>
                                    </div>
                                    <div class="px-4 py-3 space-y-2 text-sm">
                                        <div class="flex items-baseline gap-2">
                                            <span class="dns-label text-xs font-medium text-slate-400 uppercase w-16 shrink-0">Host</span>
                                            <code class="dns-code text-slate-800 bg-slate-100 px-2 py-0.5 rounded text-xs font-mono break-all" x-text="customDomain.verification_instructions?.alternative?.host"></code>
                                        </div>
                                        <div class="flex items-baseline gap-2">
                                            <span class="dns-label text-xs font-medium text-slate-400 uppercase w-16 shrink-0">Vrednost</span>
                                            <code class="dns-code text-slate-800 bg-slate-100 px-2 py-0.5 rounded text-xs font-mono break-all" x-text="customDomain.verification_instructions?.alternative?.value"></code>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: Routing -->
                            <div class="px-5 pb-3 pt-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="flex items-center justify-center w-5 h-5 rounded-full bg-slate-800 text-[10px] font-bold text-white">2</span>
                                    <h5 class="dns-step-title font-semibold text-slate-800 text-sm">Usmeravanje saobracaja</h5>
                                </div>
                                <p class="dns-step-desc text-xs text-slate-500 ml-7">Usmerite vas domen ka ServisHub platformi</p>
                            </div>

                            <div class="px-5 pb-5">
                                <div class="dns-card bg-white rounded-lg border border-violet-100 shadow-sm overflow-hidden">
                                    <div class="dns-card-header-route px-4 py-2.5 bg-violet-50 border-b border-violet-100 flex items-center gap-2">
                                        <svg class="w-3.5 h-3.5 text-violet-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M12.207 2.232a.75.75 0 00.025 1.06l4.146 3.958H6.375a5.375 5.375 0 000 10.75H9.25a.75.75 0 000-1.5H6.375a3.875 3.875 0 010-7.75h10.003l-4.146 3.957a.75.75 0 001.036 1.085l5.5-5.25a.75.75 0 000-1.085l-5.5-5.25a.75.75 0 00-1.06.025z" clip-rule="evenodd"/></svg>
                                        <span class="text-xs font-semibold text-violet-900">CNAME record</span>
                                    </div>
                                    <div class="px-4 py-3 space-y-2 text-sm">
                                        <div class="flex items-baseline gap-2">
                                            <span class="dns-label text-xs font-medium text-slate-400 uppercase w-16 shrink-0">Host</span>
                                            <code class="dns-code text-slate-800 bg-slate-100 px-2 py-0.5 rounded text-xs font-mono break-all" x-text="customDomain.verification_instructions?.routing?.host || customDomain.domain"></code>
                                        </div>
                                        <div class="flex items-baseline gap-2">
                                            <span class="dns-label text-xs font-medium text-slate-400 uppercase w-16 shrink-0">Vrednost</span>
                                            <code class="dns-code text-slate-800 bg-slate-100 px-2 py-0.5 rounded text-xs font-mono break-all" x-text="customDomain.verification_instructions?.routing?.value || 'proxy.shub.rs'"></code>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Footer note -->
                            <div class="px-5 pb-4">
                                <div class="dns-warning flex items-start gap-2 px-3 py-2.5 bg-amber-50 border border-amber-200 rounded-lg">
                                    <svg class="w-4 h-4 text-amber-500 mt-0.5 shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                                    <p class="text-xs text-amber-800 leading-relaxed">DNS promene mogu potrajati <strong>do 24 sata</strong> da se propagiraju. Nakon podesavanja, kliknite <strong>Verifikuj</strong>.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add New Domain -->
                    <div x-show="!customDomain.domain" class="border rounded-lg overflow-hidden">
                        <div class="bg-gray-50 px-4 py-3 border-b">
                            <h4 class="font-medium text-gray-900">Dodaj custom domen</h4>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-3">
                                <input type="text" x-model="newDomainInput" placeholder="mojservis.rs"
                                       class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                                <button @click="setupDomain()" :disabled="settingUpDomain || !newDomainInput"
                                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                                    <span x-show="!settingUpDomain">Dodaj</span>
                                    <span x-show="settingUpDomain">Dodajem...</span>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Unesite domen bez http:// ili www. (npr. mojservis.rs)</p>
                        </div>
                    </div>
                </div>

                <!-- ==================== GOOGLE REVIEWS SUB-TAB ==================== -->
                <div x-show="publicSubTab === 'google'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">

                    <!-- Info Box -->
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-start gap-3">
                            <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                            <div>
                                <h4 class="font-medium text-blue-900 mb-1">Google Business recenzije</h4>
                                <p class="text-sm text-blue-800">Povezite vas Google Business profil da bi se vase recenzije i ocena automatski prikazivali na javnoj stranici.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Connected Status -->
                    <div x-show="googleIntegration.is_connected" class="bg-green-50 border border-green-200 rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm">
                                    <svg class="w-7 h-7" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-green-900">Povezano sa Google</h4>
                                    <p class="text-sm text-green-700">Recenzije se automatski prikazuju</p>
                                </div>
                            </div>
                            <button @click="disconnectGoogle()" class="px-3 py-1.5 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors">
                                Prekini vezu
                            </button>
                        </div>

                        <!-- Stats -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-white rounded-lg p-4 text-center">
                                <div class="flex items-center justify-center gap-1 mb-1">
                                    <span class="text-2xl font-bold text-gray-900" x-text="googleIntegration.integration?.google_rating || '-'"></span>
                                    <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                                </div>
                                <p class="text-xs text-gray-500">Prosecna ocena</p>
                            </div>
                            <div class="bg-white rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-gray-900" x-text="googleIntegration.integration?.total_reviews || 0"></div>
                                <p class="text-xs text-gray-500">Ukupno recenzija</p>
                            </div>
                        </div>

                        <!-- Sync button -->
                        <button @click="syncGoogleReviews()" :disabled="googleSyncing"
                                class="w-full py-2 text-sm text-green-700 hover:bg-green-100 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2">
                            <svg x-show="!googleSyncing" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                            <svg x-show="googleSyncing" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            <span x-text="googleSyncing ? 'Osvezavam...' : 'Osvezi recenzije'"></span>
                        </button>
                    </div>

                    <!-- Not Connected - Search -->
                    <div x-show="!googleIntegration.is_connected" class="border rounded-xl overflow-hidden">
                        <div class="bg-gray-50 px-4 py-3 border-b">
                            <h4 class="font-medium text-gray-900">Pronadjite vas biznis na Google</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <!-- Search Input -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Pretrazite po imenu</label>
                                <div class="flex gap-2">
                                    <input type="text" x-model="googleSearchQuery"
                                           :placeholder="profile.name || 'Naziv vaseg biznisa'"
                                           @keyup.enter="searchGooglePlace()"
                                           class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                                    <button @click="searchGooglePlace()" :disabled="googleSearching"
                                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2">
                                        <svg x-show="!googleSearching" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                                        <svg x-show="googleSearching" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                        Trazi
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Unesite ime biznisa kao sto je prikazano na Google Maps</p>
                            </div>

                            <!-- Search Results List -->
                            <div x-show="googleSearchResults.length > 0" class="space-y-2 max-h-64 overflow-y-auto">
                                <template x-for="place in googleSearchResults" :key="place.place_id">
                                    <div @click="selectGooglePlace(place)"
                                         class="border rounded-lg p-3 cursor-pointer transition-all"
                                         :class="googleSelectedPlace?.place_id === place.place_id
                                             ? 'border-green-500 bg-green-50'
                                             : 'border-gray-200 hover:border-green-300 hover:bg-gray-50'">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h5 class="font-medium text-gray-900" x-text="place.name"></h5>
                                                <p class="text-sm text-gray-600" x-text="place.address"></p>
                                                <div class="flex items-center gap-2 mt-1" x-show="place.rating">
                                                    <div class="flex items-center gap-1">
                                                        <span class="text-sm font-semibold" x-text="place.rating"></span>
                                                        <svg class="w-3.5 h-3.5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                                                    </div>
                                                    <span class="text-xs text-gray-500" x-show="place.reviews_count">(<span x-text="place.reviews_count"></span> recenzija)</span>
                                                </div>
                                            </div>
                                            <div x-show="googleSelectedPlace?.place_id === place.place_id" class="text-green-600">
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Selected Place - Connect Button -->
                            <div x-show="googleSelectedPlace" class="mt-3 flex justify-end">
                                <button @click="connectGooglePlace()" :disabled="googleConnecting"
                                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2">
                                    <svg x-show="!googleConnecting" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                                    <svg x-show="googleConnecting" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                    <span x-text="googleConnecting ? 'Povezujem...' : 'Povezi izabrani biznis'"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== USER MODAL ==================== -->
    <div x-show="userModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-black/50" @click="userModal = false"></div>
            <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full mx-auto p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4" x-text="editingUser ? 'Izmeni korisnika' : 'Novi korisnik'"></h2>

                <form @submit.prevent="saveUser()">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ime *</label>
                                <input type="text" x-model="userForm.ime" required
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Prezime *</label>
                                <input type="text" x-model="userForm.prezime" required
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" x-model="userForm.email" required :disabled="editingUser"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50">
                        </div>
                        <div x-show="!editingUser">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Lozinka *</label>
                            <input type="password" x-model="userForm.password" :required="!editingUser" minlength="6"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="text" x-model="userForm.phone"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rola</label>
                            <select x-model="userForm.role"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                                <option value="TECHNICIAN">Serviser</option>
                                <option value="RECEPTIONIST">Recepcionar</option>
                                <option value="MANAGER">Menadzer</option>
                                <option value="ADMIN">Administrator</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex gap-3 mt-6">
                        <button type="button" @click="userModal = false"
                                class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Otkazi
                        </button>
                        <button type="submit" :disabled="saving"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                            <span x-show="!saving">Sacuvaj</span>
                            <span x-show="saving">Cuvam...</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==================== LOCATION MODAL ==================== -->
    <div x-show="locationModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-black/50" @click="locationModal = false"></div>
            <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full mx-auto p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4" x-text="editingLocation ? 'Izmeni lokaciju' : 'Nova lokacija'"></h2>

                <form @submit.prevent="saveLocation()">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Naziv *</label>
                            <input type="text" x-model="locationForm.name" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Adresa</label>
                            <input type="text" x-model="locationForm.address"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Grad</label>
                                <input type="text" x-model="locationForm.city"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Postanski broj</label>
                                <input type="text" x-model="locationForm.postal_code"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="text" x-model="locationForm.phone"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" x-model="locationForm.email"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div class="flex gap-3 mt-6">
                        <button type="button" @click="locationModal = false"
                                class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Otkazi
                        </button>
                        <button type="submit" :disabled="saving"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                            <span x-show="!saving">Sacuvaj</span>
                            <span x-show="saving">Cuvam...</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- SMS Enable Modal with Disclaimer -->
    <div x-show="smsModal" x-cloak
         class="fixed inset-0 z-50 overflow-y-auto"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0">
            <!-- Backdrop -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75" @click="closeSmsModal()"></div>

            <!-- Modal -->
            <div class="relative bg-white rounded-xl shadow-xl transform transition-all sm:max-w-lg sm:w-full"
                 @click.stop
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">

                <!-- Header -->
                <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 rounded-t-xl">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="bg-white/20 p-2 rounded-lg">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-white">Aktivacija SMS Notifikacija</h3>
                        </div>
                        <button @click="closeSmsModal()" class="text-white/80 hover:text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Body -->
                <div class="px-6 py-5">
                    <!-- Warning Box -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-5">
                        <div class="flex items-start gap-3">
                            <svg class="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                            <div>
                                <h4 class="text-sm font-semibold text-yellow-800">Važno obaveštenje o naplati</h4>
                                <p class="text-sm text-yellow-700 mt-1">SMS notifikacije se naplaćuju iz vašeg kredit računa.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Info -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm text-gray-600">Cena po SMS-u:</span>
                            <span class="font-semibold text-gray-900" x-text="smsSettings.sms_cost_credits + ' kredita'"></span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm text-gray-600">Vrednost kredita:</span>
                            <span class="font-semibold text-gray-900">1 kredit = 1 EUR</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <span class="text-sm text-gray-600">Vaše stanje:</span>
                            <span class="font-semibold text-green-700" x-text="smsSettings.credit_balance?.toFixed(2) + ' kredita'"></span>
                        </div>
                    </div>

                    <!-- What happens -->
                    <div class="mt-5 pt-5 border-t border-gray-200">
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Šta se dešava nakon aktivacije:</h4>
                        <ul class="space-y-2">
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <svg class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span>SMS se automatski šalje kada je nalog spreman</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <svg class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span>Podsećanje se šalje nakon 10 i 30 dana (opciono)</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <svg class="w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                </svg>
                                <span>Kredit se skida sa računa pri svakom poslatom SMS-u</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <svg class="w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                </svg>
                                <span>Možete isključiti notifikacije u bilo kom trenutku</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Footer -->
                <div class="bg-gray-50 px-6 py-4 rounded-b-xl flex items-center justify-end gap-3">
                    <button @click="closeSmsModal()"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                        Odustani
                    </button>
                    <button @click="enableSms()" :disabled="smsEnabling"
                            class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2">
                        <template x-if="smsEnabling">
                            <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </template>
                        <span x-text="smsEnabling ? 'Aktiviram...' : 'Prihvatam i aktiviram'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
function settingsPage() {
    return {
        // State
        loading: true,
        saving: false,
        savingPublic: false,
        changingPassword: false,
        uploadingLogo: false,
        uploadingIdFront: false,
        uploadingIdBack: false,
        activeTab: new URLSearchParams(window.location.search).get('tab') || 'settings',
        currentTheme: localStorage.getItem('shub-theme') || 'light',

        // Current user info
        currentUser: { id: null, ime: '', prezime: '', email: '', role: '' },
        passwordForm: { current_password: '', new_password: '', confirm_password: '' },

        // Modals
        userModal: false,
        locationModal: false,
        editingUser: null,
        editingLocation: null,

        // Data
        profile: {},
        settings: {},
        subscription: {},
        users: [],
        locations: [],
        kyc: {},
        loginInfo: { login_url: '', login_secret: '' },

        // Public Profile
        publicProfile: {
            is_public: false,
            display_name: '',
            tagline: '',
            description: '',
            phone: '',
            phone_secondary: '',
            email: '',
            address: '',
            city: '',
            postal_code: '',
            maps_url: '',
            maps_embed_url: '',
            working_hours: {
                mon_open: '09:00', mon_close: '17:00', mon_closed: false,
                tue_open: '09:00', tue_close: '17:00', tue_closed: false,
                wed_open: '09:00', wed_close: '17:00', wed_closed: false,
                thu_open: '09:00', thu_close: '17:00', thu_closed: false,
                fri_open: '09:00', fri_close: '17:00', fri_closed: false,
                sat_open: '09:00', sat_close: '14:00', sat_closed: false,
                sun_open: '', sun_close: '', sun_closed: true
            },
            logo_url: '',
            cover_image_url: '',
            primary_color: '#3b82f6',
            secondary_color: '#1e40af',
            facebook_url: '',
            instagram_url: '',
            youtube_url: '',
            tiktok_url: '',
            linkedin_url: '',
            website_url: '',
            show_prices: true,
            price_disclaimer: '',
            meta_title: '',
            meta_description: '',
            meta_keywords: '',
            about_title: '',
            about_content: '',
            // New v2 fields
            faq_title: 'Često postavljana pitanja',
            faq_items: [],
            show_brands_section: true,
            supported_brands: [],
            show_process_section: true,
            process_title: 'Kako funkcioniše',
            process_steps: [],
            show_whatsapp_button: false,
            whatsapp_number: '',
            whatsapp_message: 'Zdravo! Imam pitanje u vezi servisa.',
            show_tracking_widget: true,
            tracking_widget_title: 'Pratite status popravke',
            hero_style: 'centered'
        },
        publicSubTab: 'basic',
        tenantSlug: '',
        publicPageUrls: { subdomain: '', custom_domain: null },
        customDomain: { domain: null, verified: false, verification_instructions: null },
        qrCode: null,
        newDomainInput: '',
        settingUpDomain: false,
        verifyingDomain: false,

        // Google Integration
        googleIntegration: { is_connected: false, integration: null },
        googleSearchQuery: '',
        googleSearchResults: [],
        googleSelectedPlace: null,
        googleSearching: false,
        googleConnecting: false,
        googleSyncing: false,

        // SMS Billing
        smsSettings: {
            sms_enabled: false,
            consent_given: false,
            credit_balance: 0,
            sms_cost_credits: 0.20,
            can_send_sms: false,
            activated_at: null
        },
        smsModal: false,
        smsEnabling: false,
        smsDisabling: false,

        // Forms
        userForm: {},
        locationForm: {},
        kycForm: {},

        async init() {
            // Apply saved theme on init
            this.applyTheme(this.currentTheme);
            await this.loadCurrentUser();
            await this.loadAll();

            // Watch for tab changes to initialize Google autocomplete when public_page tab is shown
            this.$watch('activeTab', (value) => {
                if (value === 'public_page') {
                    // Small delay to ensure DOM is updated
                    setTimeout(() => {
                        if (typeof initGoogleMapsAutocomplete === 'function' && !window._googleAutocompleteInitialized) {
                            initGoogleMapsAutocomplete();
                        }
                    }, 100);
                }
            });

            // Also check if we're already on public_page tab
            if (this.activeTab === 'public_page') {
                setTimeout(() => {
                    if (typeof initGoogleMapsAutocomplete === 'function' && !window._googleAutocompleteInitialized) {
                        initGoogleMapsAutocomplete();
                    }
                }, 100);
            }
        },

        // Check if current user is admin (OWNER, ADMIN, MANAGER)
        isAdmin() {
            const adminRoles = ['OWNER', 'ADMIN', 'MANAGER'];
            return adminRoles.includes(this.currentUser.role);
        },

        async loadCurrentUser() {
            try {
                const response = await api('/auth/me');
                if (response.ok) {
                    const data = await response.json();
                    this.currentUser = data.user;
                }
            } catch (e) {
                console.error('Failed to load current user:', e);
            }
        },

        async changeMyPassword() {
            if (this.passwordForm.new_password !== this.passwordForm.confirm_password) {
                showToast('Šifre se ne poklapaju', 'error');
                return;
            }

            this.changingPassword = true;
            try {
                const response = await api('/auth/change-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        current_password: this.passwordForm.current_password,
                        new_password: this.passwordForm.new_password
                    })
                });

                if (response.ok) {
                    showToast('Šifra uspešno promenjena', 'success');
                    this.passwordForm = { current_password: '', new_password: '', confirm_password: '' };
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Greška pri promeni šifre', 'error');
                }
            } catch (e) {
                console.error('Failed to change password:', e);
                showToast('Greška pri promeni šifre', 'error');
            } finally {
                this.changingPassword = false;
            }
        },

        setTheme(theme) {
            this.currentTheme = theme;
            localStorage.setItem('shub-theme', theme);
            this.applyTheme(theme);
            showToast(theme === 'glass' ? 'Glassmorphism tema aktivirana' : 'Svetla tema aktivirana', 'success');
        },

        applyTheme(theme) {
            if (theme === 'glass') {
                document.documentElement.classList.add('glass-theme');
            } else {
                document.documentElement.classList.remove('glass-theme');
            }
        },

        async loadAll() {
            this.loading = true;
            try {
                const [profileRes, settingsRes, subscriptionRes, usersRes, locationsRes, kycRes, publicRes, loginInfoRes] = await Promise.all([
                    api('/tenant/profile'),
                    api('/tenant/settings'),
                    api('/tenant/subscription'),
                    api('/users'),
                    api('/locations'),
                    api('/tenant/kyc'),
                    api('/tenant/public-profile'),
                    api('/tenant/login-info')
                ]);

                if (profileRes.ok) this.profile = await profileRes.json();
                if (settingsRes.ok) this.settings = await settingsRes.json();
                if (subscriptionRes.ok) this.subscription = await subscriptionRes.json();
                if (usersRes.ok) {
                    const usersData = await usersRes.json();
                    this.users = usersData.users || [];
                }
                if (locationsRes.ok) {
                    const locationsData = await locationsRes.json();
                    this.locations = locationsData.locations || [];
                }
                if (kycRes.ok) {
                    const kycData = await kycRes.json();
                    this.kyc = kycData;
                    // Init KYC form
                    if (kycData.representative) {
                        this.kycForm = { ...kycData.representative };
                    }
                }
                if (loginInfoRes.ok) {
                    this.loginInfo = await loginInfoRes.json();
                }

                // Load SMS settings separately (not critical for page load)
                this.loadSmsSettings();

                if (publicRes.ok) {
                    const publicData = await publicRes.json();
                    this.tenantSlug = publicData.tenant_slug || '';
                    this.publicPageUrls.subdomain = publicData.subdomain_url || `https://${this.tenantSlug}.shub.rs`;
                    this.publicPageUrls.custom_domain = publicData.custom_domain_url || null;

                    // Use tenant profile data as defaults for empty fields
                    const tenantDefaults = {
                        display_name: this.profile.name || '',
                        phone: this.profile.telefon || '',
                        email: this.profile.email || '',
                        address: this.profile.adresa_sedista || ''
                    };

                    if (publicData.exists && publicData.profile) {
                        const p = publicData.profile;
                        // Flatten profile data for form binding, using tenant data as fallback
                        this.publicProfile = {
                            is_public: p.is_public || false,
                            display_name: p.display_name || tenantDefaults.display_name,
                            tagline: p.tagline || '',
                            description: p.description || '',
                            phone: p.contact?.phone || tenantDefaults.phone,
                            phone_secondary: p.contact?.phone_secondary || '',
                            email: p.contact?.email || tenantDefaults.email,
                            address: p.contact?.address || tenantDefaults.address,
                            city: p.contact?.city || '',
                            postal_code: p.contact?.postal_code || '',
                            maps_url: p.contact?.maps_url || '',
                            maps_embed_url: p.contact?.maps_embed_url || '',
                            working_hours: this.parseWorkingHours(p.working_hours),
                            logo_url: p.branding?.logo_url || '',
                            cover_image_url: p.branding?.cover_image_url || '',
                            primary_color: p.branding?.primary_color || '#3b82f6',
                            secondary_color: p.branding?.secondary_color || '#1e40af',
                            facebook_url: p.social?.facebook || '',
                            instagram_url: p.social?.instagram || '',
                            youtube_url: p.social?.youtube || '',
                            tiktok_url: p.social?.tiktok || '',
                            linkedin_url: p.social?.linkedin || '',
                            website_url: p.social?.website || '',
                            show_prices: p.pricing?.show_prices !== false,
                            price_disclaimer: p.pricing?.disclaimer || '',
                            meta_title: p.seo?.meta_title || '',
                            meta_description: p.seo?.meta_description || '',
                            meta_keywords: p.seo?.meta_keywords || '',
                            about_title: p.sections?.about_title || '',
                            about_content: p.sections?.about_content || '',
                            // New v2 fields - these come from separate groups in API response
                            faq_title: p.faq?.title || 'Često postavljana pitanja',
                            faq_items: p.faq?.items || [],
                            show_brands_section: p.brands?.show_section !== false,
                            supported_brands: p.brands?.supported || [],
                            show_process_section: p.process?.show_section !== false,
                            process_title: p.process?.title || 'Kako funkcioniše',
                            process_steps: p.process?.steps || [],
                            show_whatsapp_button: p.whatsapp?.show_button || false,
                            whatsapp_number: p.whatsapp?.number || '',
                            whatsapp_message: p.whatsapp?.message || 'Zdravo! Imam pitanje u vezi servisa.',
                            show_tracking_widget: p.tracking?.show_widget !== false,
                            tracking_widget_title: p.tracking?.title || 'Pratite status popravke',
                            hero_style: p.hero_style || 'centered',
                            theme: p.theme || 'premium'
                        };
                        // Custom domain data
                        if (p.custom_domain) {
                            this.customDomain = {
                                domain: p.custom_domain.domain || null,
                                verified: p.custom_domain.verified || false,
                                verification_instructions: p.custom_domain.verification_instructions || null
                            };
                            if (p.custom_domain.verified && p.custom_domain.domain) {
                                this.publicPageUrls.custom_domain = `https://${p.custom_domain.domain}`;
                            }
                        }
                    } else {
                        // Public profile doesn't exist yet - use tenant profile data as defaults
                        this.publicProfile = {
                            ...this.publicProfile,
                            display_name: tenantDefaults.display_name,
                            phone: tenantDefaults.phone,
                            email: tenantDefaults.email,
                            address: tenantDefaults.address
                        };
                    }
                }

                // Load Google integration status
                await this.loadGoogleIntegration();
            } catch (e) {
                console.error('Failed to load data:', e);
                showToast('Greska pri ucitavanju', 'error');
            } finally {
                this.loading = false;
            }
        },

        async saveProfile() {
            this.saving = true;
            try {
                const response = await api('/tenant/profile', 'PUT', {
                    name: this.profile.name,
                    email: this.profile.email,
                    telefon: this.profile.telefon,
                    adresa_sedista: this.profile.adresa_sedista
                });
                if (response.ok) {
                    showToast('Profil sacuvan', 'success');
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri cuvanju', 'error');
                }
            } catch (e) {
                showToast('Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        // ============ SMS Billing Functions ============

        async loadSmsSettings() {
            try {
                const response = await api('/tenant/sms/settings');
                if (response.ok) {
                    this.smsSettings = await response.json();
                }
            } catch (e) {
                console.error('Failed to load SMS settings:', e);
            }
        },

        openSmsEnableModal() {
            if (this.smsSettings.credit_balance < this.smsSettings.sms_cost_credits) {
                showToast('Nemate dovoljno kredita. Dopunite kredit račun pre aktivacije.', 'error');
                return;
            }
            this.smsModal = true;
        },

        closeSmsModal() {
            this.smsModal = false;
        },

        async enableSms() {
            this.smsEnabling = true;
            try {
                const response = await api('/tenant/sms/enable', 'POST', { consent: true });
                const data = await response.json();

                if (response.ok) {
                    this.smsSettings.sms_enabled = true;
                    this.smsSettings.consent_given = true;
                    this.smsSettings.can_send_sms = true;
                    this.smsSettings.credit_balance = data.credit_balance;
                    this.smsModal = false;
                    showToast('SMS notifikacije aktivirane', 'success');
                } else {
                    showToast(data.error || 'Greška pri aktivaciji SMS', 'error');
                }
            } catch (e) {
                console.error('Enable SMS error:', e);
                showToast('Greška pri aktivaciji SMS', 'error');
            } finally {
                this.smsEnabling = false;
            }
        },

        async disableSms() {
            if (!confirm('Da li ste sigurni da želite da isključite SMS notifikacije?')) return;

            this.smsDisabling = true;
            try {
                const response = await api('/tenant/sms/disable', 'POST');
                const data = await response.json();

                if (response.ok) {
                    this.smsSettings.sms_enabled = false;
                    this.smsSettings.can_send_sms = false;
                    showToast('SMS notifikacije isključene', 'success');
                } else {
                    showToast(data.error || 'Greška pri isključivanju SMS', 'error');
                }
            } catch (e) {
                console.error('Disable SMS error:', e);
                showToast('Greška pri isključivanju SMS', 'error');
            } finally {
                this.smsDisabling = false;
            }
        },

        // ============ Logo Upload Functions ============

        async uploadLogo(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Client-side validation
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                showToast('Dozvoljeni formati: JPG, PNG, GIF, WebP', 'error');
                return;
            }

            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                showToast('Fajl je prevelik (max 5MB)', 'error');
                return;
            }

            this.uploadingLogo = true;
            try {
                const formData = new FormData();
                formData.append('logo', file);

                const response = await fetch('/api/v1/tenant/upload/logo', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + sessionStorage.getItem('access_token')
                    },
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    this.profile.logo_url = data.url;
                    showToast('Logo uspesno uploadovan', 'success');
                } else {
                    showToast(data.error || 'Greska pri uploadu', 'error');
                }
            } catch (e) {
                console.error('Upload error:', e);
                showToast('Greska pri uploadu loga', 'error');
            } finally {
                this.uploadingLogo = false;
                // Reset file input
                event.target.value = '';
            }
        },

        async deleteLogo() {
            if (!confirm('Da li ste sigurni da želite da obrišete logo?')) return;

            this.uploadingLogo = true;
            try {
                const response = await api('/tenant/upload/logo', 'DELETE');

                if (response.ok) {
                    this.profile.logo_url = null;
                    showToast('Logo obrisan', 'success');
                } else {
                    const data = await response.json();
                    showToast(data.error || 'Greška pri brisanju', 'error');
                }
            } catch (e) {
                console.error('Delete error:', e);
                showToast('Greška pri brisanju loga', 'error');
            } finally {
                this.uploadingLogo = false;
            }
        },

        // ============ ID Card Upload Functions ============

        async uploadIdCard(event, side) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showToast('Molimo izaberite sliku', 'error');
                return;
            }

            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('Maksimalna veličina je 5MB', 'error');
                return;
            }

            if (side === 'front') {
                this.uploadingIdFront = true;
            } else {
                this.uploadingIdBack = true;
            }

            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch(`/api/v1/tenant/upload/id-card/${side}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${getAccessToken()}`
                    },
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    // Update KYC data
                    if (!this.kyc.representative) {
                        this.kyc.representative = {};
                    }
                    if (side === 'front') {
                        this.kyc.representative.lk_front_url = data.url;
                    } else {
                        this.kyc.representative.lk_back_url = data.url;
                    }
                    showToast('Slika uploadovana', 'success');
                } else {
                    showToast(data.error || 'Greška pri uploadu', 'error');
                }
            } catch (e) {
                console.error('Upload error:', e);
                showToast('Greška pri uploadu', 'error');
            } finally {
                if (side === 'front') {
                    this.uploadingIdFront = false;
                } else {
                    this.uploadingIdBack = false;
                }
                event.target.value = '';
            }
        },

        async deleteIdCard(side) {
            if (!confirm('Da li ste sigurni da želite da obrišete sliku?')) return;

            if (side === 'front') {
                this.uploadingIdFront = true;
            } else {
                this.uploadingIdBack = true;
            }

            try {
                const response = await api(`/tenant/upload/id-card/${side}`, 'DELETE');

                if (response.ok) {
                    if (side === 'front') {
                        this.kyc.representative.lk_front_url = null;
                    } else {
                        this.kyc.representative.lk_back_url = null;
                    }
                    showToast('Slika obrisana', 'success');
                } else {
                    const data = await response.json();
                    showToast(data.error || 'Greška pri brisanju', 'error');
                }
            } catch (e) {
                console.error('Delete error:', e);
                showToast('Greška pri brisanju', 'error');
            } finally {
                if (side === 'front') {
                    this.uploadingIdFront = false;
                } else {
                    this.uploadingIdBack = false;
                }
            }
        },

        // ============ Login Link Functions ============

        async copyLoginUrl() {
            try {
                await navigator.clipboard.writeText(this.loginInfo.login_url);
                showToast('Link kopiran u clipboard', 'success');
            } catch (e) {
                // Fallback za starije browsere
                const input = document.createElement('input');
                input.value = this.loginInfo.login_url;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                showToast('Link kopiran u clipboard', 'success');
            }
        },

        async regenerateLoginSecret() {
            if (!confirm('Da li ste sigurni? Stari link za prijavu ce prestati da vazi i svi zaposleni ce morati da koriste novi link.')) {
                return;
            }

            try {
                const response = await api('/tenant/login-info/regenerate', 'POST');
                if (response.ok) {
                    const data = await response.json();
                    this.loginInfo.login_url = data.login_url;
                    this.loginInfo.login_secret = data.login_secret;
                    showToast('Novi link generisan', 'success');
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri generisanju', 'error');
                }
            } catch (e) {
                showToast('Greska pri generisanju', 'error');
            }
        },

        // ============ Google Integration Functions ============

        async loadGoogleIntegration() {
            try {
                const response = await api('/tenant/google/status');
                if (response.ok) {
                    this.googleIntegration = await response.json();
                }
            } catch (e) {
                console.error('Failed to load Google integration:', e);
            }
        },

        async searchGooglePlace() {
            const query = this.googleSearchQuery.trim() || this.profile.name;
            if (!query) {
                showToast('Unesite naziv biznisa', 'error');
                return;
            }

            this.googleSearching = true;
            this.googleSearchResults = [];
            this.googleSelectedPlace = null;

            try {
                const response = await api(`/tenant/google/search?q=${encodeURIComponent(query)}`);
                if (response.ok) {
                    const data = await response.json();
                    this.googleSearchResults = data.results || [];
                    if (this.googleSearchResults.length === 0) {
                        showToast('Nema rezultata pretrage', 'info');
                    }
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri pretrazi', 'error');
                }
            } catch (e) {
                console.error('Failed to search Google place:', e);
                showToast('Greska pri pretrazi', 'error');
            } finally {
                this.googleSearching = false;
            }
        },

        selectGooglePlace(place) {
            this.googleSelectedPlace = place;
        },

        async connectGooglePlace() {
            if (!this.googleSelectedPlace) {
                showToast('Izaberite biznis iz rezultata pretrage', 'error');
                return;
            }

            this.googleConnecting = true;
            try {
                const response = await api('/tenant/google/place', 'POST', {
                    place_id: this.googleSelectedPlace.place_id
                });
                if (response.ok) {
                    showToast('Google biznis uspesno povezan!', 'success');
                    await this.loadGoogleIntegration();
                    // Reset search state
                    this.googleSearchQuery = '';
                    this.googleSearchResults = [];
                    this.googleSelectedPlace = null;
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri povezivanju', 'error');
                }
            } catch (e) {
                console.error('Failed to connect Google place:', e);
                showToast('Greska pri povezivanju', 'error');
            } finally {
                this.googleConnecting = false;
            }
        },

        async syncGoogleReviews() {
            this.googleSyncing = true;
            try {
                const response = await api('/tenant/google/sync', 'POST');
                if (response.ok) {
                    const data = await response.json();
                    showToast(`Sinhronizovano ${data.reviews_synced || 0} recenzija`, 'success');
                    await this.loadGoogleIntegration();
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri sinhronizaciji', 'error');
                }
            } catch (e) {
                console.error('Failed to sync Google reviews:', e);
                showToast('Greska pri sinhronizaciji', 'error');
            } finally {
                this.googleSyncing = false;
            }
        },

        async disconnectGoogle() {
            if (!confirm('Da li ste sigurni da zelite da prekinete vezu sa Google nalogom?')) {
                return;
            }

            try {
                const response = await api('/tenant/google/disconnect', 'DELETE');
                if (response.ok) {
                    showToast('Veza sa Google prekinuta', 'success');
                    this.googleIntegration = { is_connected: false, integration: null };
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri prekidanju veze', 'error');
                }
            } catch (e) {
                console.error('Failed to disconnect Google:', e);
                showToast('Greska pri prekidanju veze', 'error');
            }
        },

        async saveSettings() {
            this.saving = true;
            try {
                const response = await api('/tenant/settings', 'PUT', this.settings);
                if (response.ok) {
                    showToast('Podesavanja sacuvana', 'success');
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri cuvanju', 'error');
                }
            } catch (e) {
                showToast('Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        async submitKyc() {
            this.saving = true;
            try {
                const response = await api('/tenant/kyc', 'POST', this.kycForm);
                if (response.ok) {
                    showToast('Podaci poslati na verifikaciju', 'success');
                    const kycRes = await api('/tenant/kyc');
                    if (kycRes.ok) {
                        this.kyc = await kycRes.json();
                    }
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri slanju', 'error');
                }
            } catch (e) {
                showToast('Greska pri slanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        // Users
        openUserModal() {
            this.editingUser = null;
            this.userForm = {
                ime: '',
                prezime: '',
                email: '',
                password: '',
                phone: '',
                role: 'TECHNICIAN'
            };
            this.userModal = true;
        },

        editUser(user) {
            this.editingUser = user;
            this.userForm = {
                ime: user.ime,
                prezime: user.prezime,
                email: user.email,
                phone: user.phone,
                role: user.role
            };
            this.userModal = true;
        },

        async saveUser() {
            this.saving = true;
            try {
                let response;
                if (this.editingUser) {
                    response = await api(`/users/${this.editingUser.id}`, 'PUT', this.userForm);
                } else {
                    response = await api('/users', 'POST', this.userForm);
                }
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri cuvanju');
                }
                showToast('Korisnik sacuvan', 'success');
                this.userModal = false;
                const usersRes = await api('/users');
                if (usersRes.ok) {
                    const data = await usersRes.json();
                    this.users = data.users || [];
                }
            } catch (e) {
                showToast(e.message || 'Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        // Locations
        openLocationModal() {
            this.editingLocation = null;
            this.locationForm = {
                name: '',
                address: '',
                city: '',
                postal_code: '',
                phone: '',
                email: ''
            };
            this.locationModal = true;
        },

        editLocation(location) {
            this.editingLocation = location;
            this.locationForm = {
                name: location.name,
                address: location.address,
                city: location.city,
                postal_code: location.postal_code,
                phone: location.phone,
                email: location.email
            };
            this.locationModal = true;
        },

        async saveLocation() {
            this.saving = true;
            try {
                let response;
                if (this.editingLocation) {
                    response = await api(`/locations/${this.editingLocation.id}`, 'PUT', this.locationForm);
                } else {
                    response = await api('/locations', 'POST', this.locationForm);
                }
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri cuvanju');
                }
                showToast('Lokacija sacuvana', 'success');
                this.locationModal = false;
                const locationsRes = await api('/locations');
                if (locationsRes.ok) {
                    const data = await locationsRes.json();
                    this.locations = data.locations || [];
                }
            } catch (e) {
                showToast(e.message || 'Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        // Helpers
        getRoleLabel(role) {
            const labels = {
                'OWNER': 'Vlasnik',
                'ADMIN': 'Admin',
                'MANAGER': 'Menadzer',
                'TECHNICIAN': 'Serviser',
                'RECEPTIONIST': 'Recepcionar'
            };
            return labels[role] || role;
        },

        getRoleClass(role) {
            const classes = {
                'OWNER': 'bg-purple-100 text-purple-700',
                'ADMIN': 'bg-red-100 text-red-700',
                'MANAGER': 'bg-blue-100 text-blue-700',
                'TECHNICIAN': 'bg-green-100 text-green-700',
                'RECEPTIONIST': 'bg-gray-100 text-gray-700'
            };
            return classes[role] || 'bg-gray-100 text-gray-700';
        },

        getSubscriptionStatusLabel(status) {
            const labels = {
                'PENDING': 'Cekanje',
                'TRIAL': 'Trial',
                'ACTIVE': 'Aktivan',
                'EXPIRED': 'Istekao',
                'SUSPENDED': 'Suspendovan'
            };
            return labels[status] || status;
        },

        getSubscriptionStatusClass(status) {
            const classes = {
                'PENDING': 'bg-yellow-100 text-yellow-700',
                'TRIAL': 'bg-blue-100 text-blue-700',
                'ACTIVE': 'bg-green-100 text-green-700',
                'EXPIRED': 'bg-red-100 text-red-700',
                'SUSPENDED': 'bg-gray-100 text-gray-700'
            };
            return classes[status] || 'bg-gray-100 text-gray-700';
        },

        formatPrice(price) {
            if (!price) return '0';
            return new Intl.NumberFormat('sr-RS').format(price);
        },

        formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('sr-RS');
        },

        // Format working hours object to readable string for locations
        // Smart grouping: "Radnim danima: 09-17, Sub: 09-14, Ned: ne radi"
        formatLocationWorkingHours(wh) {
            // Handle null, undefined, empty string
            if (!wh) return '';

            // Handle string (might be JSON string)
            if (typeof wh === 'string') {
                try {
                    wh = JSON.parse(wh);
                } catch (e) {
                    return wh; // Return as-is if not valid JSON
                }
            }

            // Must be object
            if (typeof wh !== 'object' || wh === null) return '';
            if (Object.keys(wh).length === 0) return '';

            // Map various day formats to standard abbreviations
            const dayAliases = {
                mon: 'mon', monday: 'mon', ponedeljak: 'mon', pon: 'mon',
                tue: 'tue', tuesday: 'tue', utorak: 'tue', uto: 'tue',
                wed: 'wed', wednesday: 'wed', sreda: 'wed', sre: 'wed',
                thu: 'thu', thursday: 'thu', cetvrtak: 'thu', cet: 'thu',
                fri: 'fri', friday: 'fri', petak: 'fri', pet: 'fri',
                sat: 'sat', saturday: 'sat', subota: 'sat', sub: 'sat',
                sun: 'sun', sunday: 'sun', nedelja: 'sun', ned: 'sun'
            };

            const dayNames = {
                mon: 'Pon', tue: 'Uto', wed: 'Sre', thu: 'Čet', fri: 'Pet', sat: 'Sub', sun: 'Ned'
            };
            const weekdays = ['mon', 'tue', 'wed', 'thu', 'fri'];

            // Normalize the working hours object to standard format
            const normalized = {};
            for (const [key, value] of Object.entries(wh)) {
                const lowerKey = key.toLowerCase();
                const stdDay = dayAliases[lowerKey];
                if (stdDay && typeof value === 'string') {
                    normalized[stdDay] = value;
                } else if (lowerKey.includes('_open') || lowerKey.includes('_close') || lowerKey.includes('_closed')) {
                    // Complex format keys (mon_open, etc.)
                    normalized[lowerKey] = value;
                } else if (typeof value === 'object' && value !== null) {
                    // Nested format: { mon: { open: "09:00", close: "17:00" } }
                    if (stdDay && value.open && value.close) {
                        normalized[stdDay] = `${value.open}-${value.close}`;
                    }
                }
            }

            // Helper to get hours for a day
            const getHours = (day) => {
                // Simple format: { mon: "09:00-17:00" }
                if (normalized[day] && typeof normalized[day] === 'string') {
                    return normalized[day];
                }
                // Complex format: { mon_open: "09:00", mon_close: "17:00" }
                if (normalized[`${day}_closed`] === true) {
                    return 'closed';
                }
                if (normalized[`${day}_open`] && normalized[`${day}_close`]) {
                    return `${normalized[`${day}_open`]}-${normalized[`${day}_close`]}`;
                }
                return null;
            };

            // Get hours for all days
            const hours = {};
            for (const day of [...weekdays, 'sat', 'sun']) {
                hours[day] = getHours(day);
            }

            // Check if any day has hours
            const anyHours = Object.values(hours).some(h => h && h !== 'closed');
            if (!anyHours) {
                // Fallback: just show first few key-value pairs
                const entries = Object.entries(wh).slice(0, 3);
                if (entries.length > 0) {
                    return entries.map(([k, v]) => `${k}: ${v}`).join(', ');
                }
                return '';
            }

            // Check if all weekdays have the same hours
            const weekdayHours = weekdays.map(d => hours[d]).filter(h => h && h !== 'closed');
            const uniqueWeekdayHours = [...new Set(weekdayHours)];
            const allWeekdaysSame = uniqueWeekdayHours.length === 1 && weekdayHours.length === 5;

            const parts = [];

            if (allWeekdaysSame) {
                // All weekdays same: "Radnim danima: 09-17"
                parts.push(`Radnim danima: ${uniqueWeekdayHours[0]}`);
            } else {
                // Show weekdays that differ or all individually
                const commonHours = uniqueWeekdayHours.length === 1 ? uniqueWeekdayHours[0] : null;

                if (commonHours && weekdayHours.length >= 3) {
                    // Most weekdays same, show exceptions
                    parts.push(`Radnim danima: ${commonHours}`);
                    for (const day of weekdays) {
                        if (hours[day] && hours[day] !== commonHours && hours[day] !== 'closed') {
                            parts.push(`${dayNames[day]}: ${hours[day]}`);
                        }
                    }
                } else {
                    // Show each weekday
                    for (const day of weekdays) {
                        if (hours[day] && hours[day] !== 'closed') {
                            parts.push(`${dayNames[day]}: ${hours[day]}`);
                        }
                    }
                }
            }

            // Saturday
            if (hours.sat && hours.sat !== 'closed') {
                parts.push(`Sub: ${hours.sat}`);
            }

            // Sunday
            if (hours.sun === 'closed' || !hours.sun) {
                parts.push('Ned: ne radi');
            } else {
                parts.push(`Ned: ${hours.sun}`);
            }

            return parts.join(', ');
        },

        // ==================== PUBLIC PROFILE ====================

        parseWorkingHours(wh) {
            // Parse working hours from API into the new format
            const defaults = {
                mon_open: '09:00', mon_close: '17:00', mon_closed: false,
                tue_open: '09:00', tue_close: '17:00', tue_closed: false,
                wed_open: '09:00', wed_close: '17:00', wed_closed: false,
                thu_open: '09:00', thu_close: '17:00', thu_closed: false,
                fri_open: '09:00', fri_close: '17:00', fri_closed: false,
                sat_open: '09:00', sat_close: '14:00', sat_closed: false,
                sun_open: '', sun_close: '', sun_closed: true
            };

            if (!wh || typeof wh !== 'object') return defaults;

            // Check if it's the new format (has mon_open, etc.)
            if ('mon_open' in wh || 'mon_closed' in wh) {
                return { ...defaults, ...wh };
            }

            // Convert old format (e.g., {mon: "09:00-17:00"}) to new format
            const result = { ...defaults };
            const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
            for (const day of days) {
                if (wh[day]) {
                    const val = wh[day].toLowerCase();
                    if (val === 'zatvoreno' || val === 'closed' || val === '-') {
                        result[`${day}_closed`] = true;
                        result[`${day}_open`] = '';
                        result[`${day}_close`] = '';
                    } else if (val.includes('-')) {
                        const [open, close] = val.split('-').map(t => t.trim());
                        result[`${day}_open`] = open || '';
                        result[`${day}_close`] = close || '';
                        result[`${day}_closed`] = false;
                    }
                }
            }
            return result;
        },

        fillDefaultWorkingHours() {
            this.publicProfile.working_hours = {
                mon_open: '09:00', mon_close: '17:00', mon_closed: false,
                tue_open: '09:00', tue_close: '17:00', tue_closed: false,
                wed_open: '09:00', wed_close: '17:00', wed_closed: false,
                thu_open: '09:00', thu_close: '17:00', thu_closed: false,
                fri_open: '09:00', fri_close: '17:00', fri_closed: false,
                sat_open: '09:00', sat_close: '14:00', sat_closed: false,
                sun_open: '', sun_close: '', sun_closed: true
            };
            showToast('Standardno radno vreme popunjeno', 'success');
        },

        // ==================== SECTIONS HELPERS (v2) ====================

        toggleBrand(brand) {
            if (!Array.isArray(this.publicProfile.supported_brands)) {
                this.publicProfile.supported_brands = [];
            }
            const index = this.publicProfile.supported_brands.indexOf(brand);
            if (index > -1) {
                this.publicProfile.supported_brands.splice(index, 1);
            } else {
                this.publicProfile.supported_brands.push(brand);
            }
        },

        addFaqItem() {
            if (!Array.isArray(this.publicProfile.faq_items)) {
                this.publicProfile.faq_items = [];
            }
            this.publicProfile.faq_items.push({ question: '', answer: '' });
        },

        removeFaqItem(index) {
            if (Array.isArray(this.publicProfile.faq_items) && index >= 0 && index < this.publicProfile.faq_items.length) {
                this.publicProfile.faq_items.splice(index, 1);
            }
        },

        addSuggestedFaq(question, answer) {
            if (!Array.isArray(this.publicProfile.faq_items)) {
                this.publicProfile.faq_items = [];
            }
            // Check if this FAQ already exists
            const exists = this.publicProfile.faq_items.some(item => item.question === question);
            if (!exists) {
                this.publicProfile.faq_items.push({ question, answer });
                showToast('FAQ dodato', 'success');
            } else {
                showToast('Ovo pitanje vec postoji', 'warning');
            }
        },

        async savePublicProfile() {
            this.savingPublic = true;
            try {
                // Create a copy with converted working_hours
                const profileToSave = {...this.publicProfile};

                // Explicitly convert working_hours from form format to API format
                if (profileToSave.working_hours && typeof profileToSave.working_hours === 'object') {
                    profileToSave.working_hours = this.formatWorkingHoursForApi(profileToSave.working_hours);
                }

                // Sanitize URLs to prevent XSS
                const sanitizedProfile = this.sanitizePublicProfile(profileToSave);

                const response = await api('/tenant/public-profile', 'PUT', sanitizedProfile);
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri cuvanju');
                }
                const data = await response.json();
                showToast('Javna stranica sacuvana', 'success');

                // Reload to get updated data
                if (data.profile) {
                    // Update URLs in case custom domain changed
                    const publicRes = await api('/tenant/public-profile');
                    if (publicRes.ok) {
                        const publicData = await publicRes.json();
                        this.publicPageUrls.custom_domain = publicData.custom_domain_url || null;
                    }
                }
            } catch (e) {
                showToast(e.message || 'Greska pri cuvanju', 'error');
            } finally {
                this.savingPublic = false;
            }
        },

        // Konvertuje novi format radnog vremena u stari format za API/template
        formatWorkingHoursForApi(wh) {
            if (!wh || typeof wh !== 'object') return {};

            const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
            const result = {};

            for (const day of days) {
                const closedKey = `${day}_closed`;
                const openKey = `${day}_open`;
                const closeKey = `${day}_close`;

                if (wh[closedKey] === true) {
                    result[day] = 'Zatvoreno';
                } else if (wh[openKey] && wh[closeKey]) {
                    result[day] = `${wh[openKey]}-${wh[closeKey]}`;
                } else if (wh[openKey]) {
                    result[day] = wh[openKey];
                }
                // Ako nema podataka za dan, ne dodajemo ga
            }

            return result;
        },

        sanitizePublicProfile(profile) {
            // Create a clean copy with sanitized values
            const sanitized = {};
            const urlFields = ['logo_url', 'cover_image_url', 'maps_url', 'maps_embed_url',
                               'facebook_url', 'instagram_url', 'youtube_url', 'tiktok_url',
                               'linkedin_url', 'website_url'];

            for (const [key, value] of Object.entries(profile)) {
                if (value === null || value === undefined) {
                    sanitized[key] = value;
                } else if (key === 'working_hours' && typeof value === 'object') {
                    // Check if already in API format (no _closed keys) or needs conversion
                    if ('mon_closed' in value || 'tue_closed' in value) {
                        // Form format, needs conversion
                        sanitized[key] = this.formatWorkingHoursForApi(value);
                    } else {
                        // Already in API format, pass through
                        sanitized[key] = value;
                    }
                } else if (typeof value === 'string') {
                    // Sanitize string values
                    let sanitizedValue = value.trim();
                    // For URL fields, validate URL format
                    if (urlFields.includes(key) && sanitizedValue) {
                        try {
                            const url = new URL(sanitizedValue);
                            // Only allow http/https
                            if (!['http:', 'https:'].includes(url.protocol)) {
                                sanitizedValue = '';
                            }
                        } catch {
                            // Invalid URL, keep as is (server will validate)
                        }
                    }
                    sanitized[key] = sanitizedValue;
                } else if (typeof value === 'object') {
                    // Recursively sanitize objects
                    sanitized[key] = this.sanitizePublicProfile(value);
                } else {
                    sanitized[key] = value;
                }
            }
            return sanitized;
        },

        async loadQRCode() {
            if (this.qrCode) {
                this.qrCode = null;
                return;
            }
            try {
                const response = await api('/tenant/public-profile/qrcode');
                if (response.ok) {
                    const data = await response.json();
                    this.qrCode = data.qrcode;
                }
            } catch (e) {
                showToast('Greska pri generisanju QR koda', 'error');
            }
        },

        copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Kopirano u clipboard', 'success');
                });
            } else {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('Kopirano u clipboard', 'success');
            }
        },

        async setupDomain() {
            if (!this.newDomainInput) return;

            // Validate domain format
            const domain = this.newDomainInput.toLowerCase().trim();
            const domainRegex = /^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z]{2,})+$/;
            if (!domainRegex.test(domain)) {
                showToast('Neispravan format domena', 'error');
                return;
            }

            this.settingUpDomain = true;
            try {
                const response = await api('/tenant/public-profile/custom-domain', 'POST', {
                    domain: domain
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Greska pri dodavanju domena');
                }

                showToast('Domen dodat. Proverite DNS instrukcije.', 'success');
                this.customDomain = {
                    domain: data.domain,
                    verified: false,
                    verification_instructions: data.verification_instructions
                };
                this.newDomainInput = '';
            } catch (e) {
                showToast(e.message || 'Greska pri dodavanju domena', 'error');
            } finally {
                this.settingUpDomain = false;
            }
        },

        async verifyDomain() {
            this.verifyingDomain = true;
            try {
                const response = await api('/tenant/public-profile/custom-domain/verify', 'POST');
                const data = await response.json();

                if (data.verified) {
                    showToast('Domen uspesno verifikovan!', 'success');
                    this.customDomain.verified = true;
                    this.publicPageUrls.custom_domain = data.url;
                } else {
                    const errors = data.errors?.join(', ') || 'DNS zapisi nisu ispravno podeseni';
                    showToast(errors, 'error');
                }
            } catch (e) {
                showToast('Greska pri verifikaciji domena', 'error');
            } finally {
                this.verifyingDomain = false;
            }
        },

        async removeDomain() {
            if (!confirm('Da li ste sigurni da zelite da uklonite custom domen?')) {
                return;
            }
            try {
                const response = await api('/tenant/public-profile/custom-domain', 'DELETE');
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri uklanjanju domena');
                }
                showToast('Domen uklonjen', 'success');
                this.customDomain = { domain: null, verified: false, verification_instructions: null };
                this.publicPageUrls.custom_domain = null;
            } catch (e) {
                showToast(e.message || 'Greska pri uklanjanju domena', 'error');
            }
        },

    }
}

// Store reference to settings page Alpine instance
var settingsPageInstance = null;
</script>

<!-- Google Maps Places API for address autocomplete -->
{% if google_maps_api_key %}
<script>
// Global flag to track if autocomplete is initialized
window._googleAutocompleteInitialized = false;

function initGoogleMapsAutocomplete() {
    console.log('[Google Places] Initializing address autocomplete...');

    // Check if already initialized
    if (window._googleAutocompleteInitialized) {
        console.log('[Google Places] Already initialized, skipping');
        return;
    }

    const addressInput = document.getElementById('public-address-input');
    if (!addressInput) {
        console.log('[Google Places] Address input not found, will retry when tab is shown');
        return;
    }

    if (typeof google === 'undefined' || !google.maps || !google.maps.places) {
        console.log('[Google Places] Google Maps API not loaded yet');
        return;
    }

    try {
        const autocomplete = new google.maps.places.Autocomplete(addressInput, {
            types: ['address'],
            componentRestrictions: { country: 'rs' },
            fields: ['address_components', 'formatted_address', 'geometry', 'place_id', 'url']
        });

    autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        console.log('[Google Places] Place selected:', place);

        if (!place.address_components) return;

        // Extract address components
        let streetNumber = '';
        let route = '';
        let city = '';
        let postalCode = '';

        for (const component of place.address_components) {
            const type = component.types[0];
            if (type === 'street_number') {
                streetNumber = component.long_name;
            } else if (type === 'route') {
                route = component.long_name;
            } else if (type === 'locality' || type === 'administrative_area_level_2') {
                city = component.long_name;
            } else if (type === 'postal_code') {
                postalCode = component.long_name;
            }
        }

        // Build full address
        const fullAddress = route + (streetNumber ? ' ' + streetNumber : '');

        // Update Alpine data if available
        const el = document.querySelector('[x-data="settingsPage()"]');
        if (el && el._x_dataStack && el._x_dataStack[0]) {
            const data = el._x_dataStack[0];
            data.publicProfile.address = fullAddress || place.formatted_address;
            data.publicProfile.city = city;
            data.publicProfile.postal_code = postalCode;

            // Google Maps URL
            if (place.url) {
                data.publicProfile.maps_url = place.url;
            } else if (place.place_id) {
                data.publicProfile.maps_url = 'https://www.google.com/maps/place/?q=place_id:' + place.place_id;
            }

            // Google Maps Embed URL
            if (place.geometry && place.geometry.location) {
                const lat = place.geometry.location.lat();
                const lng = place.geometry.location.lng();
                data.publicProfile.maps_embed_url = 'https://www.google.com/maps/embed/v1/place?key={{ google_maps_api_key }}&q=' + lat + ',' + lng + '&zoom=17';
            }

            console.log('[Google Places] Updated Alpine data');
        } else {
            console.log('[Google Places] Alpine data not found, trying __x');
            // Fallback for older Alpine
            if (el && el.__x && el.__x.$data) {
                const data = el.__x.$data;
                data.publicProfile.address = fullAddress || place.formatted_address;
                data.publicProfile.city = city;
                data.publicProfile.postal_code = postalCode;
                if (place.url) {
                    data.publicProfile.maps_url = place.url;
                }
                if (place.geometry && place.geometry.location) {
                    const lat = place.geometry.location.lat();
                    const lng = place.geometry.location.lng();
                    data.publicProfile.maps_embed_url = 'https://www.google.com/maps/embed/v1/place?key={{ google_maps_api_key }}&q=' + lat + ',' + lng + '&zoom=17';
                }
            }
        }
    });

        // Mark as initialized
        window._googleAutocompleteInitialized = true;
        console.log('[Google Places] Autocomplete initialized successfully');
    } catch (e) {
        console.error('[Google Places] Error initializing autocomplete:', e);
    }
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places&callback=initGoogleMapsAutocomplete" async defer></script>
{% endif %}
{% endblock %}
