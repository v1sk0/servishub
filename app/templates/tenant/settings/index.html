{% extends "layouts/tenant.html" %}

{% block title %}Podesavanja - ServisHub{% endblock %}

{% block page_content %}
<div x-data="settingsPage()" x-init="init()" x-cloak>

    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900">Podesavanja</h1>
        <p class="text-gray-600 mt-1">Upravljajte vasim servisom, timom i lokacijama</p>
    </div>

    <!-- Tabs -->
    <div class="border-b border-gray-200 mb-6">
        <nav class="flex space-x-8 overflow-x-auto" aria-label="Tabs">
            <button @click="activeTab = 'settings'"
                    :class="activeTab === 'settings' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Podesavanja
            </button>
            <button @click="activeTab = 'profile'"
                    :class="activeTab === 'profile' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Profil
            </button>
            <button @click="activeTab = 'subscription'"
                    :class="activeTab === 'subscription' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Pretplata
            </button>
            <button @click="activeTab = 'team'"
                    :class="activeTab === 'team' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Tim
            </button>
            <button @click="activeTab = 'locations'"
                    :class="activeTab === 'locations' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Lokacije
            </button>
            <button @click="activeTab = 'kyc'"
                    :class="activeTab === 'kyc' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                KYC
            </button>
            <button @click="activeTab = 'public_page'"
                    :class="activeTab === 'public_page' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                </svg>
                Javna Stranica
            </button>
        </nav>
    </div>

    <!-- Loading -->
    <div x-show="loading" class="flex justify-center py-12">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    </div>

    <!-- ==================== PROFILE TAB ==================== -->
    <div x-show="!loading && activeTab === 'profile'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Podaci servisa</h2>

            <form @submit.prevent="saveProfile()">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Naziv servisa *</label>
                        <input type="text" x-model="profile.name" required
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">PIB</label>
                        <input type="text" :value="profile.pib" disabled
                               class="w-full border border-gray-200 bg-gray-50 rounded-lg px-3 py-2 text-gray-500">
                        <p class="text-xs text-gray-400 mt-1">PIB se ne moze menjati</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Maticni broj</label>
                        <input type="text" :value="profile.maticni_broj" disabled
                               class="w-full border border-gray-200 bg-gray-50 rounded-lg px-3 py-2 text-gray-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" x-model="profile.email"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                        <input type="text" x-model="profile.telefon"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Adresa sedista</label>
                        <input type="text" x-model="profile.adresa_sedista"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div class="mt-6 flex justify-end">
                    <button type="submit" :disabled="saving"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                        <span x-show="!saving">Sacuvaj izmene</span>
                        <span x-show="saving">Cuvam...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== SETTINGS TAB ==================== -->
    <div x-show="!loading && activeTab === 'settings'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Podesavanja naloga</h2>

            <form @submit.prevent="saveSettings()">
                <div class="space-y-6">
                    <!-- Tema izgleda - FIRST -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-4">Izgled aplikacije</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <!-- Light Theme -->
                                <div @click="setTheme('light')"
                                     class="cursor-pointer border-2 rounded-lg p-4 transition-all"
                                     :class="currentTheme === 'light' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-10 h-10 rounded-lg bg-white border border-gray-200 flex items-center justify-center">
                                            <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">Svetla</p>
                                            <p class="text-xs text-gray-500">Klasicna svetla tema</p>
                                        </div>
                                    </div>
                                    <div class="h-16 rounded-lg bg-gradient-to-br from-white to-gray-50 border border-gray-200"></div>
                                </div>

                                <!-- Glassmorphism Theme -->
                                <div @click="setTheme('glass')"
                                     class="cursor-pointer border-2 rounded-lg p-4 transition-all"
                                     :class="currentTheme === 'glass' ? 'border-purple-500 bg-purple-50' : 'border-gray-200 hover:border-gray-300'">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">Glassmorphism</p>
                                            <p class="text-xs text-gray-500">Tamna prozirna tema</p>
                                        </div>
                                    </div>
                                    <div class="h-16 rounded-lg bg-gradient-to-br from-slate-800 to-slate-900 border border-white/10 relative overflow-hidden">
                                        <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"></div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500">
                                <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Promena teme ce se primeniti odmah na celu aplikaciju
                            </p>
                        </div>
                    </div>

                    <!-- Warranty -->
                    <div class="border-t border-gray-200 pt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Default garancija (dana)</label>
                        <input type="number" x-model="settings.default_warranty_days" min="0" max="365"
                               class="w-32 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Koliko dana garancije se automatski dodaje na nove naloge</p>
                    </div>

                    <!-- Ticket Prefix -->
                    <div class="border-t border-gray-200 pt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Prefix naloga</label>
                        <input type="text" x-model="settings.ticket_prefix" maxlength="10"
                               placeholder="SRV" class="w-32 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Npr. SRV-0001 umesto 0001</p>
                    </div>

                    <!-- Notifications -->
                    <div class="border-t border-gray-200 pt-6">
                        <h3 class="text-sm font-medium text-gray-900 mb-4">Notifikacije</h3>
                        <div class="space-y-4">
                            <label class="flex items-center gap-3">
                                <input type="checkbox" x-model="settings.email_notifications"
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Email notifikacije</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" x-model="settings.sms_notifications"
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm text-gray-700">SMS notifikacije</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" x-model="settings.auto_sms_on_ready"
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Automatski SMS kada je nalog spreman</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="mt-6 flex justify-end">
                    <button type="submit" :disabled="saving"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                        <span x-show="!saving">Sacuvaj podesavanja</span>
                        <span x-show="saving">Cuvam...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== SUBSCRIPTION TAB ==================== -->
    <div x-show="!loading && activeTab === 'subscription'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <!-- Status Card -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">Status pretplate</h2>
                <span :class="getSubscriptionStatusClass(subscription.status)"
                      class="text-sm font-medium px-3 py-1 rounded-full"
                      x-text="getSubscriptionStatusLabel(subscription.status)"></span>
            </div>

            <div x-show="subscription.is_trial" class="mb-6 p-4 bg-blue-50 rounded-lg">
                <div class="flex items-center gap-3">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <p class="font-medium text-blue-900">Trial period</p>
                        <p class="text-sm text-blue-700">
                            Preostalo: <strong x-text="subscription.trial_days_left"></strong> dana
                            <span x-show="subscription.trial_ends_at">
                                (do <span x-text="formatDate(subscription.trial_ends_at)"></span>)
                            </span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Pricing -->
            <div class="border border-gray-200 rounded-lg overflow-hidden">
                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                    <h3 class="font-medium text-gray-900">Mesecni troskovi</h3>
                </div>
                <div class="p-4 space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Bazni paket (1 lokacija)</span>
                        <span class="font-medium" x-text="formatPrice(subscription.pricing?.base_price) + ' RSD'"></span>
                    </div>
                    <div class="flex justify-between" x-show="subscription.pricing?.additional_locations > 0">
                        <span class="text-gray-600">
                            Dodatne lokacije (<span x-text="subscription.pricing?.additional_locations"></span> x <span x-text="formatPrice(subscription.pricing?.location_price)"></span>)
                        </span>
                        <span class="font-medium" x-text="formatPrice(subscription.pricing?.additional_locations * subscription.pricing?.location_price) + ' RSD'"></span>
                    </div>
                    <div class="flex justify-between pt-3 border-t border-gray-200">
                        <span class="font-semibold text-gray-900">Ukupno mesecno</span>
                        <span class="font-bold text-lg text-gray-900" x-text="formatPrice(subscription.pricing?.monthly_total) + ' RSD'"></span>
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-600">
                    Za produzenje pretplate ili dodatne informacije, kontaktirajte nas na
                    <a href="mailto:office@servishub.rs" class="text-blue-600 hover:text-blue-700">office@servishub.rs</a>
                </p>
            </div>
        </div>
    </div>

    <!-- ==================== TEAM TAB ==================== -->
    <div x-show="!loading && activeTab === 'team'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Tim</h2>
            <button @click="openUserModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>Dodaj korisnika</span>
            </button>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase">Korisnik</th>
                            <th class="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase">Rola</th>
                            <th class="text-center px-4 py-3 text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="text-right px-4 py-3 text-xs font-medium text-gray-500 uppercase">Akcije</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <template x-for="user in users" :key="user.id">
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                            <span class="text-blue-600 font-medium text-sm" x-text="user.ime?.charAt(0) + user.prezime?.charAt(0)"></span>
                                        </div>
                                        <span class="font-medium text-gray-900" x-text="user.ime + ' ' + user.prezime"></span>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-sm text-gray-600" x-text="user.email"></td>
                                <td class="px-4 py-3">
                                    <span :class="getRoleClass(user.role)" class="text-xs font-medium px-2 py-1 rounded-full"
                                          x-text="getRoleLabel(user.role)"></span>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <span :class="user.is_active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'"
                                          class="text-xs font-medium px-2 py-1 rounded-full"
                                          x-text="user.is_active ? 'Aktivan' : 'Neaktivan'"></span>
                                </td>
                                <td class="px-4 py-3 text-right">
                                    <button @click="editUser(user)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ==================== LOCATIONS TAB ==================== -->
    <div x-show="!loading && activeTab === 'locations'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Lokacije</h2>
            <button @click="openLocationModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>Dodaj lokaciju</span>
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <template x-for="location in locations" :key="location.id">
                <div class="bg-white rounded-xl shadow-sm border-2 border-gray-300 overflow-hidden">
                    <!-- Map Preview (TOP) -->
                    <div class="h-32 relative bg-gray-100 overflow-hidden border-b-2 border-gray-200">
                        <!-- Google Maps Embed -->
                        <template x-if="location.address || location.city">
                            <iframe
                                class="w-full h-full border-0"
                                loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade"
                                :src="'https://www.google.com/maps?q=' + encodeURIComponent((location.address || '') + ', ' + (location.city || '') + ', Serbia') + '&output=embed'"
                                allowfullscreen>
                            </iframe>
                        </template>
                        <!-- No address placeholder -->
                        <template x-if="!location.address && !location.city">
                            <div class="absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100">
                                <svg class="w-10 h-10 mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span class="text-sm text-gray-400">Unesite adresu</span>
                            </div>
                        </template>

                        <!-- Edit button -->
                        <div class="absolute top-3 right-3 z-10">
                            <button @click="editLocation(location)"
                                    class="p-1.5 bg-white/90 backdrop-blur text-gray-700 hover:bg-white rounded-lg shadow transition-colors"
                                    title="Izmeni lokaciju">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Primary badge (below map) -->
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100" x-show="location.is_primary">
                        <span class="text-blue-700 text-xs font-semibold flex items-center gap-1.5">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            Glavni servis
                        </span>
                    </div>

                    <!-- Location Details (BOTTOM) -->
                    <div class="p-4">
                        <!-- Header -->
                        <div class="mb-3">
                            <h3 class="text-base font-semibold text-gray-900" x-text="location.name"></h3>
                            <p class="text-sm text-gray-500" x-show="location.city" x-text="location.city"></p>
                        </div>

                        <!-- Info Grid -->
                        <div class="space-y-2 text-sm">
                            <!-- Address -->
                            <div class="flex items-start gap-2" x-show="location.address">
                                <svg class="w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <div>
                                    <span class="text-gray-500 text-xs">Adresa:</span>
                                    <p class="text-gray-700" x-text="location.address"></p>
                                </div>
                            </div>

                            <!-- Phone -->
                            <div class="flex items-center gap-2" x-show="location.phone">
                                <svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                <a :href="'tel:' + location.phone" class="text-gray-700 hover:text-blue-600" x-text="location.phone"></a>
                            </div>

                            <!-- Email -->
                            <div class="flex items-center gap-2" x-show="location.email">
                                <svg class="w-4 h-4 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                <a :href="'mailto:' + location.email" class="text-gray-700 hover:text-blue-600 truncate" x-text="location.email"></a>
                            </div>

                            <!-- Working Hours -->
                            <div class="flex items-start gap-2" x-show="location.working_hours">
                                <svg class="w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <span class="text-gray-500 text-xs">Radno vreme:</span>
                                    <p class="text-gray-700" x-text="location.working_hours"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="mt-4 pt-3 border-t border-gray-100 flex items-center gap-4">
                            <a x-show="location.phone"
                               :href="'tel:' + location.phone"
                               class="inline-flex items-center gap-1.5 text-sm text-green-600 hover:text-green-700 font-medium">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                Pozovi
                            </a>
                            <a x-show="location.address || location.city"
                               :href="'https://www.google.com/maps/dir/?api=1&destination=' + encodeURIComponent((location.address || '') + ', ' + (location.city || ''))"
                               target="_blank"
                               class="inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-700 font-medium">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                                </svg>
                                Putanja
                            </a>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Empty state -->
            <template x-if="locations.length === 0">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-1">Nema lokacija</h3>
                    <p class="text-gray-500 mb-4">Dodajte svoju prvu lokaciju da biste poceli</p>
                    <button @click="openLocationModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Dodaj lokaciju
                    </button>
                </div>
            </template>
        </div>
    </div>

    <!-- ==================== KYC TAB ==================== -->
    <div x-show="!loading && activeTab === 'kyc'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">KYC Verifikacija</h2>

            <!-- Status -->
            <div class="mb-6">
                <div class="flex items-center gap-3 p-4 rounded-lg"
                     :class="kyc.kyc_status === 'VERIFIED' ? 'bg-green-50' : kyc.kyc_status === 'PENDING' ? 'bg-yellow-50' : kyc.kyc_status === 'REJECTED' ? 'bg-red-50' : 'bg-gray-50'">
                    <template x-if="kyc.kyc_status === 'VERIFIED'">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </template>
                    <template x-if="kyc.kyc_status === 'PENDING'">
                        <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </template>
                    <template x-if="!kyc.kyc_submitted">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </template>
                    <div>
                        <p class="font-medium"
                           :class="kyc.kyc_status === 'VERIFIED' ? 'text-green-800' : kyc.kyc_status === 'PENDING' ? 'text-yellow-800' : kyc.kyc_status === 'REJECTED' ? 'text-red-800' : 'text-gray-800'"
                           x-text="kyc.kyc_status === 'VERIFIED' ? 'Verifikovan' : kyc.kyc_status === 'PENDING' ? 'Ceka se verifikacija' : kyc.kyc_status === 'REJECTED' ? 'Odbijeno' : 'Nije prijavljeno'"></p>
                        <p class="text-sm"
                           :class="kyc.kyc_status === 'VERIFIED' ? 'text-green-700' : kyc.kyc_status === 'PENDING' ? 'text-yellow-700' : kyc.kyc_status === 'REJECTED' ? 'text-red-700' : 'text-gray-600'"
                           x-text="kyc.kyc_status === 'VERIFIED' ? 'Vas servis je verifikovan za B2C prodaju' : kyc.kyc_status === 'PENDING' ? 'Podaci su poslati na verifikaciju' : kyc.kyc_status === 'REJECTED' ? 'Molimo popravite podatke i posaljite ponovo' : 'Popunite podatke za KYC verifikaciju'"></p>
                    </div>
                </div>
            </div>

            <!-- KYC Form -->
            <div x-show="kyc.kyc_status !== 'VERIFIED'">
                <h3 class="font-medium text-gray-900 mb-4">Podaci predstavnika</h3>
                <form @submit.prevent="submitKyc()">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ime *</label>
                            <input type="text" x-model="kycForm.ime" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Prezime *</label>
                            <input type="text" x-model="kycForm.prezime" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">JMBG</label>
                            <input type="text" x-model="kycForm.jmbg" maxlength="13"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Broj licne karte</label>
                            <input type="text" x-model="kycForm.broj_licne_karte"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" x-model="kycForm.email"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="text" x-model="kycForm.telefon"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Adresa</label>
                            <input type="text" x-model="kycForm.adresa"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">
                            Nakon slanja, vas zahtev ce biti pregledan od strane naseg tima.
                            Mozda cemo zatraziti dodatne dokumente (slike licne karte).
                        </p>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button type="submit" :disabled="saving"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                            <span x-show="!saving" x-text="kyc.kyc_submitted ? 'Azuriraj i posalji' : 'Posalji na verifikaciju'"></span>
                            <span x-show="saving">Saljem...</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Verified Info -->
            <div x-show="kyc.kyc_status === 'VERIFIED' && kyc.representative">
                <div class="p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-600 mb-2">Verifikovani predstavnik:</p>
                    <p class="font-medium text-gray-900" x-text="kyc.representative?.ime + ' ' + kyc.representative?.prezime"></p>
                    <p class="text-sm text-gray-600" x-text="kyc.representative?.email"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== JAVNA STRANICA TAB ==================== -->
    <div x-show="!loading && activeTab === 'public_page'" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
        <!-- Status Banner -->
        <div :class="publicProfile.is_public ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'"
             class="rounded-xl border p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <template x-if="publicProfile.is_public">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </template>
                    <template x-if="!publicProfile.is_public">
                        <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </template>
                    <div>
                        <p class="font-medium" :class="publicProfile.is_public ? 'text-green-900' : 'text-yellow-900'"
                           x-text="publicProfile.is_public ? 'Javna stranica je aktivna' : 'Javna stranica je iskljucena'"></p>
                        <p class="text-sm" :class="publicProfile.is_public ? 'text-green-700' : 'text-yellow-700'">
                            <template x-if="publicProfile.is_public">
                                <span>Vasa stranica je vidljiva na internetu</span>
                            </template>
                            <template x-if="!publicProfile.is_public">
                                <span>Ukljucite da bi korisnici mogli da vide vasu stranicu</span>
                            </template>
                        </p>
                    </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" x-model="publicProfile.is_public" @change="savePublicProfile()" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                </label>
            </div>
        </div>

        <!-- Preview Links -->
        <div x-show="publicProfile.is_public" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Vasa javna stranica</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <p class="text-sm text-gray-500 mb-2">Subdomena (automatska)</p>
                    <div class="flex items-center gap-2">
                        <a :href="publicPageUrls.subdomain" target="_blank"
                           class="text-blue-600 hover:text-blue-700 hover:underline font-medium"
                           x-text="publicPageUrls.subdomain"></a>
                        <button @click="copyToClipboard(publicPageUrls.subdomain)" class="p-1 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div x-show="publicPageUrls.custom_domain">
                    <p class="text-sm text-gray-500 mb-2">Custom domen</p>
                    <div class="flex items-center gap-2">
                        <a :href="publicPageUrls.custom_domain" target="_blank"
                           class="text-blue-600 hover:text-blue-700 hover:underline font-medium"
                           x-text="publicPageUrls.custom_domain"></a>
                        <button @click="copyToClipboard(publicPageUrls.custom_domain)" class="p-1 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <!-- QR Code -->
            <div class="mt-4 pt-4 border-t border-gray-200">
                <button @click="loadQRCode()" class="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h2M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                    </svg>
                    Prikazi QR kod
                </button>
                <div x-show="qrCode" class="mt-3">
                    <img :src="qrCode" alt="QR Code" class="w-32 h-32 border rounded-lg">
                </div>
            </div>
        </div>

        <!-- Sub-tabs for public page sections -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="border-b border-gray-200">
                <nav class="flex overflow-x-auto" aria-label="Tabs">
                    <button @click="publicSubTab = 'basic'"
                            :class="publicSubTab === 'basic' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Osnovni podaci
                    </button>
                    <button @click="publicSubTab = 'contact'"
                            :class="publicSubTab === 'contact' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Kontakt
                    </button>
                    <button @click="publicSubTab = 'hours'"
                            :class="publicSubTab === 'hours' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Radno vreme
                    </button>
                    <button @click="publicSubTab = 'branding'"
                            :class="publicSubTab === 'branding' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Branding
                    </button>
                    <button @click="publicSubTab = 'social'"
                            :class="publicSubTab === 'social' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Drustvene mreze
                    </button>
                    <button @click="publicSubTab = 'pricing'"
                            :class="publicSubTab === 'pricing' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Cenovnik
                    </button>
                    <button @click="publicSubTab = 'seo'"
                            :class="publicSubTab === 'seo' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        SEO
                    </button>
                    <button @click="publicSubTab = 'sections'"
                            :class="publicSubTab === 'sections' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Sekcije
                    </button>
                    <button @click="publicSubTab = 'domain'"
                            :class="publicSubTab === 'domain' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 border-b-2 font-medium text-sm whitespace-nowrap">
                        Custom Domen
                    </button>
                </nav>
            </div>

            <div class="p-6">
                <!-- Basic Info Sub-tab -->
                <div x-show="publicSubTab === 'basic'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Naziv za prikaz</label>
                            <input type="text" x-model="publicProfile.display_name" maxlength="200"
                                   :placeholder="profile.name"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ostavite prazno da koristite naziv servisa</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Slogan</label>
                            <input type="text" x-model="publicProfile.tagline" maxlength="300"
                                   placeholder="Vas moto ili kratki opis"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Opis</label>
                        <textarea x-model="publicProfile.description" rows="4"
                                  placeholder="Opis vase firme..."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Naslov O nama sekcije</label>
                        <input type="text" x-model="publicProfile.about_title" maxlength="200"
                               placeholder="O nama"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sadrzaj O nama</label>
                        <textarea x-model="publicProfile.about_content" rows="6"
                                  placeholder="Detaljniji tekst o vasoj firmi..."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Moze sadrzati HTML za formatiranje</p>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Contact Sub-tab -->
                <div x-show="publicSubTab === 'contact'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="tel" x-model="publicProfile.phone" maxlength="50"
                                   :placeholder="profile.telefon"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Drugi telefon</label>
                            <input type="tel" x-model="publicProfile.phone_secondary" maxlength="50"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" x-model="publicProfile.email" maxlength="100"
                                   :placeholder="profile.email"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Grad</label>
                            <input type="text" x-model="publicProfile.city" maxlength="100"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Adresa</label>
                            <input type="text" x-model="publicProfile.address" maxlength="300"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Postanski broj</label>
                            <input type="text" x-model="publicProfile.postal_code" maxlength="20"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Google Maps link</label>
                        <input type="url" x-model="publicProfile.maps_url" maxlength="500"
                               placeholder="https://maps.google.com/..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Link ka vasoj lokaciji na Google Maps</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Google Maps embed URL</label>
                        <input type="url" x-model="publicProfile.maps_embed_url" maxlength="500"
                               placeholder="https://www.google.com/maps/embed?pb=..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Za prikaz mape na stranici (kopirajte src iz iframe embed koda)</p>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Working Hours Sub-tab -->
                <div x-show="publicSubTab === 'hours'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-4">
                    <p class="text-sm text-gray-600 mb-4">Podesite radno vreme za svaki dan. Obelezite "Zatvoreno" ako ne radite taj dan.</p>

                    <div class="space-y-3">
                        <!-- Monday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Ponedeljak</span>
                            <input type="time" x-model="publicProfile.working_hours.mon_open"
                                   :disabled="publicProfile.working_hours.mon_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.mon_close"
                                   :disabled="publicProfile.working_hours.mon_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.mon_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Tuesday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Utorak</span>
                            <input type="time" x-model="publicProfile.working_hours.tue_open"
                                   :disabled="publicProfile.working_hours.tue_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.tue_close"
                                   :disabled="publicProfile.working_hours.tue_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.tue_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Wednesday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Sreda</span>
                            <input type="time" x-model="publicProfile.working_hours.wed_open"
                                   :disabled="publicProfile.working_hours.wed_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.wed_close"
                                   :disabled="publicProfile.working_hours.wed_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.wed_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Thursday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Cetvrtak</span>
                            <input type="time" x-model="publicProfile.working_hours.thu_open"
                                   :disabled="publicProfile.working_hours.thu_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.thu_close"
                                   :disabled="publicProfile.working_hours.thu_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.thu_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Friday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Petak</span>
                            <input type="time" x-model="publicProfile.working_hours.fri_open"
                                   :disabled="publicProfile.working_hours.fri_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.fri_close"
                                   :disabled="publicProfile.working_hours.fri_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.fri_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Saturday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Subota</span>
                            <input type="time" x-model="publicProfile.working_hours.sat_open"
                                   :disabled="publicProfile.working_hours.sat_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.sat_close"
                                   :disabled="publicProfile.working_hours.sat_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.sat_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>

                        <!-- Sunday -->
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <span class="w-24 text-sm font-medium text-gray-700">Nedelja</span>
                            <input type="time" x-model="publicProfile.working_hours.sun_open"
                                   :disabled="publicProfile.working_hours.sun_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <span class="text-gray-500">-</span>
                            <input type="time" x-model="publicProfile.working_hours.sun_close"
                                   :disabled="publicProfile.working_hours.sun_closed"
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 disabled:bg-gray-100 disabled:text-gray-400">
                            <label class="flex items-center gap-2 ml-4">
                                <input type="checkbox" x-model="publicProfile.working_hours.sun_closed"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="text-sm text-gray-600">Zatvoreno</span>
                            </label>
                        </div>
                    </div>

                    <!-- Quick Fill Button -->
                    <div class="pt-2">
                        <button type="button" @click="fillDefaultWorkingHours()"
                                class="text-sm text-green-600 hover:text-green-700 underline">
                            Popuni standardno radno vreme (Pon-Pet 09:00-17:00, Sub 09:00-14:00)
                        </button>
                    </div>

                    <div class="flex justify-end pt-4">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Branding Sub-tab -->
                <div x-show="publicSubTab === 'branding'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Logo URL</label>
                        <input type="url" x-model="publicProfile.logo_url" maxlength="500"
                               placeholder="https://..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Link do vaseg loga (preporucena velicina: 200x200px)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cover slika URL</label>
                        <input type="url" x-model="publicProfile.cover_image_url" maxlength="500"
                               placeholder="https://..."
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Header slika za javnu stranicu (preporucena velicina: 1920x400px)</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Primarna boja</label>
                            <div class="flex items-center gap-3">
                                <input type="color" x-model="publicProfile.primary_color"
                                       class="w-12 h-10 rounded border border-gray-300 cursor-pointer">
                                <input type="text" x-model="publicProfile.primary_color" maxlength="7"
                                       placeholder="#3b82f6"
                                       class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sekundarna boja</label>
                            <div class="flex items-center gap-3">
                                <input type="color" x-model="publicProfile.secondary_color"
                                       class="w-12 h-10 rounded border border-gray-300 cursor-pointer">
                                <input type="text" x-model="publicProfile.secondary_color" maxlength="7"
                                       placeholder="#1e40af"
                                       class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Social Sub-tab -->
                <div x-show="publicSubTab === 'social'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Facebook</label>
                            <input type="url" x-model="publicProfile.facebook_url" maxlength="300"
                                   placeholder="https://facebook.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Instagram</label>
                            <input type="url" x-model="publicProfile.instagram_url" maxlength="300"
                                   placeholder="https://instagram.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">YouTube</label>
                            <input type="url" x-model="publicProfile.youtube_url" maxlength="300"
                                   placeholder="https://youtube.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">TikTok</label>
                            <input type="url" x-model="publicProfile.tiktok_url" maxlength="300"
                                   placeholder="https://tiktok.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">LinkedIn</label>
                            <input type="url" x-model="publicProfile.linkedin_url" maxlength="300"
                                   placeholder="https://linkedin.com/..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Website</label>
                            <input type="url" x-model="publicProfile.website_url" maxlength="300"
                                   placeholder="https://..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Pricing Sub-tab -->
                <div x-show="publicSubTab === 'pricing'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900">Prikazi cenovnik na javnoj stranici</p>
                            <p class="text-sm text-gray-500">Kada je ukljuceno, usluge iz cenovnika ce biti vidljive posetiocima</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" x-model="publicProfile.show_prices" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Napomena o cenama</label>
                        <textarea x-model="publicProfile.price_disclaimer" rows="2" maxlength="500"
                                  placeholder="Cene su okvirne i podlozne promenama nakon dijagnostike."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Ova napomena ce se prikazati ispod cenovnika</p>
                    </div>
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-start gap-3">
                            <svg class="w-5 h-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div class="text-sm text-blue-800">
                                <p class="font-medium">Usluge za cenovnik</p>
                                <p>Usluge koje se prikazuju na javnoj stranici mozete podesiti u <a href="/pricing" class="underline hover:no-underline">Cenovniku</a>. Prikazuju se samo aktivne usluge.</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- SEO Sub-tab -->
                <div x-show="publicSubTab === 'seo'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">SEO podesavanja pomazu da vasa stranica bude bolje rangirana na Google pretrazi.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Meta naslov</label>
                        <input type="text" x-model="publicProfile.meta_title" maxlength="100"
                               placeholder="Servis mobilnih telefona - Vas Grad"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Naslov koji se prikazuje u Google rezultatima (max 60 karaktera)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Meta opis</label>
                        <textarea x-model="publicProfile.meta_description" rows="2" maxlength="200"
                                  placeholder="Profesionalan servis mobilnih telefona i racunara. Brza dijagnostika, kvalitetne popravke, garancija na rad."
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Opis koji se prikazuje u Google rezultatima (max 160 karaktera)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kljucne reci</label>
                        <input type="text" x-model="publicProfile.meta_keywords" maxlength="300"
                               placeholder="servis mobilnih, popravka telefona, zamena ekrana, beograd"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                        <p class="text-xs text-gray-500 mt-1">Razdvojene zarezom</p>
                    </div>
                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Sections Sub-tab (NEW v2) -->
                <div x-show="publicSubTab === 'sections'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">

                    <!-- WhatsApp Settings -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-green-50 px-4 py-3 border-b border-green-200">
                            <h4 class="font-medium text-green-900 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                                </svg>
                                WhatsApp dugme
                            </h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi WhatsApp dugme</p>
                                    <p class="text-sm text-gray-500">Floating dugme u donjem desnom uglu</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_whatsapp_button" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_whatsapp_button" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">WhatsApp broj</label>
                                    <input type="tel" x-model="publicProfile.whatsapp_number"
                                           placeholder="381641234567"
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                                    <p class="text-xs text-gray-500 mt-1">Bez + ili razmaka, npr: 381641234567</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Predefinisana poruka</label>
                                    <input type="text" x-model="publicProfile.whatsapp_message" maxlength="300"
                                           placeholder="Zdravo! Imam pitanje..."
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Tracking Widget -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-blue-50 px-4 py-3 border-b border-blue-200">
                            <h4 class="font-medium text-blue-900">Status Tracking Widget</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi widget za pracenje statusa</p>
                                    <p class="text-sm text-gray-500">Omogucava korisnicima da provere status naloga sa pocetne strane</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_tracking_widget" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_tracking_widget">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Naslov widgeta</label>
                                <input type="text" x-model="publicProfile.tracking_widget_title" maxlength="200"
                                       placeholder="Pratite status popravke"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Brands Section -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-purple-50 px-4 py-3 border-b border-purple-200">
                            <h4 class="font-medium text-purple-900">Brendovi koje servisirate</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi sekciju brendova</p>
                                    <p class="text-sm text-gray-500">Prikazuje grid sa logotipima brendova</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_brands_section" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_brands_section">
                                <label class="block text-sm font-medium text-gray-700 mb-3">Izaberite brendove</label>
                                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                                    <template x-for="brand in ['apple', 'samsung', 'xiaomi', 'huawei', 'google', 'oneplus', 'motorola', 'oppo', 'vivo', 'realme', 'lenovo', 'hp', 'dell', 'asus', 'acer', 'msi']">
                                        <label class="flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"
                                               :class="publicProfile.supported_brands.includes(brand) ? 'border-purple-500 bg-purple-50' : 'border-gray-200'">
                                            <input type="checkbox"
                                                   :checked="publicProfile.supported_brands.includes(brand)"
                                                   @change="toggleBrand(brand)"
                                                   class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                            <span class="text-sm font-medium capitalize" x-text="brand"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Process Section -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-orange-50 px-4 py-3 border-b border-orange-200">
                            <h4 class="font-medium text-orange-900">Proces rada</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900">Prikazi sekciju procesa</p>
                                    <p class="text-sm text-gray-500">Prikazuje korake servisa (Prijem  Dijagnostika  Popravka  Preuzimanje)</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" x-model="publicProfile.show_process_section" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
                                </label>
                            </div>
                            <div x-show="publicProfile.show_process_section">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Naslov sekcije</label>
                                <input type="text" x-model="publicProfile.process_title" maxlength="200"
                                       placeholder="Kako funkcionise"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500">
                                <p class="text-xs text-gray-500 mt-2">Koraci procesa su predefinisani i prikazuju standardni servisni tok.</p>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Section -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-cyan-50 px-4 py-3 border-b border-cyan-200 flex items-center justify-between">
                            <h4 class="font-medium text-cyan-900">Cesto postavljana pitanja (FAQ)</h4>
                            <button type="button" @click="addFaqItem()"
                                    class="text-sm px-3 py-1 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700">
                                + Dodaj pitanje
                            </button>
                        </div>
                        <div class="p-4 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Naslov sekcije</label>
                                <input type="text" x-model="publicProfile.faq_title" maxlength="200"
                                       placeholder="Cesto postavljana pitanja"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500">
                            </div>

                            <div x-show="publicProfile.faq_items.length === 0" class="text-center py-6 text-gray-500">
                                <p>Nema dodatih pitanja.</p>
                                <p class="text-sm">Kliknite "Dodaj pitanje" da dodate prvo FAQ.</p>
                            </div>

                            <div class="space-y-3">
                                <template x-for="(item, index) in publicProfile.faq_items" :key="index">
                                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                        <div class="flex items-start justify-between mb-3">
                                            <span class="text-xs font-medium text-gray-500">Pitanje #<span x-text="index + 1"></span></span>
                                            <button type="button" @click="removeFaqItem(index)"
                                                    class="text-red-600 hover:text-red-700 text-sm">
                                                Ukloni
                                            </button>
                                        </div>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Pitanje</label>
                                                <input type="text" x-model="publicProfile.faq_items[index].question"
                                                       placeholder="Npr: Koliko traje popravka?"
                                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Odgovor</label>
                                                <textarea x-model="publicProfile.faq_items[index].answer" rows="2"
                                                          placeholder="Odgovor na pitanje..."
                                                          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Suggested FAQs -->
                            <div class="p-3 bg-cyan-50 border border-cyan-200 rounded-lg">
                                <p class="text-sm font-medium text-cyan-900 mb-2">Predlozena pitanja za servis:</p>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" @click="addSuggestedFaq('Koliko traje popravka telefona?', 'Vreme popravke zavisi od vrste kvara. Vecina popravki se zavrsi istog dana ili u roku od 24-48 sati.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Koliko traje popravka?
                                    </button>
                                    <button type="button" @click="addSuggestedFaq('Da li dobijam garanciju na popravku?', 'Da, na sve nase popravke dajemo garanciju. Trajanje garancije zavisi od vrste popravke.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Garancija?
                                    </button>
                                    <button type="button" @click="addSuggestedFaq('Koliko kosta dijagnostika?', 'Dijagnostika je besplatna ako se odlucite za popravku. U suprotnom, naplacuje se minimalna naknada.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Cena dijagnostike?
                                    </button>
                                    <button type="button" @click="addSuggestedFaq('Da li mogu da pratim status popravke?', 'Da, mozete pratiti status vase popravke putem koda koji dobijate prilikom prijema uredjaja.')"
                                            class="text-xs px-2 py-1 bg-white border border-cyan-300 rounded hover:bg-cyan-100">
                                        Pracenje statusa?
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button @click="savePublicProfile()" :disabled="savingPublic"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                            <span x-show="!savingPublic">Sacuvaj sve sekcije</span>
                            <span x-show="savingPublic">Cuvam...</span>
                        </button>
                    </div>
                </div>

                <!-- Custom Domain Sub-tab -->
                <div x-show="publicSubTab === 'domain'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="space-y-6">
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-medium text-blue-900 mb-2">Sta je custom domen?</h4>
                        <p class="text-sm text-blue-800">Pored automatske subdomena (<span x-text="tenantSlug"></span>.servishub.rs), mozete povezati svoj domen (npr. mojservis.rs) da bi vasa javna stranica bila dostupna na njemu.</p>
                    </div>

                    <!-- Current Domain Status -->
                    <div x-show="customDomain.domain" class="border rounded-lg overflow-hidden">
                        <div class="bg-gray-50 px-4 py-3 border-b">
                            <h4 class="font-medium text-gray-900">Trenutni custom domen</h4>
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900" x-text="customDomain.domain"></p>
                                    <p class="text-sm" :class="customDomain.verified ? 'text-green-600' : 'text-yellow-600'"
                                       x-text="customDomain.verified ? 'Verifikovan' : 'Ceka verifikaciju'"></p>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button x-show="!customDomain.verified" @click="verifyDomain()" :disabled="verifyingDomain"
                                            class="px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50">
                                        <span x-show="!verifyingDomain">Verifikuj</span>
                                        <span x-show="verifyingDomain">Proveravam...</span>
                                    </button>
                                    <button @click="removeDomain()" class="px-3 py-1.5 bg-red-100 text-red-700 text-sm rounded-lg hover:bg-red-200">
                                        Ukloni
                                    </button>
                                </div>
                            </div>

                            <!-- DNS Instructions -->
                            <div x-show="!customDomain.verified && customDomain.verification_instructions" class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <h5 class="font-medium text-yellow-900 mb-2">DNS Podesavanja</h5>
                                <p class="text-sm text-yellow-800 mb-3">Dodajte sledece DNS zapise kod vaseg domen provajdera:</p>
                                <div class="space-y-3 text-sm">
                                    <div class="bg-white p-3 rounded border">
                                        <p class="text-xs text-gray-500 uppercase mb-1">Verifikacija (CNAME ili TXT)</p>
                                        <p><strong>Host:</strong> <code class="bg-gray-100 px-1 rounded" x-text="customDomain.verification_instructions?.host"></code></p>
                                        <p><strong>Vrednost:</strong> <code class="bg-gray-100 px-1 rounded text-xs break-all" x-text="customDomain.verification_instructions?.value"></code></p>
                                    </div>
                                    <div class="bg-white p-3 rounded border">
                                        <p class="text-xs text-gray-500 uppercase mb-1">Routing (CNAME)</p>
                                        <p><strong>Host:</strong> <code class="bg-gray-100 px-1 rounded" x-text="customDomain.domain"></code></p>
                                        <p><strong>Vrednost:</strong> <code class="bg-gray-100 px-1 rounded">proxy.servishub.rs</code></p>
                                    </div>
                                </div>
                                <p class="text-xs text-yellow-700 mt-3">DNS promene mogu potrajati do 24 sata da se propagiraju.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Add New Domain -->
                    <div x-show="!customDomain.domain" class="border rounded-lg overflow-hidden">
                        <div class="bg-gray-50 px-4 py-3 border-b">
                            <h4 class="font-medium text-gray-900">Dodaj custom domen</h4>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-3">
                                <input type="text" x-model="newDomainInput" placeholder="mojservis.rs"
                                       class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
                                <button @click="setupDomain()" :disabled="settingUpDomain || !newDomainInput"
                                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50">
                                    <span x-show="!settingUpDomain">Dodaj</span>
                                    <span x-show="settingUpDomain">Dodajem...</span>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Unesite domen bez http:// ili www. (npr. mojservis.rs)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== USER MODAL ==================== -->
    <div x-show="userModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-black/50" @click="userModal = false"></div>
            <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full mx-auto p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4" x-text="editingUser ? 'Izmeni korisnika' : 'Novi korisnik'"></h2>

                <form @submit.prevent="saveUser()">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ime *</label>
                                <input type="text" x-model="userForm.ime" required
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Prezime *</label>
                                <input type="text" x-model="userForm.prezime" required
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" x-model="userForm.email" required :disabled="editingUser"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50">
                        </div>
                        <div x-show="!editingUser">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Lozinka *</label>
                            <input type="password" x-model="userForm.password" :required="!editingUser" minlength="6"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="text" x-model="userForm.phone"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rola</label>
                            <select x-model="userForm.role"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                                <option value="TECHNICIAN">Serviser</option>
                                <option value="RECEPTIONIST">Recepcionar</option>
                                <option value="MANAGER">Menadzer</option>
                                <option value="ADMIN">Administrator</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex gap-3 mt-6">
                        <button type="button" @click="userModal = false"
                                class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Otkazi
                        </button>
                        <button type="submit" :disabled="saving"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                            <span x-show="!saving">Sacuvaj</span>
                            <span x-show="saving">Cuvam...</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==================== LOCATION MODAL ==================== -->
    <div x-show="locationModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-black/50" @click="locationModal = false"></div>
            <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full mx-auto p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4" x-text="editingLocation ? 'Izmeni lokaciju' : 'Nova lokacija'"></h2>

                <form @submit.prevent="saveLocation()">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Naziv *</label>
                            <input type="text" x-model="locationForm.name" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Adresa</label>
                            <input type="text" x-model="locationForm.address"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Grad</label>
                                <input type="text" x-model="locationForm.city"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Postanski broj</label>
                                <input type="text" x-model="locationForm.postal_code"
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefon</label>
                            <input type="text" x-model="locationForm.phone"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" x-model="locationForm.email"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div class="flex gap-3 mt-6">
                        <button type="button" @click="locationModal = false"
                                class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Otkazi
                        </button>
                        <button type="submit" :disabled="saving"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                            <span x-show="!saving">Sacuvaj</span>
                            <span x-show="saving">Cuvam...</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<script>
function settingsPage() {
    return {
        // State
        loading: true,
        saving: false,
        savingPublic: false,
        activeTab: new URLSearchParams(window.location.search).get('tab') || 'settings',
        currentTheme: localStorage.getItem('servishub-theme') || 'light',

        // Modals
        userModal: false,
        locationModal: false,
        editingUser: null,
        editingLocation: null,

        // Data
        profile: {},
        settings: {},
        subscription: {},
        users: [],
        locations: [],
        kyc: {},

        // Public Profile
        publicProfile: {
            is_public: false,
            display_name: '',
            tagline: '',
            description: '',
            phone: '',
            phone_secondary: '',
            email: '',
            address: '',
            city: '',
            postal_code: '',
            maps_url: '',
            maps_embed_url: '',
            working_hours: {
                mon_open: '09:00', mon_close: '17:00', mon_closed: false,
                tue_open: '09:00', tue_close: '17:00', tue_closed: false,
                wed_open: '09:00', wed_close: '17:00', wed_closed: false,
                thu_open: '09:00', thu_close: '17:00', thu_closed: false,
                fri_open: '09:00', fri_close: '17:00', fri_closed: false,
                sat_open: '09:00', sat_close: '14:00', sat_closed: false,
                sun_open: '', sun_close: '', sun_closed: true
            },
            logo_url: '',
            cover_image_url: '',
            primary_color: '#3b82f6',
            secondary_color: '#1e40af',
            facebook_url: '',
            instagram_url: '',
            youtube_url: '',
            tiktok_url: '',
            linkedin_url: '',
            website_url: '',
            show_prices: true,
            price_disclaimer: '',
            meta_title: '',
            meta_description: '',
            meta_keywords: '',
            about_title: '',
            about_content: '',
            // New v2 fields
            faq_title: 'esto postavljana pitanja',
            faq_items: [],
            show_brands_section: true,
            supported_brands: [],
            show_process_section: true,
            process_title: 'Kako funkcionie',
            process_steps: [],
            show_whatsapp_button: false,
            whatsapp_number: '',
            whatsapp_message: 'Zdravo! Imam pitanje u vezi servisa.',
            show_tracking_widget: true,
            tracking_widget_title: 'Pratite status popravke',
            hero_style: 'centered'
        },
        publicSubTab: 'basic',
        tenantSlug: '',
        publicPageUrls: { subdomain: '', custom_domain: null },
        customDomain: { domain: null, verified: false, verification_instructions: null },
        qrCode: null,
        newDomainInput: '',
        settingUpDomain: false,
        verifyingDomain: false,

        // Forms
        userForm: {},
        locationForm: {},
        kycForm: {},

        async init() {
            // Apply saved theme on init
            this.applyTheme(this.currentTheme);
            await this.loadAll();
        },

        setTheme(theme) {
            this.currentTheme = theme;
            localStorage.setItem('servishub-theme', theme);
            this.applyTheme(theme);
            showToast(theme === 'glass' ? 'Glassmorphism tema aktivirana' : 'Svetla tema aktivirana', 'success');
        },

        applyTheme(theme) {
            if (theme === 'glass') {
                document.documentElement.classList.add('glass-theme');
            } else {
                document.documentElement.classList.remove('glass-theme');
            }
        },

        async loadAll() {
            this.loading = true;
            try {
                const [profileRes, settingsRes, subscriptionRes, usersRes, locationsRes, kycRes, publicRes] = await Promise.all([
                    api('/tenant/profile'),
                    api('/tenant/settings'),
                    api('/tenant/subscription'),
                    api('/users'),
                    api('/locations'),
                    api('/tenant/kyc'),
                    api('/tenant/public-profile')
                ]);

                if (profileRes.ok) this.profile = await profileRes.json();
                if (settingsRes.ok) this.settings = await settingsRes.json();
                if (subscriptionRes.ok) this.subscription = await subscriptionRes.json();
                if (usersRes.ok) {
                    const usersData = await usersRes.json();
                    this.users = usersData.users || [];
                }
                if (locationsRes.ok) {
                    const locationsData = await locationsRes.json();
                    this.locations = locationsData.locations || [];
                }
                if (kycRes.ok) {
                    const kycData = await kycRes.json();
                    this.kyc = kycData;
                    // Init KYC form
                    if (kycData.representative) {
                        this.kycForm = { ...kycData.representative };
                    }
                }
                if (publicRes.ok) {
                    const publicData = await publicRes.json();
                    this.tenantSlug = publicData.tenant_slug || '';
                    this.publicPageUrls.subdomain = publicData.subdomain_url || `https://${this.tenantSlug}.servishub.rs`;
                    this.publicPageUrls.custom_domain = publicData.custom_domain_url || null;

                    if (publicData.exists && publicData.profile) {
                        const p = publicData.profile;
                        // Flatten profile data for form binding
                        this.publicProfile = {
                            is_public: p.is_public || false,
                            display_name: p.display_name || '',
                            tagline: p.tagline || '',
                            description: p.description || '',
                            phone: p.contact?.phone || '',
                            phone_secondary: p.contact?.phone_secondary || '',
                            email: p.contact?.email || '',
                            address: p.contact?.address || '',
                            city: p.contact?.city || '',
                            postal_code: p.contact?.postal_code || '',
                            maps_url: p.contact?.maps_url || '',
                            maps_embed_url: p.contact?.maps_embed_url || '',
                            working_hours: this.parseWorkingHours(p.working_hours),
                            logo_url: p.branding?.logo_url || '',
                            cover_image_url: p.branding?.cover_image_url || '',
                            primary_color: p.branding?.primary_color || '#3b82f6',
                            secondary_color: p.branding?.secondary_color || '#1e40af',
                            facebook_url: p.social?.facebook || '',
                            instagram_url: p.social?.instagram || '',
                            youtube_url: p.social?.youtube || '',
                            tiktok_url: p.social?.tiktok || '',
                            linkedin_url: p.social?.linkedin || '',
                            website_url: p.social?.website || '',
                            show_prices: p.pricing?.show_prices !== false,
                            price_disclaimer: p.pricing?.disclaimer || '',
                            meta_title: p.seo?.meta_title || '',
                            meta_description: p.seo?.meta_description || '',
                            meta_keywords: p.seo?.meta_keywords || '',
                            about_title: p.sections?.about_title || '',
                            about_content: p.sections?.about_content || '',
                            // New v2 fields - these come from separate groups in API response
                            faq_title: p.faq?.title || 'esto postavljana pitanja',
                            faq_items: p.faq?.items || [],
                            show_brands_section: p.brands?.show_section !== false,
                            supported_brands: p.brands?.supported || [],
                            show_process_section: p.process?.show_section !== false,
                            process_title: p.process?.title || 'Kako funkcionie',
                            process_steps: p.process?.steps || [],
                            show_whatsapp_button: p.whatsapp?.show_button || false,
                            whatsapp_number: p.whatsapp?.number || '',
                            whatsapp_message: p.whatsapp?.message || 'Zdravo! Imam pitanje u vezi servisa.',
                            show_tracking_widget: p.tracking?.show_widget !== false,
                            tracking_widget_title: p.tracking?.title || 'Pratite status popravke',
                            hero_style: p.hero_style || 'centered'
                        };
                        // Custom domain data
                        if (p.custom_domain) {
                            this.customDomain = {
                                domain: p.custom_domain.domain || null,
                                verified: p.custom_domain.verified || false,
                                verification_instructions: p.custom_domain.verification_instructions || null
                            };
                            if (p.custom_domain.verified && p.custom_domain.domain) {
                                this.publicPageUrls.custom_domain = `https://${p.custom_domain.domain}`;
                            }
                        }
                    }
                }
            } catch (e) {
                console.error('Failed to load data:', e);
                showToast('Greska pri ucitavanju', 'error');
            } finally {
                this.loading = false;
            }
        },

        async saveProfile() {
            this.saving = true;
            try {
                const response = await api('/tenant/profile', 'PUT', {
                    name: this.profile.name,
                    email: this.profile.email,
                    telefon: this.profile.telefon,
                    adresa_sedista: this.profile.adresa_sedista
                });
                if (response.ok) {
                    showToast('Profil sacuvan', 'success');
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri cuvanju', 'error');
                }
            } catch (e) {
                showToast('Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        async saveSettings() {
            this.saving = true;
            try {
                const response = await api('/tenant/settings', 'PUT', this.settings);
                if (response.ok) {
                    showToast('Podesavanja sacuvana', 'success');
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri cuvanju', 'error');
                }
            } catch (e) {
                showToast('Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        async submitKyc() {
            this.saving = true;
            try {
                const response = await api('/tenant/kyc', 'POST', this.kycForm);
                if (response.ok) {
                    showToast('KYC zahtev poslat', 'success');
                    const kycRes = await api('/tenant/kyc');
                    if (kycRes.ok) {
                        this.kyc = await kycRes.json();
                    }
                } else {
                    const err = await response.json();
                    showToast(err.error || 'Greska pri slanju', 'error');
                }
            } catch (e) {
                showToast('Greska pri slanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        // Users
        openUserModal() {
            this.editingUser = null;
            this.userForm = {
                ime: '',
                prezime: '',
                email: '',
                password: '',
                phone: '',
                role: 'TECHNICIAN'
            };
            this.userModal = true;
        },

        editUser(user) {
            this.editingUser = user;
            this.userForm = {
                ime: user.ime,
                prezime: user.prezime,
                email: user.email,
                phone: user.phone,
                role: user.role
            };
            this.userModal = true;
        },

        async saveUser() {
            this.saving = true;
            try {
                let response;
                if (this.editingUser) {
                    response = await api(`/users/${this.editingUser.id}`, 'PUT', this.userForm);
                } else {
                    response = await api('/users', 'POST', this.userForm);
                }
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri cuvanju');
                }
                showToast('Korisnik sacuvan', 'success');
                this.userModal = false;
                const usersRes = await api('/users');
                if (usersRes.ok) {
                    const data = await usersRes.json();
                    this.users = data.users || [];
                }
            } catch (e) {
                showToast(e.message || 'Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        // Locations
        openLocationModal() {
            this.editingLocation = null;
            this.locationForm = {
                name: '',
                address: '',
                city: '',
                postal_code: '',
                phone: '',
                email: ''
            };
            this.locationModal = true;
        },

        editLocation(location) {
            this.editingLocation = location;
            this.locationForm = {
                name: location.name,
                address: location.address,
                city: location.city,
                postal_code: location.postal_code,
                phone: location.phone,
                email: location.email
            };
            this.locationModal = true;
        },

        async saveLocation() {
            this.saving = true;
            try {
                let response;
                if (this.editingLocation) {
                    response = await api(`/locations/${this.editingLocation.id}`, 'PUT', this.locationForm);
                } else {
                    response = await api('/locations', 'POST', this.locationForm);
                }
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri cuvanju');
                }
                showToast('Lokacija sacuvana', 'success');
                this.locationModal = false;
                const locationsRes = await api('/locations');
                if (locationsRes.ok) {
                    const data = await locationsRes.json();
                    this.locations = data.locations || [];
                }
            } catch (e) {
                showToast(e.message || 'Greska pri cuvanju', 'error');
            } finally {
                this.saving = false;
            }
        },

        // Helpers
        getRoleLabel(role) {
            const labels = {
                'OWNER': 'Vlasnik',
                'ADMIN': 'Admin',
                'MANAGER': 'Menadzer',
                'TECHNICIAN': 'Serviser',
                'RECEPTIONIST': 'Recepcionar'
            };
            return labels[role] || role;
        },

        getRoleClass(role) {
            const classes = {
                'OWNER': 'bg-purple-100 text-purple-700',
                'ADMIN': 'bg-red-100 text-red-700',
                'MANAGER': 'bg-blue-100 text-blue-700',
                'TECHNICIAN': 'bg-green-100 text-green-700',
                'RECEPTIONIST': 'bg-gray-100 text-gray-700'
            };
            return classes[role] || 'bg-gray-100 text-gray-700';
        },

        getSubscriptionStatusLabel(status) {
            const labels = {
                'PENDING': 'Cekanje',
                'TRIAL': 'Trial',
                'ACTIVE': 'Aktivan',
                'EXPIRED': 'Istekao',
                'SUSPENDED': 'Suspendovan'
            };
            return labels[status] || status;
        },

        getSubscriptionStatusClass(status) {
            const classes = {
                'PENDING': 'bg-yellow-100 text-yellow-700',
                'TRIAL': 'bg-blue-100 text-blue-700',
                'ACTIVE': 'bg-green-100 text-green-700',
                'EXPIRED': 'bg-red-100 text-red-700',
                'SUSPENDED': 'bg-gray-100 text-gray-700'
            };
            return classes[status] || 'bg-gray-100 text-gray-700';
        },

        formatPrice(price) {
            if (!price) return '0';
            return new Intl.NumberFormat('sr-RS').format(price);
        },

        formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('sr-RS');
        },

        // ==================== PUBLIC PROFILE ====================

        parseWorkingHours(wh) {
            // Parse working hours from API into the new format
            const defaults = {
                mon_open: '09:00', mon_close: '17:00', mon_closed: false,
                tue_open: '09:00', tue_close: '17:00', tue_closed: false,
                wed_open: '09:00', wed_close: '17:00', wed_closed: false,
                thu_open: '09:00', thu_close: '17:00', thu_closed: false,
                fri_open: '09:00', fri_close: '17:00', fri_closed: false,
                sat_open: '09:00', sat_close: '14:00', sat_closed: false,
                sun_open: '', sun_close: '', sun_closed: true
            };

            if (!wh || typeof wh !== 'object') return defaults;

            // Check if it's the new format (has mon_open, etc.)
            if ('mon_open' in wh || 'mon_closed' in wh) {
                return { ...defaults, ...wh };
            }

            // Convert old format (e.g., {mon: "09:00-17:00"}) to new format
            const result = { ...defaults };
            const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
            for (const day of days) {
                if (wh[day]) {
                    const val = wh[day].toLowerCase();
                    if (val === 'zatvoreno' || val === 'closed' || val === '-') {
                        result[`${day}_closed`] = true;
                        result[`${day}_open`] = '';
                        result[`${day}_close`] = '';
                    } else if (val.includes('-')) {
                        const [open, close] = val.split('-').map(t => t.trim());
                        result[`${day}_open`] = open || '';
                        result[`${day}_close`] = close || '';
                        result[`${day}_closed`] = false;
                    }
                }
            }
            return result;
        },

        fillDefaultWorkingHours() {
            this.publicProfile.working_hours = {
                mon_open: '09:00', mon_close: '17:00', mon_closed: false,
                tue_open: '09:00', tue_close: '17:00', tue_closed: false,
                wed_open: '09:00', wed_close: '17:00', wed_closed: false,
                thu_open: '09:00', thu_close: '17:00', thu_closed: false,
                fri_open: '09:00', fri_close: '17:00', fri_closed: false,
                sat_open: '09:00', sat_close: '14:00', sat_closed: false,
                sun_open: '', sun_close: '', sun_closed: true
            };
            showToast('Standardno radno vreme popunjeno', 'success');
        },

        // ==================== SECTIONS HELPERS (v2) ====================

        toggleBrand(brand) {
            if (!Array.isArray(this.publicProfile.supported_brands)) {
                this.publicProfile.supported_brands = [];
            }
            const index = this.publicProfile.supported_brands.indexOf(brand);
            if (index > -1) {
                this.publicProfile.supported_brands.splice(index, 1);
            } else {
                this.publicProfile.supported_brands.push(brand);
            }
        },

        addFaqItem() {
            if (!Array.isArray(this.publicProfile.faq_items)) {
                this.publicProfile.faq_items = [];
            }
            this.publicProfile.faq_items.push({ question: '', answer: '' });
        },

        removeFaqItem(index) {
            if (Array.isArray(this.publicProfile.faq_items) && index >= 0 && index < this.publicProfile.faq_items.length) {
                this.publicProfile.faq_items.splice(index, 1);
            }
        },

        addSuggestedFaq(question, answer) {
            if (!Array.isArray(this.publicProfile.faq_items)) {
                this.publicProfile.faq_items = [];
            }
            // Check if this FAQ already exists
            const exists = this.publicProfile.faq_items.some(item => item.question === question);
            if (!exists) {
                this.publicProfile.faq_items.push({ question, answer });
                showToast('FAQ dodato', 'success');
            } else {
                showToast('Ovo pitanje vec postoji', 'warning');
            }
        },

        async savePublicProfile() {
            this.savingPublic = true;
            try {
                // Create a copy with converted working_hours
                const profileToSave = {...this.publicProfile};

                // Explicitly convert working_hours from form format to API format
                if (profileToSave.working_hours && typeof profileToSave.working_hours === 'object') {
                    profileToSave.working_hours = this.formatWorkingHoursForApi(profileToSave.working_hours);
                }

                // Sanitize URLs to prevent XSS
                const sanitizedProfile = this.sanitizePublicProfile(profileToSave);

                const response = await api('/tenant/public-profile', 'PUT', sanitizedProfile);
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri cuvanju');
                }
                const data = await response.json();
                showToast('Javna stranica sacuvana', 'success');

                // Reload to get updated data
                if (data.profile) {
                    // Update URLs in case custom domain changed
                    const publicRes = await api('/tenant/public-profile');
                    if (publicRes.ok) {
                        const publicData = await publicRes.json();
                        this.publicPageUrls.custom_domain = publicData.custom_domain_url || null;
                    }
                }
            } catch (e) {
                showToast(e.message || 'Greska pri cuvanju', 'error');
            } finally {
                this.savingPublic = false;
            }
        },

        // Konvertuje novi format radnog vremena u stari format za API/template
        formatWorkingHoursForApi(wh) {
            if (!wh || typeof wh !== 'object') return {};

            const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
            const result = {};

            for (const day of days) {
                const closedKey = `${day}_closed`;
                const openKey = `${day}_open`;
                const closeKey = `${day}_close`;

                if (wh[closedKey] === true) {
                    result[day] = 'Zatvoreno';
                } else if (wh[openKey] && wh[closeKey]) {
                    result[day] = `${wh[openKey]}-${wh[closeKey]}`;
                } else if (wh[openKey]) {
                    result[day] = wh[openKey];
                }
                // Ako nema podataka za dan, ne dodajemo ga
            }

            return result;
        },

        sanitizePublicProfile(profile) {
            // Create a clean copy with sanitized values
            const sanitized = {};
            const urlFields = ['logo_url', 'cover_image_url', 'maps_url', 'maps_embed_url',
                               'facebook_url', 'instagram_url', 'youtube_url', 'tiktok_url',
                               'linkedin_url', 'website_url'];

            for (const [key, value] of Object.entries(profile)) {
                if (value === null || value === undefined) {
                    sanitized[key] = value;
                } else if (key === 'working_hours' && typeof value === 'object') {
                    // Check if already in API format (no _closed keys) or needs conversion
                    if ('mon_closed' in value || 'tue_closed' in value) {
                        // Form format, needs conversion
                        sanitized[key] = this.formatWorkingHoursForApi(value);
                    } else {
                        // Already in API format, pass through
                        sanitized[key] = value;
                    }
                } else if (typeof value === 'string') {
                    // Sanitize string values
                    let sanitizedValue = value.trim();
                    // For URL fields, validate URL format
                    if (urlFields.includes(key) && sanitizedValue) {
                        try {
                            const url = new URL(sanitizedValue);
                            // Only allow http/https
                            if (!['http:', 'https:'].includes(url.protocol)) {
                                sanitizedValue = '';
                            }
                        } catch {
                            // Invalid URL, keep as is (server will validate)
                        }
                    }
                    sanitized[key] = sanitizedValue;
                } else if (typeof value === 'object') {
                    // Recursively sanitize objects
                    sanitized[key] = this.sanitizePublicProfile(value);
                } else {
                    sanitized[key] = value;
                }
            }
            return sanitized;
        },

        async loadQRCode() {
            if (this.qrCode) {
                this.qrCode = null;
                return;
            }
            try {
                const response = await api('/tenant/public-profile/qrcode');
                if (response.ok) {
                    const data = await response.json();
                    this.qrCode = data.qrcode;
                }
            } catch (e) {
                showToast('Greska pri generisanju QR koda', 'error');
            }
        },

        copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Kopirano u clipboard', 'success');
                });
            } else {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('Kopirano u clipboard', 'success');
            }
        },

        async setupDomain() {
            if (!this.newDomainInput) return;

            // Validate domain format
            const domain = this.newDomainInput.toLowerCase().trim();
            const domainRegex = /^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z]{2,})+$/;
            if (!domainRegex.test(domain)) {
                showToast('Neispravan format domena', 'error');
                return;
            }

            this.settingUpDomain = true;
            try {
                const response = await api('/tenant/public-profile/custom-domain', 'POST', {
                    domain: domain
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Greska pri dodavanju domena');
                }

                showToast('Domen dodat. Proverite DNS instrukcije.', 'success');
                this.customDomain = {
                    domain: data.domain,
                    verified: false,
                    verification_instructions: data.verification_instructions
                };
                this.newDomainInput = '';
            } catch (e) {
                showToast(e.message || 'Greska pri dodavanju domena', 'error');
            } finally {
                this.settingUpDomain = false;
            }
        },

        async verifyDomain() {
            this.verifyingDomain = true;
            try {
                const response = await api('/tenant/public-profile/custom-domain/verify', 'POST');
                const data = await response.json();

                if (data.verified) {
                    showToast('Domen uspesno verifikovan!', 'success');
                    this.customDomain.verified = true;
                    this.publicPageUrls.custom_domain = data.url;
                } else {
                    const errors = data.errors?.join(', ') || 'DNS zapisi nisu ispravno podeseni';
                    showToast(errors, 'error');
                }
            } catch (e) {
                showToast('Greska pri verifikaciji domena', 'error');
            } finally {
                this.verifyingDomain = false;
            }
        },

        async removeDomain() {
            if (!confirm('Da li ste sigurni da zelite da uklonite custom domen?')) {
                return;
            }
            try {
                const response = await api('/tenant/public-profile/custom-domain', 'DELETE');
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Greska pri uklanjanju domena');
                }
                showToast('Domen uklonjen', 'success');
                this.customDomain = { domain: null, verified: false, verification_instructions: null };
                this.publicPageUrls.custom_domain = null;
            } catch (e) {
                showToast(e.message || 'Greska pri uklanjanju domena', 'error');
            }
        }
    }
}
</script>
{% endblock %}
